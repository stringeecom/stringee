(()=>{"use strict";var e={539:e=>{const t={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map((e=>e.trim()))},t.splitSections=function(e){return e.split("\nm=").map(((e,t)=>(t>0?"m="+e:e).trim()+"\r\n"))},t.getDescription=function(e){const n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){const n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter((e=>0===e.indexOf(n)))},t.parseCandidate=function(e){let t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");const n={foundation:t[0],component:{1:"rtp",2:"rtcp"}[t[1]]||t[1],protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]};for(let e=8;e<t.length;e+=2)switch(t[e]){case"raddr":n.relatedAddress=t[e+1];break;case"rport":n.relatedPort=parseInt(t[e+1],10);break;case"tcptype":n.tcpType=t[e+1];break;case"ufrag":n.ufrag=t[e+1],n.usernameFragment=t[e+1];break;default:void 0===n[t[e]]&&(n[t[e]]=t[e+1])}return n},t.writeCandidate=function(e){const t=[];t.push(e.foundation);const n=e.component;"rtp"===n?t.push(1):"rtcp"===n?t.push(2):t.push(n),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);const r=e.type;return t.push("typ"),t.push(r),"host"!==r&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substring(14).split(" ")},t.parseRtpMap=function(e){let t=e.substring(9).split(" ");const n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){let t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);const n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){const t=e.substring(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1],attributes:t.slice(2).join(" ")}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+(e.attributes?" "+e.attributes:"")+"\r\n"},t.parseFmtp=function(e){const t={};let n;const r=e.substring(e.indexOf(" ")+1).split(";");for(let e=0;e<r.length;e++)n=r[e].trim().split("="),t[n[0].trim()]=n[1];return t},t.writeFmtp=function(e){let t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){const r=[];Object.keys(e.parameters).forEach((t=>{void 0!==e.parameters[t]?r.push(t+"="+e.parameters[t]):r.push(t)})),t+="a=fmtp:"+n+" "+r.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){const t=e.substring(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){let t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach((e=>{t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"})),t},t.parseSsrcMedia=function(e){const t=e.indexOf(" "),n={ssrc:parseInt(e.substring(7,t),10)},r=e.indexOf(":",t);return r>-1?(n.attribute=e.substring(t+1,r),n.value=e.substring(r+1)):n.attribute=e.substring(t+1),n},t.parseSsrcGroup=function(e){const t=e.substring(13).split(" ");return{semantics:t.shift(),ssrcs:t.map((e=>parseInt(e,10)))}},t.getMid=function(e){const n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substring(6)},t.parseFingerprint=function(e){const t=e.substring(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1].toUpperCase()}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){let n="a=setup:"+t+"\r\n";return e.fingerprints.forEach((e=>{n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"})),n},t.parseCryptoLine=function(e){const t=e.substring(9).split(" ");return{tag:parseInt(t[0],10),cryptoSuite:t[1],keyParams:t[2],sessionParams:t.slice(3)}},t.writeCryptoLine=function(e){return"a=crypto:"+e.tag+" "+e.cryptoSuite+" "+("object"==typeof e.keyParams?t.writeCryptoKeyParams(e.keyParams):e.keyParams)+(e.sessionParams?" "+e.sessionParams.join(" "):"")+"\r\n"},t.parseCryptoKeyParams=function(e){if(0!==e.indexOf("inline:"))return null;const t=e.substring(7).split("|");return{keyMethod:"inline",keySalt:t[0],lifeTime:t[1],mkiValue:t[2]?t[2].split(":")[0]:void 0,mkiLength:t[2]?t[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(e){return e.keyMethod+":"+e.keySalt+(e.lifeTime?"|"+e.lifeTime:"")+(e.mkiValue&&e.mkiLength?"|"+e.mkiValue+":"+e.mkiLength:"")},t.getCryptoParameters=function(e,n){return t.matchPrefix(e+n,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(e,n){const r=t.matchPrefix(e+n,"a=ice-ufrag:")[0],s=t.matchPrefix(e+n,"a=ice-pwd:")[0];return r&&s?{usernameFragment:r.substring(12),password:s.substring(10)}:null},t.writeIceParameters=function(e){let t="a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n";return e.iceLite&&(t+="a=ice-lite\r\n"),t},t.parseRtpParameters=function(e){const n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},r=t.splitLines(e)[0].split(" ");n.profile=r[2];for(let s=3;s<r.length;s++){const i=r[s],o=t.matchPrefix(e,"a=rtpmap:"+i+" ")[0];if(o){const r=t.parseRtpMap(o),s=t.matchPrefix(e,"a=fmtp:"+i+" ");switch(r.parameters=s.length?t.parseFmtp(s[0]):{},r.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+i+" ").map(t.parseRtcpFb),n.codecs.push(r),r.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(r.name.toUpperCase())}}}t.matchPrefix(e,"a=extmap:").forEach((e=>{n.headerExtensions.push(t.parseExtmap(e))}));const s=t.matchPrefix(e,"a=rtcp-fb:* ").map(t.parseRtcpFb);return n.codecs.forEach((e=>{s.forEach((t=>{e.rtcpFeedback.find((e=>e.type===t.type&&e.parameter===t.parameter))||e.rtcpFeedback.push(t)}))})),n},t.writeRtpDescription=function(e,n){let r="";r+="m="+e+" ",r+=n.codecs.length>0?"9":"0",r+=" "+(n.profile||"UDP/TLS/RTP/SAVPF")+" ",r+=n.codecs.map((e=>void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType)).join(" ")+"\r\n",r+="c=IN IP4 0.0.0.0\r\n",r+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach((e=>{r+=t.writeRtpMap(e),r+=t.writeFmtp(e),r+=t.writeRtcpFb(e)}));let s=0;return n.codecs.forEach((e=>{e.maxptime>s&&(s=e.maxptime)})),s>0&&(r+="a=maxptime:"+s+"\r\n"),n.headerExtensions&&n.headerExtensions.forEach((e=>{r+=t.writeExtmap(e)})),r},t.parseRtpEncodingParameters=function(e){const n=[],r=t.parseRtpParameters(e),s=-1!==r.fecMechanisms.indexOf("RED"),i=-1!==r.fecMechanisms.indexOf("ULPFEC"),o=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute)),a=o.length>0&&o[0].ssrc;let c;const l=t.matchPrefix(e,"a=ssrc-group:FID").map((e=>e.substring(17).split(" ").map((e=>parseInt(e,10)))));l.length>0&&l[0].length>1&&l[0][0]===a&&(c=l[0][1]),r.codecs.forEach((e=>{if("RTX"===e.name.toUpperCase()&&e.parameters.apt){let t={ssrc:a,codecPayloadType:parseInt(e.parameters.apt,10)};a&&c&&(t.rtx={ssrc:c}),n.push(t),s&&(t=JSON.parse(JSON.stringify(t)),t.fec={ssrc:a,mechanism:i?"red+ulpfec":"red"},n.push(t))}})),0===n.length&&a&&n.push({ssrc:a});let d=t.matchPrefix(e,"b=");return d.length&&(d=0===d[0].indexOf("b=TIAS:")?parseInt(d[0].substring(7),10):0===d[0].indexOf("b=AS:")?1e3*parseInt(d[0].substring(5),10)*.95-16e3:void 0,n.forEach((e=>{e.maxBitrate=d}))),n},t.parseRtcpParameters=function(e){const n={},r=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"cname"===e.attribute))[0];r&&(n.cname=r.value,n.ssrc=r.ssrc);const s=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=s.length>0,n.compound=0===s.length;const i=t.matchPrefix(e,"a=rtcp-mux");return n.mux=i.length>0,n},t.writeRtcpParameters=function(e){let t="";return e.reducedSize&&(t+="a=rtcp-rsize\r\n"),e.mux&&(t+="a=rtcp-mux\r\n"),void 0!==e.ssrc&&e.cname&&(t+="a=ssrc:"+e.ssrc+" cname:"+e.cname+"\r\n"),t},t.parseMsid=function(e){let n;const r=t.matchPrefix(e,"a=msid:");if(1===r.length)return n=r[0].substring(7).split(" "),{stream:n[0],track:n[1]};const s=t.matchPrefix(e,"a=ssrc:").map((e=>t.parseSsrcMedia(e))).filter((e=>"msid"===e.attribute));return s.length>0?(n=s[0].value.split(" "),{stream:n[0],track:n[1]}):void 0},t.parseSctpDescription=function(e){const n=t.parseMLine(e),r=t.matchPrefix(e,"a=max-message-size:");let s;r.length>0&&(s=parseInt(r[0].substring(19),10)),isNaN(s)&&(s=65536);const i=t.matchPrefix(e,"a=sctp-port:");if(i.length>0)return{port:parseInt(i[0].substring(12),10),protocol:n.fmt,maxMessageSize:s};const o=t.matchPrefix(e,"a=sctpmap:");if(o.length>0){const e=o[0].substring(10).split(" ");return{port:parseInt(e[0],10),protocol:e[1],maxMessageSize:s}}},t.writeSctpDescription=function(e,t){let n=[];return n="DTLS/SCTP"!==e.protocol?["m="+e.kind+" 9 "+e.protocol+" "+t.protocol+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctp-port:"+t.port+"\r\n"]:["m="+e.kind+" 9 "+e.protocol+" "+t.port+"\r\n","c=IN IP4 0.0.0.0\r\n","a=sctpmap:"+t.port+" "+t.protocol+" 65535\r\n"],void 0!==t.maxMessageSize&&n.push("a=max-message-size:"+t.maxMessageSize+"\r\n"),n.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,22)},t.writeSessionBoilerplate=function(e,n,r){let s;const i=void 0!==n?n:2;return s=e||t.generateSessionId(),"v=0\r\no="+(r||"thisisadapterortc")+" "+s+" "+i+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.getDirection=function(e,n){const r=t.splitLines(e);for(let e=0;e<r.length;e++)switch(r[e]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return r[e].substring(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substring(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){const n=t.splitLines(e)[0].substring(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){const n=t.matchPrefix(e,"o=")[0].substring(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;const n=t.splitLines(e);for(let e=0;e<n.length;e++)if(n[e].length<2||"="!==n[e].charAt(1))return!1;return!0},e.exports=t},218:(e,t,n)=>{function r(e,t){return function(){return e.apply(t,arguments)}}const{toString:s}=Object.prototype,{getPrototypeOf:i}=Object,o=(a=Object.create(null),e=>{const t=s.call(e);return a[t]||(a[t]=t.slice(8,-1).toLowerCase())});var a;const c=e=>(e=e.toLowerCase(),t=>o(t)===e),l=e=>t=>typeof t===e,{isArray:d}=Array,u=l("undefined"),h=c("ArrayBuffer"),m=l("string"),p=l("function"),v=l("number"),f=e=>null!==e&&"object"==typeof e,g=e=>{if("object"!==o(e))return!1;const t=i(e);return!(null!==t&&t!==Object.prototype&&null!==Object.getPrototypeOf(t)||Symbol.toStringTag in e||Symbol.iterator in e)},_=c("Date"),C=c("File"),S=c("Blob"),E=c("FileList"),I=c("URLSearchParams");function T(e,t,{allOwnKeys:n=!1}={}){if(null==e)return;let r,s;if("object"!=typeof e&&(e=[e]),d(e))for(r=0,s=e.length;r<s;r++)t.call(null,e[r],r,e);else{const s=n?Object.getOwnPropertyNames(e):Object.keys(e),i=s.length;let o;for(r=0;r<i;r++)o=s[r],t.call(null,e[o],o,e)}}function R(e,t){t=t.toLowerCase();const n=Object.keys(e);let r,s=n.length;for(;s-- >0;)if(r=n[s],t===r.toLowerCase())return r;return null}const y="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:n.g,O=e=>!u(e)&&e!==y,A=(b="undefined"!=typeof Uint8Array&&i(Uint8Array),e=>b&&e instanceof b);var b;const M=c("HTMLFormElement"),w=(({hasOwnProperty:e})=>(t,n)=>e.call(t,n))(Object.prototype),k=c("RegExp"),D=(e,t)=>{const n=Object.getOwnPropertyDescriptors(e),r={};T(n,((n,s)=>{!1!==t(n,s,e)&&(r[s]=n)})),Object.defineProperties(e,r)},P="abcdefghijklmnopqrstuvwxyz",N="0123456789",L={DIGIT:N,ALPHA:P,ALPHA_DIGIT:P+P.toUpperCase()+N};var F={isArray:d,isArrayBuffer:h,isBuffer:function(e){return null!==e&&!u(e)&&null!==e.constructor&&!u(e.constructor)&&p(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{const t="[object FormData]";return e&&("function"==typeof FormData&&e instanceof FormData||s.call(e)===t||p(e.toString)&&e.toString()===t)},isArrayBufferView:function(e){let t;return t="undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&h(e.buffer),t},isString:m,isNumber:v,isBoolean:e=>!0===e||!1===e,isObject:f,isPlainObject:g,isUndefined:u,isDate:_,isFile:C,isBlob:S,isRegExp:k,isFunction:p,isStream:e=>f(e)&&p(e.pipe),isURLSearchParams:I,isTypedArray:A,isFileList:E,forEach:T,merge:function e(){const{caseless:t}=O(this)&&this||{},n={},r=(r,s)=>{const i=t&&R(n,s)||s;g(n[i])&&g(r)?n[i]=e(n[i],r):g(r)?n[i]=e({},r):d(r)?n[i]=r.slice():n[i]=r};for(let e=0,t=arguments.length;e<t;e++)arguments[e]&&T(arguments[e],r);return n},extend:(e,t,n,{allOwnKeys:s}={})=>(T(t,((t,s)=>{n&&p(t)?e[s]=r(t,n):e[s]=t}),{allOwnKeys:s}),e),trim:e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(65279===e.charCodeAt(0)&&(e=e.slice(1)),e),inherits:(e,t,n,r)=>{e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:t.prototype}),n&&Object.assign(e.prototype,n)},toFlatObject:(e,t,n,r)=>{let s,o,a;const c={};if(t=t||{},null==e)return t;do{for(s=Object.getOwnPropertyNames(e),o=s.length;o-- >0;)a=s[o],r&&!r(a,e,t)||c[a]||(t[a]=e[a],c[a]=!0);e=!1!==n&&i(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:o,kindOfTest:c,endsWith:(e,t,n)=>{e=String(e),(void 0===n||n>e.length)&&(n=e.length),n-=t.length;const r=e.indexOf(t,n);return-1!==r&&r===n},toArray:e=>{if(!e)return null;if(d(e))return e;let t=e.length;if(!v(t))return null;const n=new Array(t);for(;t-- >0;)n[t]=e[t];return n},forEachEntry:(e,t)=>{const n=(e&&e[Symbol.iterator]).call(e);let r;for(;(r=n.next())&&!r.done;){const n=r.value;t.call(e,n[0],n[1])}},matchAll:(e,t)=>{let n;const r=[];for(;null!==(n=e.exec(t));)r.push(n);return r},isHTMLForm:M,hasOwnProperty:w,hasOwnProp:w,reduceDescriptors:D,freezeMethods:e=>{D(e,((t,n)=>{if(p(e)&&-1!==["arguments","caller","callee"].indexOf(n))return!1;const r=e[n];p(r)&&(t.enumerable=!1,"writable"in t?t.writable=!1:t.set||(t.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")}))}))},toObjectSet:(e,t)=>{const n={},r=e=>{e.forEach((e=>{n[e]=!0}))};return d(e)?r(e):r(String(e).split(t)),n},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,(function(e,t,n){return t.toUpperCase()+n})),noop:()=>{},toFiniteNumber:(e,t)=>(e=+e,Number.isFinite(e)?e:t),findKey:R,global:y,isContextDefined:O,ALPHABET:L,generateString:(e=16,t=L.ALPHA_DIGIT)=>{let n="";const{length:r}=t;for(;e--;)n+=t[Math.random()*r|0];return n},isSpecCompliantForm:function(e){return!!(e&&p(e.append)&&"FormData"===e[Symbol.toStringTag]&&e[Symbol.iterator])},toJSONObject:e=>{const t=new Array(10),n=(e,r)=>{if(f(e)){if(t.indexOf(e)>=0)return;if(!("toJSON"in e)){t[r]=e;const s=d(e)?[]:{};return T(e,((e,t)=>{const i=n(e,r+1);!u(i)&&(s[t]=i)})),t[r]=void 0,s}}return e};return n(e,0)}};function V(e,t,n,r,s){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=(new Error).stack,this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),s&&(this.response=s)}F.inherits(V,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:F.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const x=V.prototype,U={};function H(e){return F.isPlainObject(e)||F.isArray(e)}function j(e){return F.endsWith(e,"[]")?e.slice(0,-2):e}function G(e,t,n){return e?e.concat(t).map((function(e,t){return e=j(e),!n&&t?"["+e+"]":e})).join(n?".":""):t}["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach((e=>{U[e]={value:e}})),Object.defineProperties(V,U),Object.defineProperty(x,"isAxiosError",{value:!0}),V.from=(e,t,n,r,s,i)=>{const o=Object.create(x);return F.toFlatObject(e,o,(function(e){return e!==Error.prototype}),(e=>"isAxiosError"!==e)),V.call(o,e.message,t,n,r,s),o.cause=e,o.name=e.name,i&&Object.assign(o,i),o};const q=F.toFlatObject(F,{},null,(function(e){return/^is[A-Z]/.test(e)}));function B(e,t,n){if(!F.isObject(e))throw new TypeError("target must be an object");t=t||new FormData;const r=(n=F.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,(function(e,t){return!F.isUndefined(t[e])}))).metaTokens,s=n.visitor||l,i=n.dots,o=n.indexes,a=(n.Blob||"undefined"!=typeof Blob&&Blob)&&F.isSpecCompliantForm(t);if(!F.isFunction(s))throw new TypeError("visitor must be a function");function c(e){if(null===e)return"";if(F.isDate(e))return e.toISOString();if(!a&&F.isBlob(e))throw new V("Blob is not supported. Use a Buffer instead.");return F.isArrayBuffer(e)||F.isTypedArray(e)?a&&"function"==typeof Blob?new Blob([e]):Buffer.from(e):e}function l(e,n,s){let a=e;if(e&&!s&&"object"==typeof e)if(F.endsWith(n,"{}"))n=r?n:n.slice(0,-2),e=JSON.stringify(e);else if(F.isArray(e)&&function(e){return F.isArray(e)&&!e.some(H)}(e)||(F.isFileList(e)||F.endsWith(n,"[]"))&&(a=F.toArray(e)))return n=j(n),a.forEach((function(e,r){!F.isUndefined(e)&&null!==e&&t.append(!0===o?G([n],r,i):null===o?n:n+"[]",c(e))})),!1;return!!H(e)||(t.append(G(s,n,i),c(e)),!1)}const d=[],u=Object.assign(q,{defaultVisitor:l,convertValue:c,isVisitable:H});if(!F.isObject(e))throw new TypeError("data must be an object");return function e(n,r){if(!F.isUndefined(n)){if(-1!==d.indexOf(n))throw Error("Circular reference detected in "+r.join("."));d.push(n),F.forEach(n,(function(n,i){!0===(!(F.isUndefined(n)||null===n)&&s.call(t,n,F.isString(i)?i.trim():i,r,u))&&e(n,r?r.concat(i):[i])})),d.pop()}}(e),t}function K(e){const t={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,(function(e){return t[e]}))}function z(e,t){this._pairs=[],e&&B(e,this,t)}const J=z.prototype;function W(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Q(e,t,n){if(!t)return e;const r=n&&n.encode||W,s=n&&n.serialize;let i;if(i=s?s(t,n):F.isURLSearchParams(t)?t.toString():new z(t,n).toString(r),i){const t=e.indexOf("#");-1!==t&&(e=e.slice(0,t)),e+=(-1===e.indexOf("?")?"?":"&")+i}return e}J.append=function(e,t){this._pairs.push([e,t])},J.toString=function(e){const t=e?function(t){return e.call(this,t,K)}:K;return this._pairs.map((function(e){return t(e[0])+"="+t(e[1])}),"").join("&")};var Y=class{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){F.forEach(this.handlers,(function(t){null!==t&&e(t)}))}},X={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},$={isBrowser:!0,classes:{URLSearchParams:"undefined"!=typeof URLSearchParams?URLSearchParams:z,FormData:"undefined"!=typeof FormData?FormData:null,Blob:"undefined"!=typeof Blob?Blob:null},isStandardBrowserEnv:(()=>{let e;return("undefined"==typeof navigator||"ReactNative"!==(e=navigator.product)&&"NativeScript"!==e&&"NS"!==e)&&"undefined"!=typeof window&&"undefined"!=typeof document})(),isStandardBrowserWebWorkerEnv:"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"function"==typeof self.importScripts,protocols:["http","https","file","blob","url","data"]};function Z(e){function t(e,n,r,s){let i=e[s++];const o=Number.isFinite(+i),a=s>=e.length;return i=!i&&F.isArray(r)?r.length:i,a?(F.hasOwnProp(r,i)?r[i]=[r[i],n]:r[i]=n,!o):(r[i]&&F.isObject(r[i])||(r[i]=[]),t(e,n,r[i],s)&&F.isArray(r[i])&&(r[i]=function(e){const t={},n=Object.keys(e);let r;const s=n.length;let i;for(r=0;r<s;r++)i=n[r],t[i]=e[i];return t}(r[i])),!o)}if(F.isFormData(e)&&F.isFunction(e.entries)){const n={};return F.forEachEntry(e,((e,r)=>{t(function(e){return F.matchAll(/\w+|\[(\w*)]/g,e).map((e=>"[]"===e[0]?"":e[1]||e[0]))}(e),r,n,0)})),n}return null}const ee={"Content-Type":void 0},te={transitional:X,adapter:["xhr","http"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,s=F.isObject(e);if(s&&F.isHTMLForm(e)&&(e=new FormData(e)),F.isFormData(e))return r&&r?JSON.stringify(Z(e)):e;if(F.isArrayBuffer(e)||F.isBuffer(e)||F.isStream(e)||F.isFile(e)||F.isBlob(e))return e;if(F.isArrayBufferView(e))return e.buffer;if(F.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let i;if(s){if(n.indexOf("application/x-www-form-urlencoded")>-1)return function(e,t){return B(e,new $.classes.URLSearchParams,Object.assign({visitor:function(e,t,n,r){return $.isNode&&F.isBuffer(e)?(this.append(t,e.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},t))}(e,this.formSerializer).toString();if((i=F.isFileList(e))||n.indexOf("multipart/form-data")>-1){const t=this.env&&this.env.FormData;return B(i?{"files[]":e}:e,t&&new t,this.formSerializer)}}return s||r?(t.setContentType("application/json",!1),function(e,t,n){if(F.isString(e))try{return(0,JSON.parse)(e),F.trim(e)}catch(e){if("SyntaxError"!==e.name)throw e}return(0,JSON.stringify)(e)}(e)):e}],transformResponse:[function(e){const t=this.transitional||te.transitional,n=t&&t.forcedJSONParsing,r="json"===this.responseType;if(e&&F.isString(e)&&(n&&!this.responseType||r)){const n=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(e){if(n){if("SyntaxError"===e.name)throw V.from(e,V.ERR_BAD_RESPONSE,this,null,this.response);throw e}}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:$.classes.FormData,Blob:$.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};F.forEach(["delete","get","head"],(function(e){te.headers[e]={}})),F.forEach(["post","put","patch"],(function(e){te.headers[e]=F.merge(ee)}));var ne=te;const re=F.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),se=Symbol("internals");function ie(e){return e&&String(e).trim().toLowerCase()}function oe(e){return!1===e||null==e?e:F.isArray(e)?e.map(oe):String(e)}function ae(e,t,n,r,s){return F.isFunction(r)?r.call(this,t,n):(s&&(t=n),F.isString(t)?F.isString(r)?-1!==t.indexOf(r):F.isRegExp(r)?r.test(t):void 0:void 0)}class ce{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function s(e,t,n){const s=ie(t);if(!s)throw new Error("header name must be a non-empty string");const i=F.findKey(r,s);(!i||void 0===r[i]||!0===n||void 0===n&&!1!==r[i])&&(r[i||t]=oe(e))}const i=(e,t)=>F.forEach(e,((e,n)=>s(e,n,t)));return F.isPlainObject(e)||e instanceof this.constructor?i(e,t):F.isString(e)&&(e=e.trim())&&!/^[-_a-zA-Z]+$/.test(e.trim())?i((e=>{const t={};let n,r,s;return e&&e.split("\n").forEach((function(e){s=e.indexOf(":"),n=e.substring(0,s).trim().toLowerCase(),r=e.substring(s+1).trim(),!n||t[n]&&re[n]||("set-cookie"===n?t[n]?t[n].push(r):t[n]=[r]:t[n]=t[n]?t[n]+", "+r:r)})),t})(e),t):null!=e&&s(t,e,n),this}get(e,t){if(e=ie(e)){const n=F.findKey(this,e);if(n){const e=this[n];if(!t)return e;if(!0===t)return function(e){const t=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=n.exec(e);)t[r[1]]=r[2];return t}(e);if(F.isFunction(t))return t.call(this,e,n);if(F.isRegExp(t))return t.exec(e);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=ie(e)){const n=F.findKey(this,e);return!(!n||void 0===this[n]||t&&!ae(0,this[n],n,t))}return!1}delete(e,t){const n=this;let r=!1;function s(e){if(e=ie(e)){const s=F.findKey(n,e);!s||t&&!ae(0,n[s],s,t)||(delete n[s],r=!0)}}return F.isArray(e)?e.forEach(s):s(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const s=t[n];e&&!ae(0,this[s],s,e,!0)||(delete this[s],r=!0)}return r}normalize(e){const t=this,n={};return F.forEach(this,((r,s)=>{const i=F.findKey(n,s);if(i)return t[i]=oe(r),void delete t[s];const o=e?function(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,((e,t,n)=>t.toUpperCase()+n))}(s):String(s).trim();o!==s&&delete t[s],t[o]=oe(r),n[o]=!0})),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return F.forEach(this,((n,r)=>{null!=n&&!1!==n&&(t[r]=e&&F.isArray(n)?n.join(", "):n)})),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map((([e,t])=>e+": "+t)).join("\n")}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach((e=>n.set(e))),n}static accessor(e){const t=(this[se]=this[se]={accessors:{}}).accessors,n=this.prototype;function r(e){const r=ie(e);t[r]||(function(e,t){const n=F.toCamelCase(" "+t);["get","set","has"].forEach((r=>{Object.defineProperty(e,r+n,{value:function(e,n,s){return this[r].call(this,t,e,n,s)},configurable:!0})}))}(n,e),t[r]=!0)}return F.isArray(e)?e.forEach(r):r(e),this}}ce.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),F.freezeMethods(ce.prototype),F.freezeMethods(ce);var le=ce;function de(e,t){const n=this||ne,r=t||n,s=le.from(r.headers);let i=r.data;return F.forEach(e,(function(e){i=e.call(n,i,s.normalize(),t?t.status:void 0)})),s.normalize(),i}function ue(e){return!(!e||!e.__CANCEL__)}function he(e,t,n){V.call(this,null==e?"canceled":e,V.ERR_CANCELED,t,n),this.name="CanceledError"}F.inherits(he,V,{__CANCEL__:!0});var me=$.isStandardBrowserEnv?{write:function(e,t,n,r,s,i){const o=[];o.push(e+"="+encodeURIComponent(t)),F.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),F.isString(r)&&o.push("path="+r),F.isString(s)&&o.push("domain="+s),!0===i&&o.push("secure"),document.cookie=o.join("; ")},read:function(e){const t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}};function pe(e,t){return e&&!/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)?function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}var ve=$.isStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),t=document.createElement("a");let n;function r(n){let r=n;return e&&(t.setAttribute("href",r),r=t.href),t.setAttribute("href",r),{href:t.href,protocol:t.protocol?t.protocol.replace(/:$/,""):"",host:t.host,search:t.search?t.search.replace(/^\?/,""):"",hash:t.hash?t.hash.replace(/^#/,""):"",hostname:t.hostname,port:t.port,pathname:"/"===t.pathname.charAt(0)?t.pathname:"/"+t.pathname}}return n=r(window.location.href),function(e){const t=F.isString(e)?r(e):e;return t.protocol===n.protocol&&t.host===n.host}}():function(){return!0};function fe(e,t){let n=0;const r=function(e,t){e=e||10;const n=new Array(e),r=new Array(e);let s,i=0,o=0;return t=void 0!==t?t:1e3,function(a){const c=Date.now(),l=r[o];s||(s=c),n[i]=a,r[i]=c;let d=o,u=0;for(;d!==i;)u+=n[d++],d%=e;if(i=(i+1)%e,i===o&&(o=(o+1)%e),c-s<t)return;const h=l&&c-l;return h?Math.round(1e3*u/h):void 0}}(50,250);return s=>{const i=s.loaded,o=s.lengthComputable?s.total:void 0,a=i-n,c=r(a);n=i;const l={loaded:i,total:o,progress:o?i/o:void 0,bytes:a,rate:c||void 0,estimated:c&&o&&i<=o?(o-i)/c:void 0,event:s};l[t?"download":"upload"]=!0,e(l)}}const ge={http:null,xhr:"undefined"!=typeof XMLHttpRequest&&function(e){return new Promise((function(t,n){let r=e.data;const s=le.from(e.headers).normalize(),i=e.responseType;let o;function a(){e.cancelToken&&e.cancelToken.unsubscribe(o),e.signal&&e.signal.removeEventListener("abort",o)}F.isFormData(r)&&($.isStandardBrowserEnv||$.isStandardBrowserWebWorkerEnv)&&s.setContentType(!1);let c=new XMLHttpRequest;if(e.auth){const t=e.auth.username||"",n=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";s.set("Authorization","Basic "+btoa(t+":"+n))}const l=pe(e.baseURL,e.url);function d(){if(!c)return;const r=le.from("getAllResponseHeaders"in c&&c.getAllResponseHeaders());!function(e,t,n){const r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new V("Request failed with status code "+n.status,[V.ERR_BAD_REQUEST,V.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)}((function(e){t(e),a()}),(function(e){n(e),a()}),{data:i&&"text"!==i&&"json"!==i?c.response:c.responseText,status:c.status,statusText:c.statusText,headers:r,config:e,request:c}),c=null}if(c.open(e.method.toUpperCase(),Q(l,e.params,e.paramsSerializer),!0),c.timeout=e.timeout,"onloadend"in c?c.onloadend=d:c.onreadystatechange=function(){c&&4===c.readyState&&(0!==c.status||c.responseURL&&0===c.responseURL.indexOf("file:"))&&setTimeout(d)},c.onabort=function(){c&&(n(new V("Request aborted",V.ECONNABORTED,e,c)),c=null)},c.onerror=function(){n(new V("Network Error",V.ERR_NETWORK,e,c)),c=null},c.ontimeout=function(){let t=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded";const r=e.transitional||X;e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(new V(t,r.clarifyTimeoutError?V.ETIMEDOUT:V.ECONNABORTED,e,c)),c=null},$.isStandardBrowserEnv){const t=(e.withCredentials||ve(l))&&e.xsrfCookieName&&me.read(e.xsrfCookieName);t&&s.set(e.xsrfHeaderName,t)}void 0===r&&s.setContentType(null),"setRequestHeader"in c&&F.forEach(s.toJSON(),(function(e,t){c.setRequestHeader(t,e)})),F.isUndefined(e.withCredentials)||(c.withCredentials=!!e.withCredentials),i&&"json"!==i&&(c.responseType=e.responseType),"function"==typeof e.onDownloadProgress&&c.addEventListener("progress",fe(e.onDownloadProgress,!0)),"function"==typeof e.onUploadProgress&&c.upload&&c.upload.addEventListener("progress",fe(e.onUploadProgress)),(e.cancelToken||e.signal)&&(o=t=>{c&&(n(!t||t.type?new he(null,e,c):t),c.abort(),c=null)},e.cancelToken&&e.cancelToken.subscribe(o),e.signal&&(e.signal.aborted?o():e.signal.addEventListener("abort",o)));const u=function(e){const t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""}(l);u&&-1===$.protocols.indexOf(u)?n(new V("Unsupported protocol "+u+":",V.ERR_BAD_REQUEST,e)):c.send(r||null)}))}};F.forEach(ge,((e,t)=>{if(e){try{Object.defineProperty(e,"name",{value:t})}catch(e){}Object.defineProperty(e,"adapterName",{value:t})}}));function _e(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new he(null,e)}function Ce(e){return _e(e),e.headers=le.from(e.headers),e.data=de.call(e,e.transformRequest),-1!==["post","put","patch"].indexOf(e.method)&&e.headers.setContentType("application/x-www-form-urlencoded",!1),(e=>{e=F.isArray(e)?e:[e];const{length:t}=e;let n,r;for(let s=0;s<t&&(n=e[s],!(r=F.isString(n)?ge[n.toLowerCase()]:n));s++);if(!r){if(!1===r)throw new V(`Adapter ${n} is not supported by the environment`,"ERR_NOT_SUPPORT");throw new Error(F.hasOwnProp(ge,n)?`Adapter '${n}' is not available in the build`:`Unknown adapter '${n}'`)}if(!F.isFunction(r))throw new TypeError("adapter is not a function");return r})(e.adapter||ne.adapter)(e).then((function(t){return _e(e),t.data=de.call(e,e.transformResponse,t),t.headers=le.from(t.headers),t}),(function(t){return ue(t)||(_e(e),t&&t.response&&(t.response.data=de.call(e,e.transformResponse,t.response),t.response.headers=le.from(t.response.headers))),Promise.reject(t)}))}const Se=e=>e instanceof le?e.toJSON():e;function Ee(e,t){t=t||{};const n={};function r(e,t,n){return F.isPlainObject(e)&&F.isPlainObject(t)?F.merge.call({caseless:n},e,t):F.isPlainObject(t)?F.merge({},t):F.isArray(t)?t.slice():t}function s(e,t,n){return F.isUndefined(t)?F.isUndefined(e)?void 0:r(void 0,e,n):r(e,t,n)}function i(e,t){if(!F.isUndefined(t))return r(void 0,t)}function o(e,t){return F.isUndefined(t)?F.isUndefined(e)?void 0:r(void 0,e):r(void 0,t)}function a(n,s,i){return i in t?r(n,s):i in e?r(void 0,n):void 0}const c={url:i,method:i,data:i,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:a,headers:(e,t)=>s(Se(e),Se(t),!0)};return F.forEach(Object.keys(e).concat(Object.keys(t)),(function(r){const i=c[r]||s,o=i(e[r],t[r],r);F.isUndefined(o)&&i!==a||(n[r]=o)})),n}const Ie={};["object","boolean","number","function","string","symbol"].forEach(((e,t)=>{Ie[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}}));const Te={};Ie.transitional=function(e,t,n){function r(e,t){return"[Axios v1.3.4] Transitional option '"+e+"'"+t+(n?". "+n:"")}return(n,s,i)=>{if(!1===e)throw new V(r(s," has been removed"+(t?" in "+t:"")),V.ERR_DEPRECATED);return t&&!Te[s]&&(Te[s]=!0,console.warn(r(s," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(n,s,i)}};var Re={assertOptions:function(e,t,n){if("object"!=typeof e)throw new V("options must be an object",V.ERR_BAD_OPTION_VALUE);const r=Object.keys(e);let s=r.length;for(;s-- >0;){const i=r[s],o=t[i];if(o){const t=e[i],n=void 0===t||o(t,i,e);if(!0!==n)throw new V("option "+i+" must be "+n,V.ERR_BAD_OPTION_VALUE)}else if(!0!==n)throw new V("Unknown option "+i,V.ERR_BAD_OPTION)}},validators:Ie};const ye=Re.validators;class Oe{constructor(e){this.defaults=e,this.interceptors={request:new Y,response:new Y}}request(e,t){"string"==typeof e?(t=t||{}).url=e:t=e||{},t=Ee(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:s}=t;let i;void 0!==n&&Re.assertOptions(n,{silentJSONParsing:ye.transitional(ye.boolean),forcedJSONParsing:ye.transitional(ye.boolean),clarifyTimeoutError:ye.transitional(ye.boolean)},!1),void 0!==r&&Re.assertOptions(r,{encode:ye.function,serialize:ye.function},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase(),i=s&&F.merge(s.common,s[t.method]),i&&F.forEach(["delete","get","head","post","put","patch","common"],(e=>{delete s[e]})),t.headers=le.concat(i,s);const o=[];let a=!0;this.interceptors.request.forEach((function(e){"function"==typeof e.runWhen&&!1===e.runWhen(t)||(a=a&&e.synchronous,o.unshift(e.fulfilled,e.rejected))}));const c=[];let l;this.interceptors.response.forEach((function(e){c.push(e.fulfilled,e.rejected)}));let d,u=0;if(!a){const e=[Ce.bind(this),void 0];for(e.unshift.apply(e,o),e.push.apply(e,c),d=e.length,l=Promise.resolve(t);u<d;)l=l.then(e[u++],e[u++]);return l}d=o.length;let h=t;for(u=0;u<d;){const e=o[u++],t=o[u++];try{h=e(h)}catch(e){t.call(this,e);break}}try{l=Ce.call(this,h)}catch(e){return Promise.reject(e)}for(u=0,d=c.length;u<d;)l=l.then(c[u++],c[u++]);return l}getUri(e){return Q(pe((e=Ee(this.defaults,e)).baseURL,e.url),e.params,e.paramsSerializer)}}F.forEach(["delete","get","head","options"],(function(e){Oe.prototype[e]=function(t,n){return this.request(Ee(n||{},{method:e,url:t,data:(n||{}).data}))}})),F.forEach(["post","put","patch"],(function(e){function t(t){return function(n,r,s){return this.request(Ee(s||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:n,data:r}))}}Oe.prototype[e]=t(),Oe.prototype[e+"Form"]=t(!0)}));var Ae=Oe;class be{constructor(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");let t;this.promise=new Promise((function(e){t=e}));const n=this;this.promise.then((e=>{if(!n._listeners)return;let t=n._listeners.length;for(;t-- >0;)n._listeners[t](e);n._listeners=null})),this.promise.then=e=>{let t;const r=new Promise((e=>{n.subscribe(e),t=e})).then(e);return r.cancel=function(){n.unsubscribe(t)},r},e((function(e,r,s){n.reason||(n.reason=new he(e,r,s),t(n.reason))}))}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);-1!==t&&this._listeners.splice(t,1)}static source(){let e;return{token:new be((function(t){e=t})),cancel:e}}}var Me=be;const we={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(we).forEach((([e,t])=>{we[t]=e}));var ke=we;const De=function e(t){const n=new Ae(t),s=r(Ae.prototype.request,n);return F.extend(s,Ae.prototype,n,{allOwnKeys:!0}),F.extend(s,n,null,{allOwnKeys:!0}),s.create=function(n){return e(Ee(t,n))},s}(ne);De.Axios=Ae,De.CanceledError=he,De.CancelToken=Me,De.isCancel=ue,De.VERSION="1.3.4",De.toFormData=B,De.AxiosError=V,De.Cancel=De.CanceledError,De.all=function(e){return Promise.all(e)},De.spread=function(e){return function(t){return e.apply(null,t)}},De.isAxiosError=function(e){return F.isObject(e)&&!0===e.isAxiosError},De.mergeConfig=Ee,De.AxiosHeaders=le,De.formToJSON=e=>Z(F.isHTMLForm(e)?new FormData(e):e),De.HttpStatusCode=ke,De.default=De,e.exports=De}},t={};function n(r){var s=t[r];if(void 0!==s)return s.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e={};n.r(e),n.d(e,{fixNegotiationNeeded:()=>w,shimAddTrackRemoveTrack:()=>b,shimAddTrackRemoveTrackWithNative:()=>A,shimGetDisplayMedia:()=>E,shimGetSendersWithDtmf:()=>R,shimGetStats:()=>y,shimGetUserMedia:()=>S,shimMediaStream:()=>I,shimOnTrack:()=>T,shimPeerConnection:()=>M,shimSenderReceiverGetStats:()=>O});var t={};n.r(t),n.d(t,{shimAddTransceiver:()=>U,shimCreateAnswer:()=>G,shimCreateOffer:()=>j,shimGetDisplayMedia:()=>D,shimGetParameters:()=>H,shimGetUserMedia:()=>k,shimOnTrack:()=>P,shimPeerConnection:()=>N,shimRTCDataChannel:()=>x,shimReceiverGetStats:()=>F,shimRemoveStream:()=>V,shimSenderGetStats:()=>L});var r={};n.r(r),n.d(r,{shimAudioContext:()=>X,shimCallbacksAPI:()=>K,shimConstraints:()=>J,shimCreateOfferLegacy:()=>Y,shimGetUserMedia:()=>z,shimLocalStreamsAPI:()=>q,shimRTCIceServerUrls:()=>W,shimRemoteStreamsAPI:()=>B,shimTrackEventTransceiver:()=>Q});var s={};n.r(s),n.d(s,{removeExtmapAllowMixed:()=>ie,shimAddIceCandidateNullOrEmpty:()=>oe,shimConnectionState:()=>se,shimMaxMessageSize:()=>ne,shimParameterlessSetLocalDescription:()=>ae,shimRTCIceCandidate:()=>ee,shimRTCIceCandidateRelayProtocol:()=>te,shimSendThrowTypeError:()=>re});const i={PING:1,AUTHEN:2,MESSAGE_TYPE_RATING:14,CALL_START:26,CALL_SDP_CANDIDATE:27,CALL_STOP:28,CALL_SDP_CANDIDATE_FROM_SERVER:29,CALL_UPDATE:150,CALL_UPDATE_FROM_SERVER:151,CALL_STOP_FROM_SERVER:30,CALL_STATE:31,CALL_STATE_FROM_SERVER:32,CALL_START_FROM_SERVER:33,CALL_DTMF:34,CALL_DTMF_FROM_SERVER:35,CALL2_DTMF:145,CALL_INFO:36,CALL_INFO_FROM_SERVER:37,MSG_FROM_OTHER_DEVICE:38,PUSH_DEVICE_TOKEN_REGISTER:39,PUSH_DEVICE_TOKEN_UNREGISTER:40,CHAT_CREATE_CONVERSATION:41,CHAT_MESSAGE:42,CHAT_MESSAGE_FROM_SERVER:45,CHAT_MESSAGE_REPORT:46,CHAT_MESSAGE_REPORT_FROM_SERVER:47,CHAT_CONVERSATION_LOAD:48,CHAT_MESSAGES_LOAD:50,CHAT_CONVERSATION_CLEAR_HISTORY:51,CHAT_DELETE_CONVERSATION:52,CUSTOM_MESSAGE:54,CUSTOM_MESSAGE_FROM_SERVER:55,CHAT_GET_USERS_INFO:56,CHAT_GET_CONVERSATIONS_INFO:57,CHAT_ADD_PARTICIPANT:58,CHAT_ADD_PARTICIPANT_FROM_SERVER:59,CHAT_REMOVE_PARTICIPANT:60,CHAT_REMOVE_PARTICIPANT_FROM_SERVER:61,CHAT_DELETE_MESSAGE:62,CHAT_UPDATE_CONVERSATION:63,CHAT_ROUTE_TO_AGENT:64,CHAT_AGENT_RESPONSE:65,TIMEOUT_ROUTE_TO_AGENT:66,TIMEOUT_ROUTE_TO_QUEUE:67,END_CHAT:68,RATE_CHAT:69,UPDATE_USER_INFO:70,SEND_EMAIL_TRANSCRIPT:71,GET_CHAT_SERVICES:72,VIEW_CHAT:73,JOIN_CHAT_CUSTOMER_CARE:74,CHAT_CONVERSATION_FOR_USERS:75,CHAT_TRANSFER_TO_ANOTHER_AGENT:77,CHAT_UNREAD_CONVERSATION_COUNT:76,CHAT_CONFIRM_TRANSFER_REQUEST:78,CHAT_TRANSFER_REQUEST_FROM_ANOTHER_AGENT:79,GET_MESSAGES_INFO:80,UPDATE_USER_INFO_NOTIFICATION:81,CHAT_USER_BEGIN_TYPING:84,CHAT_USER_END_TYPING:85,CHAT_USER_BEGIN_TYPING_NOTIFICATION:86,CHAT_USER_END_TYPING_NOTIFIACTION:87,CHAT_PIN_MESSAGE:88,CHAT_AGENT_RESOLVE_CONVERSATION:94,CHAT_CONVERSATION_ATTACHMENT:95,CHAT_SET_ROLE:96,CHAT_LOAD_ALL_MESSAGES_FOR_CONVERSATIONS:97,CHAT_CONVERSATION_ENDED_NOTIFICATION:98,CHAT_REQUEST_LOAD:99,HOLD:100,TRANSFER:101,SUBSCRIBE_FROM_SERVER:102,CHANGE_ATTRIBUTE:103,OTHER_DEVICE_AUTHEN:104,CHAT_BLOCK_USER:105,CHAT_JOIN_OA_CONVERSATION:200,VIDEO_ENDPOINT_SDP:108,VIDEO_ENDPOINT_CANDIDATE:109,VIDEO_ENDPOINT_SDP_FROM_SERVER:110,VIDEO_ENDPOINT_CANDIDATE_FROM_SERVER:111,VIDEO_ENDPOINT_MAKE_ROOM:112,VIDEO_ENDPOINT_JOIN_ROOM:115,VIDEO_LEFT_ROOM:116,VIDEO_PUBLISH_TRACK:117,VIDEO_UNPUBLISH_TRACK:118,VIDEO_SUBSCRIBE_TRACK:119,VIDEO_UNSUBSCRIBE_TRACK:120,VIDEO_TRACK_ADDED_FROM_SERVER:121,VIDEO_TRACK_REMOVED_FROM_SERVER:122,VIDEO_ROOM_JOINED_FROM_SERVER:124,VIDEO_ROOM_LEFT_FROM_SERVER:125,VIDEO_ROOM_SEND_MSG:126,VIDEO_ROOM_MSG_FROM_SERVER:127,VIDEO_ROOM_MAKE_CALL:128,VIDEO_ROOM_CALL_INVITE:129,VIDEO_ROOM_CALL_INVITE_CANCEL:130,VIDEO_ROOM_CALL_STATE:131,VIDEO_ROOM_END_CALL:132,VIDEO_ROOM_END_CALL_FROM_SERVER:133,VIDEO_ROOM_CALL_STATE_FROM_SERVER:134,VIDEO_ROOM_TRANSFER_CALL:135,VIDEO_ROOM_HOLD:136,VIDEO_ROOM_ENABLE_DISABLE_AUDIO_VIDEO:138,VIDEO_ROOM_ENABLE_DISABLE_AUDIO_VIDEO_FROM_SERVER:139,VIDEO_ROOM_ENABLE_DISABLE_AUDIO_VIDEO_NOTIFICATION:140,VIDEO_ROOM_RENDER_LAYOUT_INFO:141,VIDEO_ROOM_JOIN_CALL2:142,VIDEO_ROOM_MEDIA_STATE:143,CHECK_EXIST_CALL:205};class o{constructor(){var e=[];return e.size=function(){return this.length},e.isEmpty=function(){return 0===this.length},e.containsKey=function(e){e+="";for(var t=0;t<this.length;t++)if(this[t].key===e)return t;return-1},e.get=function(e){e+="";var t=this.containsKey(e);if(t>-1)return this[t].value},e.put=function(e,t){if(e+="",-1!==this.containsKey(e))return this.get(e);this.push({key:e,value:t})},e.allKeys=function(){for(var e=[],t=0;t<this.length;t++)e.push(this[t].key);return e},e.allValues=function(){return e.map((e=>e.value))},e.allIntKeys=function(){for(var e=[],t=0;t<this.length;t++)e.push(parseInt(this[t].key));return e},e.remove=function(e){e+="";var t=this.containsKey(e);t>-1&&this.splice(t,1)},e.clear=function(){for(var e=this.allKeys(),t=0;t<e.length;t++){var n=e[t];this.remove(n)}},e}}let a=!0,c=!0;function l(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function d(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,s=r.addEventListener;r.addEventListener=function(e,r){if(e!==t)return s.apply(this,arguments);const i=e=>{const t=n(e);t&&(r.handleEvent?r.handleEvent(t):r(t))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(r,i),s.apply(this,[e,i])};const i=r.removeEventListener;r.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[t])return i.apply(this,arguments);if(!this._eventMap[t].has(n))return i.apply(this,arguments);const r=this._eventMap[t].get(n);return this._eventMap[t].delete(n),0===this._eventMap[t].size&&delete this._eventMap[t],0===Object.keys(this._eventMap).length&&delete this._eventMap,i.apply(this,[e,r])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}function u(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(a=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function h(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(c=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function m(){if("object"==typeof window){if(a)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}}function p(e,t){c&&console.warn(e+" is deprecated, please use "+t+" instead.")}function v(e){return"[object Object]"===Object.prototype.toString.call(e)}function f(e){return v(e)?Object.keys(e).reduce((function(t,n){const r=v(e[n]),s=r?f(e[n]):e[n],i=r&&!Object.keys(s).length;return void 0===s||i?t:Object.assign(t,{[n]:s})}),{}):e}function g(e,t,n){t&&!n.has(t.id)&&(n.set(t.id,t),Object.keys(t).forEach((r=>{r.endsWith("Id")?g(e,e.get(t[r]),n):r.endsWith("Ids")&&t[r].forEach((t=>{g(e,e.get(t),n)}))})))}function _(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",s=new Map;if(null===t)return s;const i=[];return e.forEach((e=>{"track"===e.type&&e.trackIdentifier===t.id&&i.push(e)})),i.forEach((t=>{e.forEach((n=>{n.type===r&&n.trackId===t.id&&g(e,n,s)}))})),s}const C=m;function S(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;const t={};return Object.keys(e).forEach((n=>{if("require"===n||"advanced"===n||"mediaSource"===n)return;const r="object"==typeof e[n]?e[n]:{ideal:e[n]};void 0!==r.exact&&"number"==typeof r.exact&&(r.min=r.max=r.exact);const s=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==r.ideal){t.optional=t.optional||[];let e={};"number"==typeof r.ideal?(e[s("min",n)]=r.ideal,t.optional.push(e),e={},e[s("max",n)]=r.ideal,t.optional.push(e)):(e[s("",n)]=r.ideal,t.optional.push(e))}void 0!==r.exact&&"number"!=typeof r.exact?(t.mandatory=t.mandatory||{},t.mandatory[s("",n)]=r.exact):["min","max"].forEach((e=>{void 0!==r[e]&&(t.mandatory=t.mandatory||{},t.mandatory[s(e,n)]=r[e])}))})),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},s=function(e,s){if(t.version>=61)return s(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){const t=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};t((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),t(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=r(e.audio)}if(e&&"object"==typeof e.video){let i=e.video.facingMode;i=i&&("object"==typeof i?i:{ideal:i});const o=t.version<66;if(i&&("user"===i.exact||"environment"===i.exact||"user"===i.ideal||"environment"===i.ideal)&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||o)){let t;if(delete e.video.facingMode,"environment"===i.exact||"environment"===i.ideal?t=["back","rear"]:"user"!==i.exact&&"user"!==i.ideal||(t=["front"]),t)return n.mediaDevices.enumerateDevices().then((n=>{let o=(n=n.filter((e=>"videoinput"===e.kind))).find((e=>t.some((t=>e.label.toLowerCase().includes(t)))));return!o&&n.length&&t.includes("back")&&(o=n[n.length-1]),o&&(e.video.deviceId=i.exact?{exact:o.deviceId}:{ideal:o.deviceId}),e.video=r(e.video),C("chrome: "+JSON.stringify(e)),s(e)}))}e.video=r(e.video)}return C("chrome: "+JSON.stringify(e)),s(e)},i=function(e){return t.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=function(e,t,r){s(e,(e=>{n.webkitGetUserMedia(e,t,(e=>{r&&r(i(e))}))}))}.bind(n),n.mediaDevices.getUserMedia){const e=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(t){return s(t,(t=>e(t).then((e=>{if(t.audio&&!e.getAudioTracks().length||t.video&&!e.getVideoTracks().length)throw e.getTracks().forEach((e=>{e.stop()})),new DOMException("","NotFoundError");return e}),(e=>Promise.reject(i(e))))))}}}function E(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&("function"==typeof t?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then((t=>{const r=n.video&&n.video.width,s=n.video&&n.video.height,i=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:i||3}},r&&(n.video.mandatory.maxWidth=r),s&&(n.video.mandatory.maxHeight=s),e.navigator.mediaDevices.getUserMedia(n)}))}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}function I(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function T(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=t=>{t.stream.addEventListener("addtrack",(n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.track.id)):{track:n.track};const s=new Event("track");s.track=n.track,s.receiver=r,s.transceiver={receiver:r},s.streams=[t.stream],this.dispatchEvent(s)})),t.stream.getTracks().forEach((n=>{let r;r=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find((e=>e.track&&e.track.id===n.id)):{track:n};const s=new Event("track");s.track=n,s.receiver=r,s.transceiver={receiver:r},s.streams=[t.stream],this.dispatchEvent(s)}))},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else d(e,"track",(e=>(e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e)))}function R(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,r){let s=n.apply(this,arguments);return s||(s=t(this,e),this._senders.push(s)),s};const r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){r.apply(this,arguments);const t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._senders=this._senders||[],n.apply(this,[e]),e.getTracks().forEach((e=>{this._senders.push(t(this,e))}))};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){this._senders=this._senders||[],r.apply(this,[e]),e.getTracks().forEach((e=>{const t=this._senders.find((t=>t.track===e));t&&this._senders.splice(this._senders.indexOf(t),1)}))}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function y(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,n,r]=arguments;if(arguments.length>0&&"function"==typeof e)return t.apply(this,arguments);if(0===t.length&&(0===arguments.length||"function"!=typeof e))return t.apply(this,[]);const s=function(e){const t={};return e.result().forEach((e=>{const n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach((t=>{n[t]=e.stat(t)})),t[n.id]=n})),t},i=function(e){return new Map(Object.keys(e).map((t=>[t,e[t]])))};if(arguments.length>=2){const r=function(e){n(i(s(e)))};return t.apply(this,[r,e])}return new Promise(((e,n)=>{t.apply(this,[function(t){e(i(s(t)))},n])})).then(n,r)}}function O(e){if(!("object"==typeof e&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>_(t,e.track,!0)))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),d(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){const e=this;return this._pc.getStats().then((t=>_(t,e.track,!1)))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const e=arguments[0];let t,n,r;return this.getSenders().forEach((n=>{n.track===e&&(t?r=!0:t=n)})),this.getReceivers().forEach((t=>(t.track===e&&(n?r=!0:n=t),t.track===e))),r||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function A(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map((e=>this._shimmedLocalStreams[e][0]))};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const r=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(r)&&this._shimmedLocalStreams[n.id].push(r):this._shimmedLocalStreams[n.id]=[n,r],r};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")}));const t=this.getSenders();n.apply(this,arguments);const r=this.getSenders().filter((e=>-1===t.indexOf(e)));this._shimmedLocalStreams[e.id]=[e].concat(r)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],r.apply(this,arguments)};const s=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach((t=>{const n=this._shimmedLocalStreams[t].indexOf(e);-1!==n&&this._shimmedLocalStreams[t].splice(n,1),1===this._shimmedLocalStreams[t].length&&delete this._shimmedLocalStreams[t]})),s.apply(this,arguments)}}function b(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return A(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const e=n.apply(this);return this._reverseStreams=this._reverseStreams||{},e.map((e=>this._reverseStreams[e.id]))};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},t.getTracks().forEach((e=>{if(this.getSenders().find((t=>t.track===e)))throw new DOMException("Track already exists.","InvalidAccessError")})),!this._reverseStreams[t.id]){const n=new e.MediaStream(t.getTracks());this._streams[t.id]=n,this._reverseStreams[n.id]=t,t=n}r.apply(this,[t])};const s=e.RTCPeerConnection.prototype.removeStream;function i(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],s=e._streams[r.id];n=n.replace(new RegExp(s.id,"g"),r.id)})),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},s.apply(this,[this._streams[e.id]||e]),delete this._reverseStreams[this._streams[e.id]?this._streams[e.id].id:e.id],delete this._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find((e=>e===t)))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find((e=>e.track===t)))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const s=this._streams[n.id];if(s)s.addTrack(t),Promise.resolve().then((()=>{this.dispatchEvent(new Event("negotiationneeded"))}));else{const r=new e.MediaStream([t]);this._streams[n.id]=r,this._reverseStreams[r.id]=n,this.addStream(r)}return this.getSenders().find((e=>e.track===t))},["createOffer","createAnswer"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){const e=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(this,[t=>{const n=i(this,t);e[0].apply(null,[n])},t=>{e[1]&&e[1].apply(null,t)},arguments[2]]):n.apply(this,arguments).then((e=>i(this,e)))}};e.RTCPeerConnection.prototype[t]=r[t]}));const o=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){let n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach((t=>{const r=e._reverseStreams[t],s=e._streams[r.id];n=n.replace(new RegExp(r.id,"g"),s.id)})),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),o.apply(this,arguments)):o.apply(this,arguments)};const a=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const e=a.get.apply(this);return""===e.type?e:i(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){if("closed"===this.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let t;this._streams=this._streams||{},Object.keys(this._streams).forEach((n=>{this._streams[n].getTracks().find((t=>e.track===t))&&(t=this._streams[n])})),t&&(1===t.getTracks().length?this.removeStream(this._reverseStreams[t.id]):t.removeTrack(e.track),this.dispatchEvent(new Event("negotiationneeded")))}}function M(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}))}function w(e,t){d(e,"negotiationneeded",(e=>{const n=e.target;if(!(t.version<72||n.getConfiguration&&"plan-b"===n.getConfiguration().sdpSemantics)||"stable"===n.signalingState)return e}))}function k(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(e,t,r){p("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(e).then(t,r)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const e=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},t=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(n){return"object"==typeof n&&"object"==typeof n.audio&&(n=JSON.parse(JSON.stringify(n)),e(n.audio,"autoGainControl","mozAutoGainControl"),e(n.audio,"noiseSuppression","mozNoiseSuppression")),t(n)},r&&r.prototype.getSettings){const t=r.prototype.getSettings;r.prototype.getSettings=function(){const n=t.apply(this,arguments);return e(n,"mozAutoGainControl","autoGainControl"),e(n,"mozNoiseSuppression","noiseSuppression"),n}}if(r&&r.prototype.applyConstraints){const t=r.prototype.applyConstraints;r.prototype.applyConstraints=function(n){return"audio"===this.kind&&"object"==typeof n&&(n=JSON.parse(JSON.stringify(n)),e(n,"autoGainControl","mozAutoGainControl"),e(n,"noiseSuppression","mozNoiseSuppression")),t.apply(this,[n])}}}}function D(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const e=new DOMException("getDisplayMedia without video constraints is undefined");return e.name="NotFoundError",e.code=8,Promise.reject(e)}return!0===n.video?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}function P(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function N(e,t){if("object"!=typeof e||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach((function(t){const n=e.RTCPeerConnection.prototype[t],r={[t](){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}};e.RTCPeerConnection.prototype[t]=r[t]}));const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[e,s,i]=arguments;return r.apply(this,[e||null]).then((e=>{if(t.version<53&&!s)try{e.forEach((e=>{e.type=n[e.type]||e.type}))}catch(t){if("TypeError"!==t.name)throw t;e.forEach(((t,r)=>{e.set(r,Object.assign({},t,{type:n[t.type]||t.type}))}))}return e})).then(s,i)}}function L(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function F(e){if("object"!=typeof e||!e.RTCPeerConnection||!e.RTCRtpSender)return;if(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const e=t.apply(this,[]);return e.forEach((e=>e._pc=this)),e}),d(e,"track",(e=>(e.receiver._pc=e.srcElement,e))),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function V(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(e){p("removeStream","removeTrack"),this.getSenders().forEach((t=>{t.track&&e.getTracks().includes(t.track)&&this.removeTrack(t)}))})}function x(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function U(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let e=arguments[1]&&arguments[1].sendEncodings;void 0===e&&(e=[]),e=[...e];const n=e.length>0;n&&e.forEach((e=>{if("rid"in e&&!/^[a-z0-9]{0,16}$/i.test(e.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in e&&!(parseFloat(e.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in e&&!(parseFloat(e.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")}));const r=t.apply(this,arguments);if(n){const{sender:t}=r,n=t.getParameters();(!("encodings"in n)||1===n.encodings.length&&0===Object.keys(n.encodings[0]).length)&&(n.encodings=e,t.sendEncodings=e,this.setParametersPromises.push(t.setParameters(n).then((()=>{delete t.sendEncodings})).catch((()=>{delete t.sendEncodings}))))}return r})}function H(e){if("object"!=typeof e||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const e=t.apply(this,arguments);return"encodings"in e||(e.encodings=[].concat(this.sendEncodings||[{}])),e})}function j(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function G(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then((()=>t.apply(this,arguments))).finally((()=>{this.setParametersPromises=[]})):t.apply(this,arguments)}}function q(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),this._localStreams.includes(e)||this._localStreams.push(e),e.getAudioTracks().forEach((n=>t.call(this,n,e))),e.getVideoTracks().forEach((n=>t.call(this,n,e)))},e.RTCPeerConnection.prototype.addTrack=function(e,...n){return n&&n.forEach((e=>{this._localStreams?this._localStreams.includes(e)||this._localStreams.push(e):this._localStreams=[e]})),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);const t=this._localStreams.indexOf(e);if(-1===t)return;this._localStreams.splice(t,1);const n=e.getTracks();this.getSenders().forEach((e=>{n.includes(e.track)&&this.removeTrack(e)}))})}}function B(e){if("object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=e=>{e.streams.forEach((e=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(e))return;this._remoteStreams.push(e);const t=new Event("addstream");t.stream=e,this.dispatchEvent(t)}))})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach((t=>{if(e._remoteStreams||(e._remoteStreams=[]),e._remoteStreams.indexOf(t)>=0)return;e._remoteStreams.push(t);const n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}))}),t.apply(e,arguments)}}}function K(e){if("object"!=typeof e||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,s=t.setLocalDescription,i=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(e,t){const r=arguments.length>=2?arguments[2]:arguments[0],s=n.apply(this,[r]);return t?(s.then(e,t),Promise.resolve()):s},t.createAnswer=function(e,t){const n=arguments.length>=2?arguments[2]:arguments[0],s=r.apply(this,[n]);return t?(s.then(e,t),Promise.resolve()):s};let a=function(e,t,n){const r=s.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r};t.setLocalDescription=a,a=function(e,t,n){const r=i.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.setRemoteDescription=a,a=function(e,t,n){const r=o.apply(this,[e]);return n?(r.then(t,n),Promise.resolve()):r},t.addIceCandidate=a}function z(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const e=t.mediaDevices,n=e.getUserMedia.bind(e);t.mediaDevices.getUserMedia=e=>n(J(e))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,r){t.mediaDevices.getUserMedia(e).then(n,r)}.bind(t))}function J(e){return e&&void 0!==e.video?Object.assign({},e,{video:f(e.video)}):e}function W(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,n){if(e&&e.iceServers){const t=[];for(let n=0;n<e.iceServers.length;n++){let r=e.iceServers[n];void 0===r.urls&&r.url?(p("RTCIceServer.url","RTCIceServer.urls"),r=JSON.parse(JSON.stringify(r)),r.urls=r.url,delete r.url,t.push(r)):t.push(e.iceServers[n])}e.iceServers=t}return new t(e,n)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function Q(e){"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Y(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);const t=this.getTransceivers().find((e=>"audio"===e.receiver.track.kind));!1===e.offerToReceiveAudio&&t?"sendrecv"===t.direction?t.setDirection?t.setDirection("sendonly"):t.direction="sendonly":"recvonly"===t.direction&&(t.setDirection?t.setDirection("inactive"):t.direction="inactive"):!0!==e.offerToReceiveAudio||t||this.addTransceiver("audio",{direction:"recvonly"}),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);const n=this.getTransceivers().find((e=>"video"===e.receiver.track.kind));!1===e.offerToReceiveVideo&&n?"sendrecv"===n.direction?n.setDirection?n.setDirection("sendonly"):n.direction="sendonly":"recvonly"===n.direction&&(n.setDirection?n.setDirection("inactive"):n.direction="inactive"):!0!==e.offerToReceiveVideo||n||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function X(e){"object"!=typeof e||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var $=n(539),Z=n.n($);function ee(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substring(2)),e.candidate&&e.candidate.length){const n=new t(e),r=Z().parseCandidate(e.candidate);for(const e in r)e in n||Object.defineProperty(n,e,{value:r[e]});return n.toJSON=function(){return{candidate:n.candidate,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex,usernameFragment:n.usernameFragment}},n}return new t(e)},e.RTCIceCandidate.prototype=t.prototype,d(e,"icecandidate",(t=>(t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t)))}function te(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||d(e,"icecandidate",(e=>{if(e.candidate){const t=Z().parseCandidate(e.candidate.candidate);"relay"===t.type&&(e.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[t.priority>>24])}return e}))}function ne(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return void 0===this._sctp?null:this._sctp}});const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,"chrome"===t.browser&&t.version>=76){const{sdpSemantics:e}=this.getConfiguration();"plan-b"===e&&Object.defineProperty(this,"sctp",{get(){return void 0===this._sctp?null:this._sctp},enumerable:!0,configurable:!0})}if(function(e){if(!e||!e.sdp)return!1;const t=Z().splitSections(e.sdp);return t.shift(),t.some((e=>{const t=Z().parseMLine(e);return t&&"application"===t.kind&&-1!==t.protocol.indexOf("SCTP")}))}(arguments[0])){const e=function(e){const t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;const n=parseInt(t[1],10);return n!=n?-1:n}(arguments[0]),n=function(e){let n=65536;return"firefox"===t.browser&&(n=t.version<57?-1===e?16384:2147483637:t.version<60?57===t.version?65535:65536:2147483637),n}(e),r=function(e,n){let r=65536;"firefox"===t.browser&&57===t.version&&(r=65535);const s=Z().matchPrefix(e.sdp,"a=max-message-size:");return s.length>0?r=parseInt(s[0].substring(19),10):"firefox"===t.browser&&-1!==n&&(r=2147483637),r}(arguments[0],e);let s;s=0===n&&0===r?Number.POSITIVE_INFINITY:0===n||0===r?Math.max(n,r):Math.min(n,r);const i={};Object.defineProperty(i,"maxMessageSize",{get:()=>s}),this._sctp=i}return n.apply(this,arguments)}}function re(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(e,t){const n=e.send;e.send=function(){const r=arguments[0],s=r.length||r.size||r.byteLength;if("open"===e.readyState&&t.sctp&&s>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const e=n.apply(this,arguments);return t(e,this),e},d(e,"datachannel",(e=>(t(e.channel,e.target),e)))}function se(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(e){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),e&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=e)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach((e=>{const n=t[e];t[e]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=e=>{const t=e.target;if(t._lastConnectionState!==t.connectionState){t._lastConnectionState=t.connectionState;const n=new Event("connectionstatechange",e);t.dispatchEvent(n)}return e},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),n.apply(this,arguments)}}))}function ie(e,t){if(!e.RTCPeerConnection)return;if("chrome"===t.browser&&t.version>=71)return;if("safari"===t.browser&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(t){if(t&&t.sdp&&-1!==t.sdp.indexOf("\na=extmap-allow-mixed")){const n=t.sdp.split("\n").filter((e=>"a=extmap-allow-mixed"!==e.trim())).join("\n");e.RTCSessionDescription&&t instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:t.type,sdp:n}):t.sdp=n}return n.apply(this,arguments)}}function oe(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&0!==n.length&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?("chrome"===t.browser&&t.version<78||"firefox"===t.browser&&t.version<68||"safari"===t.browser)&&arguments[0]&&""===arguments[0].candidate?Promise.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function ae(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&0!==n.length&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let e=arguments[0]||{};if("object"!=typeof e||e.type&&e.sdp)return n.apply(this,arguments);if(e={type:e.type,sdp:e.sdp},!e.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":e.type="offer";break;default:e.type="answer"}return e.sdp||"offer"!==e.type&&"answer"!==e.type?n.apply(this,[e]):("offer"===e.type?this.createOffer:this.createAnswer).apply(this).then((e=>n.apply(this,[e])))})}!function({window:n}={},i={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const o=m,a=function(e){const t={browser:null,version:null};if(void 0===e||!e.navigator)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=l(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||!1===e.isSecureContext&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=l(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=l(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}(n),c={browserDetails:a,commonShim:s,extractVersion:l,disableLog:u,disableWarnings:h,sdp:$};switch(a.browser){case"chrome":if(!e||!M||!i.shimChrome)return o("Chrome shim is not included in this adapter release."),c;if(null===a.version)return o("Chrome shim can not determine version, not shimming."),c;o("adapter.js shimming chrome."),c.browserShim=e,oe(n,a),ae(n),S(n,a),I(n),M(n,a),T(n),b(n,a),R(n),y(n),O(n),w(n,a),ee(n),te(n),se(n),ne(n,a),re(n),ie(n,a);break;case"firefox":if(!t||!N||!i.shimFirefox)return o("Firefox shim is not included in this adapter release."),c;o("adapter.js shimming firefox."),c.browserShim=t,oe(n,a),ae(n),k(n,a),N(n,a),P(n),V(n),L(n),F(n),x(n),U(n),H(n),j(n),G(n),ee(n),se(n),ne(n,a),re(n);break;case"safari":if(!r||!i.shimSafari)return o("Safari shim is not included in this adapter release."),c;o("adapter.js shimming safari."),c.browserShim=r,oe(n,a),ae(n),W(n),Y(n),K(n),q(n),B(n),Q(n),z(n),X(n),ee(n),te(n),ne(n,a),re(n),ie(n,a);break;default:o("Unsupported browser!")}}({window:"undefined"==typeof window?void 0:window});class ce{static isWebRTCSupported(){return!(!navigator||"undefined"==typeof navigator||!navigator.mediaDevices||void 0===navigator.mediaDevices||!navigator.mediaDevices.getUserMedia||void 0===navigator.mediaDevices.getUserMedia)}static getIceUfragFromSDP(e){if(!e)return null;var t=/a=ice-ufrag:(.*)(\r\n|\n)/g.exec(e);return null!=t&&t.length>=2?t[1]:null}static genFakeCandidate(e,t,n,r){let s=ce.getIceUfragFromSDP(e),i=null;if(null!=s&&s.length>0){if("srflx"==r)return i={sdpMLineIndex:t,candidate:"candidate:1289619645 1 udp 1686052607 115.78.95.208 47279 typ srflx raddr 10.151.102.246 rport 53870 generation 1 ufrag "+s+" network-id 1",sdpMid:n},i;if("relay"==r)return i={sdpMLineIndex:t,candidate:"candidate:3052053315 1 udp 41688831 103.35.64.216 32028 typ relay raddr 113.185.51.218 rport 31251 generation 0 ufrag "+s+" network-id 2 network-cost 10",sdpMid:n},i}return null}static getActiveClientId(){return localStorage.getItem("active_client_id")}static version(){return{version:"2.9.2",build:"2"}}static getIOSVersion(){const e=navigator.userAgent;if(/iPad|iPhone|iPod/.test(e)||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1){let e=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return e||(e=navigator.appVersion.match(/Version\/(\d+).(\d+).?(\d+)?/)),[parseInt(e[1],10),parseInt(e[2],10),parseInt(e[3]||0,10)]}return!1}static removeCodec(e,t){var n=function(e){var r=new RegExp("(a=rtpmap:(\\d*) "+t+"/90000\\r\\n)"),s=e.match(r);if(null==s||s.length<=2)return e;var i=s[2],o=e.replace(r,""),a=new RegExp("(a=rtcp-fb:"+i+".*\r\n)","g");o=o.replace(a,"");var c=new RegExp("(a=fmtp:"+i+".*\r\n)","g");o=o.replace(c,"");var l=new RegExp("(a=fmtp:(\\d*) apt="+i+"\\r\\n)"),d=o.match(l),u="";if(null!=d&&d.length>=3){u=d[2],o=o.replace(l,"");var h=new RegExp("(a=rtpmap:"+u+".*\r\n)","g");o=o.replace(h,"")}var m=/(m=video.*\r\n)/,p=o.match(m);if(null!=p){for(var v=p[0].substring(0,p[0].length-2).split(" "),f=v[0],g=1;g<v.length;g++)v[g]!=i&&v[g]!=u&&(f+=" "+v[g]);f+="\r\n",o=o.replace(m,f)}return n(o)};return n(e)}}class le{constructor(e,t,n,r,s=null){this.client=e,this.fromNumber=t,this.toNumber=n,this.custom="",this.customDataFromYourServer="",this.fromAlias=t,this.toAlias=n,this.fromInternal=!0,this.answeredOnAnotherDevice=!1,this.isVideoCall=r,this.isIncomingCall=!1,this.isAnswered=!1,this.isOnHold=!1,this.ended=!1,this.callId="",this._iceServers=null,this.toType="",this.muted=!1,this.localVideoEnabled=r,this._onMethods=new o,this.client._stringeeCalls.push(this),this.videoResolution=null,s&&(console.log("create call object with encryptPhone:",s),this.encryptPhone=s),this._pc=null,this._localStream=null,this._remoteStream=null,this._localSdp=null,this._remoteSdps=new o,this._mapListCandidates=new o,this._answeredDeviceId=null,this._setRemoteSdpOk=!1,this._mediaConnected=!1,this.microphones=[],this.speakers=[],this.cameras=[],this.audioDeviceId=null,this.videoDeviceId=null,this._checkGenCandidateTimer=null,this._sentSrflxCandidate=!1,this._callCheckExistInterval=null,this.reasonEndcall=""}makeCall(e){if(this.isIncomingCall)console.log("could not make call, this is a incoming call");else{var t=this,n={fromNumber:this.fromNumber,toNumber:this.toNumber,video:this.isVideoCall,custom:t.custom};t.encryptPhone&&(console.log("passing custom data(encrypted phone number)",t.encryptPhone),n.encryptPhone=t.encryptPhone),this.client._sendMessage(i.CALL_START,n,(function(n){var r=n.r,s=n.iceServers;delete n.iceServers,0===r?(t.callId=n.callId,t._iceServers=s,t.toType=n.toType,t.customDataFromYourServer=n.customDataFromYourServer,t._initPeerConnection(!0,e,n),t._createCallCheckExistInterval()):(t.ended=!0,e.call(t,n))}))}}answer(e){var t=this;if(this.isIncomingCall)if(this.isAnswered)console.log("Error: call has been answered");else if(this.answeredOnAnotherDevice)console.log("Error: call has been answered on other device");else{this.isAnswered=!0;var n={callId:this.callId,code:200};this.client._sendMessage(i.CALL_STATE,n,(function(n){e&&e.call(t,{r:n.r})})),t.fromInternal||t._onRemoteSDP(),t._checkAndAddCandidateFromQueue(),t._createCallCheckExistInterval()}else console.log("Error: could not answer call, this is a outgoing call")}reject(e){var t=this;if(this.isIncomingCall){t.ended=!0;var n={callId:this.callId,code:486,reasonEndcall:this.reasonEndcall};this.client._sendMessage(i.CALL_STATE,n,(function(n){e&&e.call(t,{r:n.r})})),this._freeResource(),this.onRemove()}else console.log("could not reject call, this is a outgoing call")}onRemove(){var e=this.client._stringeeCalls.indexOf(this);e>-1&&this.client._stringeeCalls.splice(e,1),this._clearCallCheckExistInterval()}ringing(e){var t=this;if(this.isIncomingCall){var n={callId:this.callId,code:180};this.client._sendMessage(i.CALL_STATE,n,(function(n){e&&e.call(t,{r:n.r})}))}else console.log("could not send ringing signal, this is a outgoing call")}hangup(e){var t=this;if(t.ended=!0,t._pc||!e){var n={callId:this.callId,reasonEndcall:this.reasonEndcall};this.client._sendMessage(i.CALL_STOP,n,(function(n){0===n.r&&(t._freeResource(),t.onRemove()),e&&e.call(t,{r:n.r})}))}else e.call(t,{r:-1})}sendInfo(e,t){var n=this,r={callId:this.callId,info:e};this.client._sendMessage(i.CALL_INFO,r,(function(e){t&&t.call(n,{r:e.r})}))}sendDtmf(e,t){var n=this,r={callId:this.callId,digits:e};this.client._sendMessage(i.CALL_DTMF,r,(function(e){t&&t.call(n,{r:e.r})}))}sendHold(e,t){var n=this,r={callId:this.callId,hold:!0,musicOnHold:e};this.client._sendMessage(i.HOLD,r,(function(e){return t&&t.call(n,{r:e.r}),0===e.r&&(n.isOnHold=!0,!0)}))}sendUnHold(e){var t=this,n={callId:this.callId,hold:!1};this.client._sendMessage(i.HOLD,n,(function(n){return e&&e.call(t,{r:n.r}),0===n.r&&(t.isOnHold=!1,!0)}))}sendTransfer(e,t){var n=this,r={callId:this.callId,to:{number:e,type:"internal",alias:e}};this.client._sendMessage(i.TRANSFER,r,(function(e){t&&t.call(n,{r:e.r})}))}_initPeerConnection(e,t,n){var r=this,s={audio:!0,video:r._buildVideoConstraints(!1)};navigator.mediaDevices.getUserMedia(s).then((function(s){t&&t.call(r,n);try{var o={iceServers:r._iceServers},a=new RTCPeerConnection(o);a.onicecandidate=function(e){r._onicecandidate(e)},a.oniceconnectionstatechange=function(e){"connected"===a.iceConnectionState?(r._mediaConnected=!0,r._callOnEvent("mediastate",{reason:"Connected",code:1})):"disconnected"===a.iceConnectionState&&r._callOnEvent("mediastate",{reason:"Disconnected",code:2})},a.ontrack=function(e){r._ontrack(e)},s.getTracks().forEach((function(e){a.addTrack(e,s)})),s.onremovetrack=function(e){console.log("=========localStream1.onremovetrack======",e)},r._pc=a,r._localStream=s,r._callOnEvent("addlocalstream",r._localStream),e?a.createOffer((function(e){r._onCreateLocalSdpSuccess(e)}),r._onCreateLocalSdpError):r._remoteSdps.size()>0&&r._onRemoteSDP(),r.ended&&(r._freeResource(),r.onRemove())}catch(e){console.log(e),r._freeResource(),r.onRemove();var c={callId:r.callId,reasonEndcall:"CREATE_PEER_CONNECTION_ERROR"};r.client._sendMessage(i.CALL_STOP,c,(function(e){})),r._callOnEvent("error",{reason:"CREATE_PEER_CONNECTION_ERROR",code:1001,moreInfo:e})}return navigator.mediaDevices.enumerateDevices()})).then((function(e){let t=1;r.microphones=[],r.speakers=[],r.cameras=[];for(let s=0;s<e.length;++s){const i=e[s];if(i.deviceId&&0!==i.deviceId.length)if("audioinput"===i.kind){var n=i.label||"Microphone "+t++;r.microphones.push({label:n,deviceId:i.deviceId})}else"audiooutput"===i.kind?(n=i.label||"Speaker "+t++,r.speakers.push({label:n,deviceId:i.deviceId})):"videoinput"===i.kind&&(n=i.label||"Camera "+t++,r.cameras.push({label:n,deviceId:i.deviceId}))}})).catch((function(e){t&&(n.r=1e3,n.message="GET_USER_MEDIA_ERROR",n.moreInfo=e,t.call(r,n)),r._getUserMediaError(e)}))}hold(){var e=this;return e._pc?e.isAnswered?e.isOnHold?(console.log("Call is on hold"),!1):(e._pc.createOffer((function(t){var n=t.sdp.replace("a=sendrecv","a=sendonly"),r={type:t.type,sdp:n},s=new RTCSessionDescription(r);e._onCreateLocalSdpSuccess(s)}),e._onCreateLocalSdpError),e.isOnHold=!0,!0):(console.log("Call not answered"),!1):(console.log("RTCPeerConnection not created"),!1)}unhold(){var e=this;return e._pc?e.isAnswered?e.isOnHold?(e._pc.createOffer((function(t){var n=t.sdp.replace("a=sendonly","a=sendrecv");n=n.replace("a=inactive","a=sendrecv");var r={type:t.type,sdp:n},s=new RTCSessionDescription(r);e._onCreateLocalSdpSuccess(s)}),e._onCreateLocalSdpError),e.isOnHold=!1,!0):(console.log("Call is not on hold"),!1):(console.log("Call not answered"),!1):(console.log("RTCPeerConnection not created"),!1)}_onRemoteSDP(){var e,t=this,n=!1;0!==t._remoteSdps.size()&&t._pc&&(e=t._remoteSdps.get(t._remoteSdps.allKeys()[0]),null!==t._answeredDeviceId&&void 0!==t._answeredDeviceId||(t._answeredDeviceId=""),"offer"===e.type&&t.fromInternal&&(n=!0),!t.fromInternal&&t.isAnswered&&(n=!0),"answer"===e.type&&t.isAnswered&&(n=!0,e=t._remoteSdps.get(t._answeredDeviceId)),t.isIncomingCall||"external"!==t.toType||(n=!0),n&&e&&(t._pc.setRemoteDescription(e,(function(){t._setRemoteSdpOk=!0,t._checkAndAddCandidateFromQueue(),"offer"===e.type&&t._pc.createAnswer().then((function(e){t._onCreateLocalSdpSuccess(e)}),t._onCreateLocalSdpError)}),(function(e){console.log("setRemoteDescription error",e)})),t._remoteSdps.clear()))}_getUserMediaError(e){this.isIncomingCall?this._callOnEvent("error",{reason:"GET_USER_MEDIA_ERROR",code:1e3,moreInfo:e}):this.client._sendMessage(i.CALL_STOP,{callId:this.callId,reasonEndcall:"GET_USER_MEDIA_ERROR"},(function(e){}))}upgradeToVideoCall(){this.isVideoCall||this._renegotiateForChangeDevice()}switchCamera(){var e=this;return!(!e.isVideoCall||e.cameras.length<2||(e.videoDeviceId?e.videoDeviceId=null:e.videoDeviceId=e.cameras[1].deviceId,e._renegotiateForChangeDevice(),0))}_renegotiateForChangeDevice(){var e=this,t={audio:!0,video:e._buildVideoConstraints(!0)};navigator.mediaDevices.getUserMedia(t).then((function(t){e._localStream.getTracks().forEach((function(e){e.stop()})),t.getTracks().forEach((function(n){e._pc.addTrack(n,t)})),e._localStream=t,e._callOnEvent("addlocalstream",e._localStream),e._pc.createOffer((function(t){e._onCreateLocalSdpSuccess(t)}),e._onCreateLocalSdpError),e.isVideoCall=!0,e.localVideoEnabled=!0})).catch((function(t){e._getUserMediaError(t)}))}_buildVideoConstraints(e){if(!e&&!this.isVideoCall)return!1;var t={deviceId:this.videoDeviceId?{exact:this.videoDeviceId}:void 0};return e?this.videoResolution?this.videoDeviceId?{width:{exact:this.videoResolution.width},height:{exact:this.videoResolution.height},deviceId:{exact:this.videoDeviceId}}:{width:{exact:this.videoResolution.width},height:{exact:this.videoResolution.height}}:t:this.isVideoCall&&this.videoResolution?this.videoDeviceId?{width:{exact:this.videoResolution.width},height:{exact:this.videoResolution.height},deviceId:{exact:this.videoDeviceId}}:{width:{exact:this.videoResolution.width},height:{exact:this.videoResolution.height}}:t}_checkAndAddCandidateFromQueue(){if(this.isAnswered&&this._pc&&this._setRemoteSdpOk){this._answeredDeviceId||(this._answeredDeviceId=this._mapListCandidates.allKeys()[0]);var e=this._mapListCandidates.get(""+this._answeredDeviceId);if(e)for(;;){var t=e.pop();if(!t)break;this._pc.addIceCandidate(t)}}}_onicecandidate(e){if(e.candidate){var t=e.candidate,n={sdpMLineIndex:t.sdpMLineIndex,candidate:t.candidate,sdpMid:t.sdpMid};(n.candidate.indexOf("srflx")>0||n.candidate.indexOf("relay")>0)&&this._checkGenCandidateTimer&&clearTimeout(this._checkGenCandidateTimer),this._sendCallSdpCandidate(this.callId,"candidate",n)}}_checkGenCandidateTimeout(e){if(e._sentSrflxCandidate)return;let t=!1;if(e.fromInternal&&"external"==e.toType&&(t=!0),!e.fromInternal&&e.isIncomingCall&&(t=!0),!t)return;e._sentSrflxCandidate=!0,console.log("++++++++++++++++++ _checkGenCandidateTimeout run..., send FAKE CANDIDATE");let n=ce.genFakeCandidate(e._localSdp.sdp,0,"0","srflx");n&&e._sendCallSdpCandidate(e.callId,"candidate",n),n=ce.genFakeCandidate(e._localSdp.sdp,0,"0","relay"),n&&e._sendCallSdpCandidate(e.callId,"candidate",n)}_ontrack(e){this._remoteStream=e.streams[0],this._callOnEvent("addremotestream",this._remoteStream)}_onCreateLocalSdpSuccess(e){var t=this;this._localSdp=e,this._checkGenCandidateTimer||(this._checkGenCandidateTimer=setTimeout(t._checkGenCandidateTimeout,1200,t)),this._pc.setLocalDescription(e,(function(){t._sendCallSdpCandidate(t.callId,"sdp",e)}),(function(e){console.log("+++++++++ setLocalDescription error",e)}))}_onCreateLocalSdpError(e){console.log(e)}_sendCallSdpCandidate(e,t,n){var r={callId:e,type:t,data:n};this.client._sendMessage(i.CALL_SDP_CANDIDATE,r,(function(e){}))}_freeResource(){if(this._pc){var e=this;this._pc.close(),this._pc=null,this._localStream&&this._localStream.getTracks().forEach((function(t){t.stop(),e._localStream.removeTrack(t)})),this._localStream=null,this._remoteStream=null,this._checkGenCandidateTimer&&clearTimeout(this._checkGenCandidateTimer)}}mute(e){var t=this;t._localStream.getAudioTracks().forEach((function(n){e?(n.enabled=!1,t.muted=!0):(n.enabled=!0,t.muted=!1)}))}enableLocalVideo(e){var t=this,n=!1;return t._localStream.getVideoTracks().forEach((function(r){n=!0,r.enabled=e,t.localVideoEnabled=e})),n}on(e,t){this._onMethods.put(e,t)}_callOnEvent(e,t){var n=this._onMethods.get(e);n?t?n.call(this,t):n.call(this):console.log("Please implement StringeeCall event: "+e)}restartIce(){var e=this;if(!e._pc)return console.log("RTCPeerConnection not created"),!1;console.log("restartIce+++++");const t={offerToReceiveAudio:1,offerToReceiveVideo:1,iceRestart:!0};return e._setLocalSdpOk||!e.isIncomingCall?(console.log("=====create offer==="),e._pc.createOffer((function(t){e._onCreateLocalSdpSuccess(t)}),e._onCreateLocalSdpError,t)):(console.log("=====create Answer==="),e._pc.createAnswer().then((function(t){e._onCreateLocalSdpSuccess(t)}),e._onCreateLocalSdpError,t)),!0}_createCallCheckExistInterval(){this._clearCallCheckExistInterval();let e=this.client;var t=this;let n={callId:t.callId};this._callCheckExistInterval=setInterval((function(){e._sendMessage(i.CHECK_EXIST_CALL,n,(function(n){if(0==n.r&&!1===n.exist){console.log("== checkExistCall == ",n,"call not exist => stop call");var r=e.findCallByCallId(n.callId);r&&r.hangup(),t._clearCallCheckExistInterval()}else console.log("== checkExistCall == ",n,"call OK => do nothing")}))}),18e4)}_clearCallCheckExistInterval(){console.log("== clearCheckExistCall =="),this._callCheckExistInterval&&clearInterval(this._callCheckExistInterval)}}class de{constructor(e,t,n){this.code=e,this.msg=t,this.jsError=n}}class ue{constructor(e){this.localId=pe.genLocalPeerConnectionId(),this.serverId="",this.pc=null,this.eventHandler=null,this.mediaConnected=!1,this.localStream=null,this.remoteStream=null,this.stopped=!1,this.iceServers=e,this.localSdp=null,this.localCandidates=new Array,this.muted=!1,this.localVideoEnabled=!1,this.localAudioEnabled=!1,this.localConstraints=null}async initPeerConnection(e,t,n,r,s=null,i=!0){let o=null;var a=this;if(this.eventHandler=n,this.localConstraints=t,null===s&&i)try{o=t.screen?navigator.getDisplayMedia?await navigator.getDisplayMedia({video:!0,audio:t.screenAudio}):navigator.mediaDevices.getDisplayMedia?await navigator.mediaDevices.getDisplayMedia({video:!0,audio:t.screenAudio}):await navigator.mediaDevices.getUserMedia({video:{mediaSource:"screen"}}):await navigator.mediaDevices.getUserMedia(t)}catch(e){throw new de(1,"getUserMediaError",e)}else o=s;try{var c=new RTCPeerConnection({iceServers:a.iceServers});if(c.onicecandidate=function(e){e.candidate&&a.localCandidates.push(e.candidate),n.onCandidate(e.candidate)},c.oniceconnectionstatechange=function(e){"connected"===c.iceConnectionState?(a.mediaConnected=!0,n.onIceConnectionStateChange(a.mediaConnected)):"disconnected"===c.iceConnectionState&&(a.mediaConnected=!1,n.onIceConnectionStateChange(a.mediaConnected))},c.ontrack=function(e){if(e.streams.length>0){a.remoteStream=e.streams[0];var t="";e.track&&(t=e.track.kind),n.onTrack(e,t)}},o&&(o.getTracks().forEach((function(e){t.screen&&(e.onended=function(){n.onTrackEnded()}),c.addTrack(e,o)})),a.localVideoEnabled=o.getVideoTracks().length>0,a.localAudioEnabled=o.getAudioTracks().length>0,a.localAudioEnabled||(this.muted=!0),a.localStream=o,t.video||c.addTransceiver("video"),t.audio||c.addTransceiver("audio")),a.pc=c,e)try{const e=await c.createOffer(r);a.localSdp=e;try{await a.pc.setLocalDescription(e)}catch(e){throw a.freeResource(),new de(4,"setLocalDescriptionError",e)}}catch(e){throw a.freeResource(),new de(3,"createOfferError",e)}return a.stopped&&a.freeResource(),a}catch(e){throw a.freeResource(),new de(2,"peerConnectionError",e)}}changeDevice(e,t){let n=this;return new Promise((function(r,s){"audio"==e?n.localConstraints.audio=t.audio:"video"==e?(t.video||(t.video=!0),n.localConstraints.video=t.video):"both"==e&&(n.localConstraints=t),navigator.mediaDevices.getUserMedia(t).then((function(t){let s=null,i=null;t.getTracks().forEach((function(e){"audio"===e.kind?s=e:"video"===e.kind&&(i=e)})),n.muted&&s&&(s.enabled=!1);var o=null,a=null,c=null;n.pc.getSenders().forEach((function(e){e.track&&"audio"===e.track.kind?o=e:e.track&&"video"===e.track.kind?a=e:null==e.track&&(c=e)})),s&&(o?o.replaceTrack(s):c&&c.replaceTrack(s)),i&&(a?a.replaceTrack(i):c&&c.replaceTrack(i)),n.localStream.getTracks().forEach((function(t){e!==t.kind&&"both"!==e||(t.stop(),n.localStream.removeTrack(t))})),s&&n.localStream.addTrack(s),i&&n.localStream.addTrack(i),r()})).catch((function(e){s(e)}))}))}async initPeerConnectionNoAccessDevice(e,t,n){return this.initPeerConnection(e,null,n,t,undefined,!1)}freeResource(){this.pc&&(this.pc.close(),this.pc=null);var e=this;this.localStream&&this.localStream.getTracks().forEach((function(t){t.stop(),e.localStream.removeTrack(t)})),this.localStream=null,this.remoteStream=null,this.eventHandler.onWebRtcClose()}onReceiveSdp(e){let t=e,n=ce.getIOSVersion();if(Array.isArray(n)&&15==n[0]&&(1==n[1]||2==n[1])){let n={type:e.type,sdp:ce.removeCodec(e.sdp,"H264")};t=new RTCSessionDescription(n)}this.pc.setRemoteDescription(t,(function(){}),(function(e){console.log("setRemoteDescription error",e)}))}onReceiveCandidate(e){this.pc.addIceCandidate(e)}async mute(e,t=null){var n=this;if(n.localStream.getAudioTracks().length>0)n.localStream.getAudioTracks().forEach((function(t){e?(t.enabled=!1,n.muted=!0):(t.enabled=!0,n.muted=!1)}));else if(!e){let e;e=t?{audio:{deviceId:{exact:t}},video:!1}:{audio:!0};let r=n.muted;try{n.muted=!1,await n.changeDevice("audio",e)}catch(e){n.muted=r,console.log("StringeeVideoTrack this.webrtc.changeDevice error ===========",e)}}}async enableLocalVideo(e){var t=this,n=!1;if(e){let e={audio:!1,video:t.localConstraints.video};try{await t.changeDevice("video",e),n=!0,t.localVideoEnabled=!0}catch(e){console.log("StringeeVideoTrack this.webrtc.changeDevice error ===========",e),n=!1}}else t.localStream.getVideoTracks().forEach((function(e){n=!0,e.stop(),t.localStream.removeTrack(e),t.localVideoEnabled=!1}));return n}}class he{constructor(e,t){this.isLocal=!0,this.roomConnected=null,this.localSdpToSend=null,this.localCandidatesForSend=new Array,this.serverId="",this.serverPeerConnectionId="",this.stringeeClient=e,this.audio=!1,this.video=!1,this.screen=!1,this.screenAudio=!1,this.mobileCamera,this.userData=null,this.constraints={},t.audio?(this.constraints.audio=!0,this.audio=!0):t.audioDeviceId=null,t.screen&&(this.constraints.screen=!0,this.screen=!0,t.screenAudio?(this.screenAudio=!0,this.constraints.screenAudio=!0,this.constraints.audio=!0,this.audio=!0):(this.screenAudio=!1,this.constraints.screenAudio=!1),this.video=!1),t.video?(this.video=!0,this.constraints.video=!0):(t.videoDeviceId=null,t.videoDimensions=null),t.videoDimensions&&(this.constraints.video=t.videoDimensions),t.videoDeviceId?(this.videoDeviceId=t.videoDeviceId,t.videoDimensions?this.constraints.video.deviceId={exact:t.videoDeviceId}:this.constraints.video={deviceId:{exact:t.videoDeviceId}}):this.videoDeviceId=null,this.constraints.video&&t.mobileCamera&&(!0===this.constraints.video&&(this.constraints.video={}),"front"==t.mobileCamera?(this.constraints.video.facingMode="user",this.mobileCamera="front"):"back"==t.mobileCamera?(this.constraints.video.facingMode="environment",this.mobileCamera="back"):""!=t.mobileCamera&&null!=t.mobileCamera&&(this.mobileCamera=null,console.log('options.mobileCamera must be: "front" or "back"'))),t.audioDeviceId?(this.audioDeviceId=t.audioDeviceId,this.constraints.audio={deviceId:{exact:t.audioDeviceId}}):this.audioDeviceId=null,this.webrtc=new ue(e.ice_servers),this.localId=this.webrtc.localId,this.onMethods=new o,this.elements=[],this.callOnReady=!1,this.muted=!1,this.localVideoEnabled=!1,this.localAudioEnabled=!1,this.audioDeviceId=null,this.speakerDeviceId=null,this.lastAudioBytesSent=-1,this.lastVideoBytesSent=-1,this.lastAudioBytesReceived=-1,this.lastVideoBytesReceived=-1,this.lastTimestampGetBytes=-1}getBW(){let e=this;return new Promise((function(t,n){let r={audioSent:0,videoSent:0,audioReceived:0,videoReceived:0};e.getStats((function(n){let s=(new Date).getTime();var i=s-e.lastTimestampGetBytes;for(var o in e.lastTimestampGetBytes=s,n){var a=n[o];"audio"===a.mediaType&&a.bytesSent&&(e.lastAudioBytesSent>-1&&(r.audioSent=Math.round(8*(a.bytesSent-e.lastAudioBytesSent)/i)),e.lastAudioBytesSent=a.bytesSent),"video"===a.mediaType&&a.bytesSent&&(e.lastVideoBytesSent>-1&&(r.videoSent=Math.round(8*(a.bytesSent-e.lastVideoBytesSent)/i)),e.lastVideoBytesSent=a.bytesSent),"audio"===a.mediaType&&a.bytesReceived&&(e.lastAudioBytesReceived>-1&&(r.audioReceived=Math.round(8*(a.bytesReceived-e.lastAudioBytesReceived)/i)),e.lastAudioBytesReceived=a.bytesReceived),"video"===a.mediaType&&a.bytesReceived&&(e.lastVideoBytesReceived>-1&&(r.videoReceived=Math.round(8*(a.bytesReceived-e.lastVideoBytesReceived)/i)),e.lastVideoBytesReceived=a.bytesReceived)}t(r)}))}))}buildConstraints(e){var t={};return e.audio?(t.audio=!0,e.audioDeviceId&&(t.audio={deviceId:{exact:e.audioDeviceId}})):e.audioDeviceId=null,e.video?t.video=!0:(e.videoDeviceId=null,e.videoDimensions=null),e.videoDimensions&&(t.video=e.videoDimensions),e.videoDeviceId&&(e.videoDimensions?t.video.deviceId={exact:e.videoDeviceId}:t.video={deviceId:{exact:e.videoDeviceId}}),t.video&&e.mobileCamera&&(!0===t.video&&(t.video={}),"front"==e.mobileCamera?t.video.facingMode="user":"back"==e.mobileCamera?t.video.facingMode="environment":""!=e.mobileCamera&&null!=e.mobileCamera&&console.log('options.mobileCamera must be: "front" or "back"')),t}async init(e=null){var t=this;let n={onTrack:function(e,n){var r=e.streams[0];t.onRemoteStream(r,n)},onIceConnectionStateChange:function(e){let n={isConnected:e,localId:t.localId,roomId:t.roomConnected.roomId,serverPcId:t.webrtc.serverId,isLocal:t.isLocal,serverTrackId:t.serverId};t.stringeeClient._sendMessage(i.VIDEO_ROOM_MEDIA_STATE,n,(function(e){})),t.callOnEvent("mediastate",n)},onCandidate:function(e){t.localCandidatesForSend.push(e),t.processSendSdpCandidate()},onTrackEnded:function(){t.callOnEvent("trackended")},onWebRtcClose:function(){}};if(t.isLocal){var r={offerToReceiveAudio:1,offerToReceiveVideo:1};await t.webrtc.initPeerConnection(!0,t.constraints,n,r,e,!0)}else r={offerToReceiveAudio:1,offerToReceiveVideo:1},await t.webrtc.initPeerConnectionNoAccessDevice(!0,r,n);t.localSdpToSend=t.webrtc.localSdp,t.processSendSdpCandidate();try{let e=await navigator.mediaDevices.enumerateDevices();t._gotDevices(e)}catch(e){console.log("++++++++ error enumerateDevices ++++++++",e)}return t.localVideoEnabled=t.webrtc.localVideoEnabled,t.localAudioEnabled=t.webrtc.localAudioEnabled,t.localAudioEnabled||(this.muted=!0),this}switchCamera(e=null){if(this.screen)return;var t=this;"front"==this.mobileCamera||""==this.mobileCamera||null==this.mobileCamera?this.mobileCamera="back":this.mobileCamera="front",this.videoDeviceId=null;let n=t.webrtc.localStream;n.getTracks().forEach((e=>{e.stop(),n.removeTrack(e)}));var r={audio:!0,video:!0,screen:!1,videoDimensions:e,videoDeviceId:null,mobileCamera:t.mobileCamera};t.changeDevice("both",null,r)}_gotDevices(e){let t=1;pe.microphones=[],pe.speakers=[],pe.cameras=[];for(let r=0;r<e.length;++r){const s=e[r];if(s.deviceId&&0!==s.deviceId.length)if("audioinput"===s.kind){var n=s.label||"Microphone "+t++;pe.microphones.push({label:n,deviceId:s.deviceId,groupId:s.groupId})}else"audiooutput"===s.kind?(n=s.label||"Speaker "+t++,pe.speakers.push({label:n,deviceId:s.deviceId,groupId:s.groupId})):"videoinput"===s.kind&&(n=s.label||"Camera "+t++,pe.cameras.push({label:n,deviceId:s.deviceId,groupId:s.groupId}))}this.onMethods.get("gotDevicesInfo")&&this.callOnEvent("gotDevicesInfo",{microphones:pe.microphones,speakers:pe.speakers,cameras:pe.cameras})}onRemoteStream(e,t){var n=this;n.callOnReady||(n.callOnReady=!0,n.callOnEvent("ready",t))}processSendSdpCandidate(){var e=this;if(this.roomConnected&&this.webrtc){if(this.localSdpToSend){var t={data:this.localSdpToSend,roomId:e.roomConnected.roomId,serverPcId:e.webrtc.serverId,isLocal:e.isLocal,serverTrackId:e.serverId};e.stringeeClient._sendMessage(i.VIDEO_ENDPOINT_SDP,t,(function(e){})),this.localSdpToSend=null}for(;this.localCandidatesForSend.length>0;){var n=this.localCandidatesForSend.pop();n&&(t={data:n,roomId:e.roomConnected.roomId,serverPcId:e.webrtc.serverId,isLocal:e.isLocal,serverTrackId:e.serverId},e.stringeeClient._sendMessage(i.VIDEO_ENDPOINT_CANDIDATE,t,(function(e){})))}}}attach(e=!1){var t="video";e&&(t="audio");var n=document.createElement(t);return n.classList.add("stringee-video-track-"+this.localId),n.srcObject=null,this.isLocal?n.srcObject=this.webrtc.localStream:n.srcObject=this.webrtc.remoteStream,n.setAttribute("autoplay","true"),n.setAttribute("playsinline","true"),this.isLocal&&(n.muted=!0),this.speakerDeviceId&&n.setSinkId(this.speakerDeviceId).then().catch((e=>{this.speakerDeviceId=null})),this.elements.push(n),n}routeAudioToSpeaker(e){var t=!1,n=this;return this.speakerDeviceId=e,this.elements.forEach((function(r){void 0!==r.sinkId?r.setSinkId(e).then().catch((e=>{n.speakerDeviceId=null})):(this.speakerDeviceId=null,t=!1)})),t}changeDevice(e,t,n=null){return new Promise(((r,s)=>{let i,o=this;if(i=n?this.buildConstraints(n):Object.assign({},this.constraints),"video"==e)i.audio=!1,i.video||(i.video={}),n||(!0===i.video&&(i.video={}),i.video.deviceId={exact:t});else if("audio"==e)i.video=!1,i.audio||(i.audio={}),n||(!0===i.audio&&(i.audio={}),i.audio.deviceId={exact:t});else if("both"!=e)return console.log('type must be "audio", "video" or "both"'),void s("type must be audio, video or both");this.webrtc.changeDevice(e,i).then((()=>{r(this.webrtc.localStream),"video"==e?o.videoDeviceId=t:o.audioDeviceId=t,o.callOnEvent("changedevice",{type:e,newDeiceId:t,newOptions:n})})).catch((e=>{console.log("StringeeVideoTrack this.webrtc.changeDevice error ===========",e),s(e)}))}))}detach(){return this.elements}detachAndRemove(){this.elements.forEach((function(e){e.remove()}))}getMediaStream(){return this.webrtc?this.isLocal?this.webrtc.localStream:this.webrtc.remoteStream:null}onSdpFromServer(e){this.webrtc&&this.webrtc.onReceiveSdp(e)}onCandidateFromServer(e){this.webrtc&&this.webrtc.onReceiveCandidate(e)}close(){this.webrtc.freeResource()}async mute(e,t=null,n=!0){if(await this.webrtc.mute(e,t),this.muted=this.webrtc.muted,this.audio=!this.muted,n&&this.roomConnected){var r={roomId:this.roomConnected.roomId,mediaType:1,enable:!e,serverTrackId:this.serverId};this.stringeeClient._sendMessage(i.VIDEO_ROOM_ENABLE_DISABLE_AUDIO_VIDEO,r,(function(e){}))}}async enableLocalVideo(e,t=!0){var n=await this.webrtc.enableLocalVideo(e);if(this.localVideoEnabled=this.webrtc.localVideoEnabled,this.video=this.localVideoEnabled,n&&t&&this.roomConnected){var r={roomId:this.roomConnected.roomId,mediaType:2,enable:e,serverTrackId:this.serverId};this.stringeeClient._sendMessage(i.VIDEO_ROOM_ENABLE_DISABLE_AUDIO_VIDEO,r,(function(e){}))}return n}disableRemoteVideo(){var e=this;return new Promise((function(t,n){if(e.roomConnected&&e.stringeeClient){console.log("disableRemoteVideo111");var r={roomId:e.roomConnected.roomId,mediaType:2,enable:!1,serverTrackId:e.serverId,disableRemote:!0};e.stringeeClient._sendMessage(i.VIDEO_ROOM_ENABLE_DISABLE_AUDIO_VIDEO,r,(function(e){console.log("this1.stringeeClient._sendMessage(VIDEO_ROOM_ENABLE_DISABLE_AUDIO_VIDEO ++++++++ = ",e),0==e.r?t():n(e)}))}else n("not connected to room")}))}disableRemoteAudio(){var e=this;return new Promise((function(t,n){if(e.roomConnected&&e.stringeeClient){console.log("disableRemoteAudio111");var r={roomId:e.roomConnected.roomId,mediaType:1,enable:!1,serverTrackId:e.serverId,disableRemote:!0};e.stringeeClient._sendMessage(i.VIDEO_ROOM_ENABLE_DISABLE_AUDIO_VIDEO,r,(function(e){console.log("this1.stringeeClient._sendMessage(VIDEO_ROOM_ENABLE_DISABLE_AUDIO_VIDEO ++++++++ = ",e),0==e.r?t():n(e)}))}else n("not connected to room")}))}on(e,t){var n=this.onMethods.get(e);n||(n=new Array,this.onMethods.put(e,n)),n.push(t)}callOnEvent(e,t){var n=this,r=this.onMethods.get(e);r?r.forEach((function(e){t?e.call(n,t):e.call(n)})):console.log("Please implement StringeeVideoTrack event: "+e)}getStats(e){if(this.webrtc&&this.webrtc.pc)if(navigator.mozGetUserMedia){var t=this.webrtc.getReceivers().find((({kind:e})=>"audio"==e));this.webrtc.getStats(t).then((function(t){var n={};t.forEach((function(e){if(("inboundrtp"==e.type||"outboundrtp"==e.type||"inbound-rtp"==e.type||"outbound-rtp"==e.type)&&(e.id.startsWith("inbound_rtp")||e.id.startsWith("outbound_rtp"))){var t={};for(var r in e)"bytesSent"!=r&&"packetsSent"!=r&&"mediaType"!=r&&"bytesReceived"!=r&&"packetsReceived"!=r&&"packetsLost"!=r||(t[r]=e[r]);n[e.id]=t}})),e(n)})).catch((function(e){console.log(e)}))}else this.webrtc.pc.getStats((function(t){var n={};t.result().forEach((function(e){if("ssrc"==e.type){var t={};e.names().forEach((function(n){"bytesSent"!=n&&"packetsSent"!=n&&"mediaType"!=n&&"bytesReceived"!=n&&"packetsReceived"!=n&&"packetsLost"!=n||(t[n]=e.stat(n))})),n[e.id]=t}})),e(n)}));else e("PC closed")}}class me{constructor(e){this.stringeeClient=e,this.roomId=null,this.tracks=new o,this.mapServerIdTracks=new o,this.onMethods=new o,this.permissionSubscribe=!1,this.permissionPublish=!1,this.permissionControlRoom=!1}publish(e,t=null){var n=this;return new Promise((function(r,s){if(e.isLocal){var o={roomId:n.roomId,localPcId:e.webrtc.localId,audio:!!e.audio,video:!!e.video,screen:!!e.constraints.screen};t&&("object"==typeof t?(o.userData=t,e.userData=t):console.log("userData is not object, ignore it")),n.stringeeClient._sendMessage(i.VIDEO_PUBLISH_TRACK,o,(function(t){0==t.r?(e.serverId=t.serverTrackId,e.webrtc.serverId=t.serverPcId,n.tracks.put(e.localId,e),n.mapServerIdTracks.put(e.serverId,e),e.roomConnected=n,r(),e.processSendSdpCandidate(),e.on("trackended",(function(){n.unpublish(e)}))):s(t)}))}else s("Could not publish remote track")}))}unpublish(e){if(e.isLocal){var t={roomId:e.roomConnected.roomId,serverTrackId:e.serverId};this.stringeeClient._sendMessage(i.VIDEO_UNPUBLISH_TRACK,t,(function(e){0==e.r&&console.info("VIDEO_UNPUBLISH_TRACK",e)}))}else console.info("Could not unpublish remote track")}subscribe(e,t){var n=this;return t||(t={audio:!0,video:!0,screen:!1}),new Promise((function(r,s){var o=n.mapServerIdTracks.get(e);if(o)r(o);else{var a=pe.genLocalPeerConnectionId(),c={roomId:n.roomId,localPcId:a,subscribeTrackId:e};n.stringeeClient._sendMessage(i.VIDEO_SUBSCRIBE_TRACK,c,(function(i){if(0==i.r){i.trackScreenSharing&&(t.video=!0);let s=new he(n.stringeeClient,t);s.serverId=e,s.isLocal=!1,s.roomConnected=n,s.localId=a,s.webrtc.localId=a,s.webrtc.serverId=i.serverPcId,s.audio=i.trackAudioEnable&&t.audio,s.video=i.trackVideoEnable&&t.video,s.screen=i.trackScreenSharing&&t.video,s.userPublish=i.userPublish,s.stringeeClientPublish=i.stringeeClientPublish,n.tracks.put(s.localId,s),n.mapServerIdTracks.put(s.serverId,s),r(s),s.init(),s.processSendSdpCandidate()}else s(i)}))}}))}unsubscribe(e){var t=this,n={roomId:t.roomId,serverTrackId:e.serverId,serverPcId:e.webrtc.serverId};t.stringeeClient._sendMessage(i.VIDEO_UNSUBSCRIBE_TRACK,n,(function(n){0==n.r&&(console.log("unsubscribe serverTrackId OK: "+e.serverId),e.close(),t.tracks.remove(e.localId),t.mapServerIdTracks.remove(e.serverId))}))}leave(e){var t=this;return t.tracks.forEach((function(e){e.value.close(),t.tracks.remove(e.localId),t.mapServerIdTracks.remove(e.serverId)})),new Promise((function(n,r){var s={roomId:t.roomId,allStringeeClient:e};t.stringeeClient._sendMessage(i.VIDEO_LEFT_ROOM,s,(function(e){pe.rooms.remove(t.roomId),0==e.r?n():r(e)}))}))}sendMessage(e){var t=this;return new Promise((function(n,r){var s={roomId:t.roomId,msg:e};t.stringeeClient._sendMessage(i.VIDEO_ROOM_SEND_MSG,s,(function(e){0==e.r?n():r(e)}))}))}onReceiveSdp1(e,t,n){var r=this.tracks.get(e);r?r.onSdpFromServer(n):console.log("StringeeVideoRoom onReceiveSdp1: Could not found localTrackId="+e)}onReceiveCandidate1(e,t,n){var r=this.tracks.get(e);r?r.onCandidateFromServer(n):console.log("StringeeVideoRoom onReceiveCandidate1: Could not found localTrackId="+e)}clearAllOnMethos(){this.onMethods.clear()}on(e,t){var n=this.onMethods.get(e);n||(n=new Array,this.onMethods.put(e,n)),n.push(t)}callOnEvent(e,t){var n=this,r=this.onMethods.get(e);r?r.forEach((function(e){t?e.call(n,t):e.call(n)})):console.log("Please implement StringeeVideoRoom event: "+e)}onTrackAdded(e){var t={info:e};this.callOnEvent("addtrack",t)}onTrackRemoved(e){var t=this.mapServerIdTracks.get(e.track.serverId),n={info:e};t&&(n.track=t,t.close(),this.mapServerIdTracks.remove(e.track.serverId)),this.callOnEvent("removetrack",n)}onRoomJoined(e){var t={info:e};this.callOnEvent("joinroom",t)}onRoomLeft(e){var t={info:e};this.callOnEvent("leaveroom",t)}onRoomMsg(e){var t={info:e};this.callOnEvent("message",t)}onTrackChangeAudioVideoEnableDisable(e){var t=this.mapServerIdTracks.get(e.track.serverId);if(t){1==e.mediaType?t.audio=e.enable:2==e.mediaType&&(t.video=e.enable),e.disableRemote&&t.isLocal&&(1!=e.mediaType||e.enable?2!=e.mediaType||e.enable||t.enableLocalVideo(!1,!1):t.mute(!0,null,!1));var n={track:t,enable:e.enable,mediaChange:1==e.mediaType?"audio":"video"};this.callOnEvent("trackmediachange",n)}}sendRenderLayoutInfo(e,t){var n=this;return new Promise((function(r,s){var o={roomId:n.roomId,layout:e,subscribedTracks:t};n.stringeeClient._sendMessage(i.VIDEO_ROOM_RENDER_LAYOUT_INFO,o,(function(e){0==e.r?r(e):s(e)}))}))}}class pe{static rooms=new o;static ID_GEN=0;static microphones=[];static speakers=[];static cameras=[];static genLocalTrackId(){if(0==pe.ID_GEN){var e=new Date;pe.ID_GEN=e.getTime()}return pe.ID_GEN++,"track-"+pe.ID_GEN}static genLocalPeerConnectionId(){if(0==pe.ID_GEN){var e=new Date;pe.ID_GEN=e.getTime()}return pe.ID_GEN++,"pc-"+pe.ID_GEN}static makeCall(e,t,n,r,s){return new Promise((function(o,a){var c={fromNumber:t,toNumber:n,video:r,custom:s};e._sendMessage(i.VIDEO_ROOM_MAKE_CALL,c,(function(t){if(console.log("res",t),0==t.r){var n=new me(e);n.roomId=t.roomId,pe.rooms.put(n.roomId,n);var r={room:n,roomToken:t.roomToken,callId:t.callId};o(r)}else a(t)}))}))}static createRoom(e){return new Promise((function(t,n){e._sendMessage(i.VIDEO_ENDPOINT_MAKE_ROOM,{},(function(r){if(0==r.r){var s=new me(e);s.roomId=r.roomId,pe.rooms.put(s.roomId,s),t(s)}else n(r)}))}))}static joinRoom(e,t){return new Promise((function(n,r){var s={roomToken:t};e._sendMessage(i.VIDEO_ENDPOINT_JOIN_ROOM,s,(function(t){if(0==t.r){var s=pe.rooms.get(t.roomId);s||(s=new me(e)),s.roomId=t.roomId,s.permissionSubscribe=t.permissionSubscribe,s.permissionPublish=t.permissionPublish,s.permissionControlRoom=t.permissionControlRoom,s.record=t.record,pe.rooms.put(s.roomId,s);var i={room:s,listTracksInfo:t.tracks,listUsersInfo:t.users,listStringeeClients:t.listStringeeClients};n(i)}else r(t)}))}))}static createLocalVideoTrack(e,t){var n;let r=new he(e,t);return r.isLocal=!0,n=r.init(),r.on("changedevice",(function(e){console.log("++++++++++localTrack changedevice",e),("both"===e.type||"video"===e.type)&&r.detach().forEach((e=>{e.srcObject=null,e.srcObject=r.webrtc.localStream}))})),n}static getDevicesInfo(){return new Promise((function(e,t){navigator.mediaDevices.enumerateDevices().then((function(t){let n=1;pe.microphones=[],pe.speakers=[],pe.cameras=[];for(let e=0;e<t.length;++e){const s=t[e];if(s.deviceId&&0!==s.deviceId.length)if("audioinput"===s.kind){var r=s.label||"Microphone "+n++;pe.microphones.push({label:r,deviceId:s.deviceId,groupId:s.groupId})}else"audiooutput"===s.kind?(r=s.label||"Speaker "+n++,pe.speakers.push({label:r,deviceId:s.deviceId,groupId:s.groupId})):"videoinput"===s.kind&&(r=s.label||"Camera "+n++,pe.cameras.push({label:r,deviceId:s.deviceId,groupId:s.groupId}))}e({microphones:pe.microphones,speakers:pe.speakers,cameras:pe.cameras})})).catch((function(e){console.log("+++++++++++++++++++++++ error enumerateDevices +++++++++++++++++++++++",e),t()}))}))}}class ve{constructor(e,t,n,r){this.client=e,this.fromNumber=t,this.toNumber=n,this.custom="",this.customDataFromYourServer="",this.fromAlias=t,this.toAlias=n,this.fromInternal=!0,this.answeredOnAnotherDevice=!1,this.isVideoCall=r,this.isIncomingCall=!1,this.isAnswered=!1,this.isOnHold=!1,this._answeredDeviceId="",this.ended=!1,this.callId="",this.room=null,this.roomToken="",this.localTracks=[],this.subscribedTracks=[],this.toType="",this.muted=!1,this.localVideoEnabled=r,this._onMethods=new o,this.client._stringeeCalls2.push(this),this.videoResolution=null,this.audioDeviceId=null,this.videoDeviceId=null,this.mobileCamera=null,this._callCheckExistInterval=null,this.reasonEndcall=""}makeCall(e){if(this.isIncomingCall)console.log("could not make call, this is a incoming call");else{var t=this,n={fromNumber:this.fromNumber,toNumber:this.toNumber,video:this.isVideoCall,custom:t.custom};t.client._sendMessage(i.VIDEO_ROOM_MAKE_CALL,n,(function(n){0==n.r&&(t.roomToken=n.roomToken,delete n.roomToken,delete n.roomId,t.callId=n.callId,t.toType=n.toType,t.customDataFromYourServer=n.customDataFromYourServer,t._createLocalVideoTrack(),t._createCallCheckExistInterval()),e.call(t,n)}))}}transferCall(e,t,n,r){var s=this,o={fromNumber:this.fromNumber,toNumber:e,toType:t,transferType:n,callId:s.callId};s.client._sendMessage(i.VIDEO_ROOM_TRANSFER_CALL,o,(function(e){r&&r.call(s,e)}))}sendHold(e=null,t){var n=this,r={hold:!0,callId:n.callId};n.client._sendMessage(i.VIDEO_ROOM_HOLD,r,(function(e){return t.call(n,e),0===e.r&&(n.isOnHold=!0,!0)}))}sendUnHold(e){var t=this,n={hold:!1,callId:t.callId};t.client._sendMessage(i.VIDEO_ROOM_HOLD,n,(function(n){return e.call(t,n),0===n.r&&(t.isOnHold=!1,!0)}))}leaveRoom(){this.room.leave(!0)}switchCameraOld(){var e=this;return pe.cameras.length<2?(console.log("StringeeVideo.cameras.length: "+pe.cameras.length),!1):("front"==this.mobileCamera||""==this.mobileCamera||null==this.mobileCamera?this.mobileCamera="back":this.mobileCamera="front",this.videoDeviceId=null,e.localTracks.forEach((function(t){t.screen||(e.room.unpublish(t),t.detachAndRemove())})),e.localTracks=e.localTracks.filter((e=>1==e.screen)),e._createLocalVideoTrack(),!0)}switchCamera(){return new Promise(((e,t)=>{var n=this;return pe.cameras.length<2?(console.log("StringeeVideo.cameras.length: "+pe.cameras.length),t("StringeeVideo.cameras.length: "+pe.cameras.length),!1):("front"==this.mobileCamera||""==this.mobileCamera||null==this.mobileCamera?this.mobileCamera="back":this.mobileCamera="front",this.videoDeviceId=null,n.localTracks.forEach((e=>{if(e.screen)return;let t=e.webrtc.localStream;t.getTracks().forEach((e=>{e.stop(),t.removeTrack(e)}))})),n.localTracks.forEach((function(r){if(!r.screen){var s=null;n.videoResolution&&(s={width:{min:n.videoResolution.width,max:n.videoResolution.width},height:{min:n.videoResolution.height,max:n.videoResolution.height}});var i={audio:!0,video:!0,screen:!1,videoDimensions:s,videoDeviceId:null,mobileCamera:n.mobileCamera};r.changeDevice("both",null,i).then((t=>{e(t)})).catch((e=>{t(e)}))}})),!0)}))}answer(e){var t=this;if(this.isIncomingCall)if(this.isAnswered)console.log("Error: call has been answered");else if(this.answeredOnAnotherDevice)console.log("Error: call has been answered on other device");else{this.isAnswered=!0;var n={callId:this.callId,code:200};this.client._sendMessage(i.VIDEO_ROOM_CALL_STATE,n,(function(n){0==n.r&&(t._createLocalVideoTrack(),t._createCallCheckExistInterval()),e&&e.call(t,{r:n.r})}))}else console.log("Error: could not answer call, this is a outgoing call")}reject(e){var t=this;if(this.isIncomingCall){t.ended=!0;var n={callId:this.callId,code:486,reasonEndcall:this.reasonEndcall};this.client._sendMessage(i.VIDEO_ROOM_CALL_STATE,n,(function(n){e&&e.call(t,{r:n.r})})),this.onRemove()}else console.log("could not reject call, this is a outgoing call")}ringing(e){var t=this;if(this.isIncomingCall){var n={callId:this.callId,code:180};this.client._sendMessage(i.VIDEO_ROOM_CALL_STATE,n,(function(n){e&&e.call(t,{r:n.r})}))}else console.log("could not send ringing signal, this is a outgoing call")}sendInfo(e,t){var n=this;("string"==typeof e||e instanceof String)&&(e={info:e}),n.room.sendMessage(e).then((function(){t.call(n,{r:0})})).catch((function(e){t.call(n,{r:1})}))}hangup(e=null,t=null){var n=this;n.ended=!0;var r={callId:this.callId};t&&("string"==typeof t?r.reason=t:"object"==typeof t&&(r={callId:this.callId,...t})),this.client._sendMessage(i.VIDEO_ROOM_END_CALL,r,(function(t){0===t.r&&n.onRemove(),e&&e.call(n,{r:t.r})}))}_joinRoom(){var e=this;return new Promise((function(t,n){pe.joinRoom(e.client,e.roomToken).then((function(n){var r=n.room;e.room=r,r.clearAllOnMethos(),r.on("joinroom",(function(e){})),r.on("leaveroom",(function(e){})),r.on("addtrack",(function(t){var n=!1;if(e.localTracks.forEach((function(e){e.serverId===t.info.track.serverId&&(n=!0)})),!n){for(var r=0;r<e.subscribedTracks.length;r++)if(e.subscribedTracks[r].serverId==t.info.track.serverId)return;e._subscribe(t.info.track)}})),r.on("removetrack",(function(t){var n=t.track;if(n){n.isLocal?(e.localTracks=e.localTracks.filter((function(e){return e.localId!==n.localId})),e._callOnEvent("removelocaltrack",n)):(e.subscribedTracks=e.subscribedTracks.filter((function(e){return e.localId!==n.localId})),e._callOnEvent("removeremotetrack",n)),n.detach().forEach((function(e){e.remove()}));for(var r=0;r<e.subscribedTracks.length;r++)e.subscribedTracks[r].serverId==n.serverId&&(e.subscribedTracks.splice(r,1),r--)}})),r.on("message",(function(t){e._callOnEvent("info",t.info)})),n.listTracksInfo.forEach((function(t){e._subscribe(t)})),t(r)})).catch((function(e){console.log("join room ERROR: ",e),n()}))}))}_createLocalVideoTrack(e=!0){var t=null;this.videoResolution&&(t={width:{min:this.videoResolution.width,max:this.videoResolution.width},height:{min:this.videoResolution.height,max:this.videoResolution.height}});var n={audio:e,video:this.isVideoCall,screen:!1,videoDimensions:t,videoDeviceId:this.videoDeviceId,mobileCamera:this.mobileCamera};/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(n.mobileCamera="front");var r=this;r.createLocalVideoTrack(n).catch((function(e){let t=e.name||e.jsError.name;console.log("create Local Video Track ERROR: ",t),"NotFoundError"===t?pe.getDevicesInfo().then((function(e){0===e.cameras.length&&(n.video=!1),0===e.microphones.length&&(n.audio=!1),r.createLocalVideoTrack(n).catch((function(e){let t=e.name||e.jsError.name;console.log("create again Local Video Track ERROR: ",t),r._callOnEvent("signalingstate",{reason:"WebRTC_"+t,code:-1,sipCode:-1,sipReason:""}),r.hangup(null,{reason:t,pubOptions:n})}))})):"NotReadableError"===t?(n.videoDimensions=-1,r.createLocalVideoTrack(n).catch((function(e){let t=e.name||e.jsError.name;console.log("create again Local Video Track ERROR: ",t),r._callOnEvent("signalingstate",{reason:"WebRTC_"+t,code:-1,sipCode:-1,sipReason:""}),r.hangup(null,{reason:t,pubOptions:n})}))):"NotAllowedError"===t?(n.video=!1,r.createLocalVideoTrack(n).catch((function(e){let t=e.name||e.jsError.name;console.log("create again Local Video Track ERROR: ",t),r._callOnEvent("signalingstate",{reason:"WebRTC_"+t,code:-1,sipCode:-1,sipReason:""}),r.hangup(null,{reason:t,pubOptions:n})}))):("OverconstrainedError"===t&&console.log("Camera không hỗ trợ độ phân giải này, vui lòng chọn độ phân giải khác"),r._callOnEvent("signalingstate",{reason:"WebRTC_"+t,code:-1,sipCode:-1,sipReason:""}),r.hangup(null,{reason:t,pubOptions:n}))}))}createLocalVideoTrack(e){var t=this;return new Promise((function(n,r){pe.createLocalVideoTrack(t.client,e).then((function(e){t.localTracks.push(e),t._callOnEvent("addlocalstream",e.webrtc.localStream,e),t._callOnEvent("addlocaltrack",e),t.room?t.room.publish(e).then((function(){})).catch((function(e){console.log("publish Local Video Track ERROR: ",e)})):t._joinRoom().then((function(t){t.publish(e).then((function(){})).catch((function(e){console.log("publish Local Video Track ERROR: ",e)}))})).catch((function(){})),n()})).catch((function(e){r(e)}))}))}startShareScreen(){var e=this;pe.createLocalVideoTrack(e.client,{audio:!0,video:!0,screen:!0,videoDimensions:null,videoDeviceId:null}).then((function(t){e.localTracks.push(t),console.log("=====websdk addlocalstream share screen=====",t.webrtc.localStream),console.log("=====websdk addlocaltrack share screen=====",t),e._callOnEvent("addlocalstream",t.webrtc.localStream,t),e._callOnEvent("addlocaltrack",t),e.room.publish(t).then((function(){})).catch((function(e){console.log("publish Local Video Track ERROR: ",e)}))})).catch((function(e){console.log("create Local Video Track ERROR: ",e)}))}_subscribe(e){var t=this;t.room.subscribe(e.serverId,{audio:!0,video:!0}).then((function(e){t.subscribedTracks.push(e),e.on("ready",(function(){t._callOnEvent("addremotestream",e.webrtc.remoteStream,e),t._callOnEvent("addremotetrack",e)})),e.on("mediastate",(function(e){t._callOnEvent("mediastate",e)}))})).catch((function(e){console.log("subscribe ERROR: ",e)}))}_unsubscribe(e){this.room.unsubscribe(e)}on(e,t){this._onMethods.put(e,t)}_callOnEvent(e,...t){var n=this._onMethods.get(e);n?t?n.call(this,...t):n.call(this):console.log("Please implement StringeeCall event: "+e)}onRemove(){var e=this.client._stringeeCalls2.indexOf(this);e>-1&&this.client._stringeeCalls2.splice(e,1),this._clearCallCheckExistInterval()}mute(e){this.localTracks.forEach((function(t){t.mute(e)})),this.muted=e}enableLocalVideo(e){var t=this;t.localTracks.forEach((function(n){n.screen||n.enableLocalVideo(e)&&(t.localVideoEnabled=e)}))}static joinCall(e,t){return new Promise((function(n,r){var s={callid:t};e._sendMessage(i.VIDEO_ROOM_JOIN_CALL2,s,(function(s){var i;0==s.r?((i=e.findCall2ByCallId(t))||((i=new ve(e,s.fromNumber,s.toNumber,!0)).callId=t,i.isIncomingCall=!0,i.fromAlias=s.fromAlias,i.toAlias=s.toAlias,i.customDataFromYourServer=s.customDataFromYourServer,i.roomToken=s.roomToken),n(i)):r(s)}))}))}sendDtmf(e,t){var n=this,r={callId:this.callId,digits:e};this.client._sendMessage(i.CALL2_DTMF,r,(function(e){t&&t.call(n,{r:e.r})}))}upgradeToVideoCall(e=!0,t=!0,n=null){var r=this;if(r.isVideoCall)return;let s=!1;if(r.localTracks.forEach((function(e){e.screen||(s=e.enableLocalVideo(t),s&&(r.isVideoCall=t,r.localVideoEnabled=t,r._callOnEvent("addlocaltrack",e)))})),e&&s){let s={type:"voice-video-call",isRequest:e,isVideo:t},o={roomId:this.room.roomId,type:t?2:1,msg:s};this.client._sendMessage(i.CALL_UPDATE,o,(function(e){n&&n.call(r,{r:e.r})}))}}_createCallCheckExistInterval(){this._clearCallCheckExistInterval();let e=this.client;var t=this;let n={callId:t.callId};this._callCheckExistInterval=setInterval((function(){e._sendMessage(i.CHECK_EXIST_CALL,n,(function(n){if(0==n.r&&!1===n.exist){console.log("== checkExistCall == ",n,"call not exist => stop call");var r=e.findCallByCallId(n.callId);r&&r.hangup(),t._clearCallCheckExistInterval()}else console.log("== checkExistCall == ",n,"call OK => do nothing")}))}),18e4)}_clearCallCheckExistInterval(){console.log("== clearCheckExistCall =="),this._callCheckExistInterval&&clearInterval(this._callCheckExistInterval)}}class fe{constructor(){}static _callSdpCandidateFromServer(e,t){var n=e.findCallByCallId(t.callId);if(n)if(n.answeredOnAnotherDevice)console.log("answeredOnAnotherDevice");else{var r=t.deviceId;if(r||(r=""),"sdp"===t.type){var s=t.data.sdp,i=s.match(/a=candidate([^\r\n]+)/g);i&&-1===s.indexOf("typ srflx")&&i.forEach((function(e){var t;t=(t=(t=(t=e.replace(" generation 0","")).replace("typ host","typ srflx")).replace("typ host","typ srflx")).replace("\n",""),t+=" raddr 172.20.1.2 rport 57527 generation 0";var n=s.indexOf(e);n>-1&&(s=[s.slice(0,n),t+"\n",s.slice(n)].join(""))}));var a={type:t.data.type,sdp:s},c=new RTCSessionDescription(a);n._remoteSdps.put(r+"",c),n._pc&&n._onRemoteSDP()}else if("candidate"===t.type){var l=new RTCIceCandidate(t.data),d=n._mapListCandidates.get(r+"");d||(d=new o,n._mapListCandidates.put(r+"",d)),d.push(l),n._checkAndAddCandidateFromQueue()}}else console.log("error could not found call for: "+t.callId)}static _callStateFromServer(e,t){var n=e.findCallByCallId(t.callId);if(n){var r=-1,s="",i=t.deviceId;i||(i=""),100===t.code?(r=1,s="Calling"):180===t.code||183===t.code?(r=2,s="Ringing"):486===t.code||603===t.code?(r=5,s="Busy here"):t.code>=400?(r=6,s="Ended"):200===t.code&&(r=3,s="Answered",n._answeredDeviceId=i),t.code>=400?n.ended=!0:200===t.code&&(n.isAnswered=!0),r>-1?n._callOnEvent("signalingstate",{reason:s,code:r,sipCode:t.code,sipReason:t.reason}):console.log("error: unknow code: "+t.code),t.code>=400?(n._freeResource(),n.onRemove()):200===t.code&&(n._pc&&n._onRemoteSDP(),n._checkAndAddCandidateFromQueue())}else console.log("error could not found call for: "+t.callId)}static _callStopFromServer(e,t){var n=e.findCallByCallId(t.callId);n?(n.ended=!0,n._freeResource(),n.onRemove(),n._callOnEvent("signalingstate",{reason:"Ended",code:6,sipCode:-1,sipReason:"Bye"})):console.log("error could not found call for: "+t.callId)}static _callStartFromServer(e,t){var n=new le(e,t.fromNumber,t.toNumber,t.video,t.customData);n._iceServers=t.iceServers,n.callId=t.callId,n.isIncomingCall=!0,n.fromAlias=t.fromAlias,n.toAlias=t.toAlias,n.fromInternal=t.fromInternal,n.customDataFromYourServer=t.customDataFromYourServer,n._initPeerConnection(!1),e._callOnEvent("incomingcall",n)}static _callInfoFromServer(e,t){var n=e.findCallByCallId(t.callId);n?n._callOnEvent("info",t.info):console.log("error could not found call for: "+t.callId)}static _videoEndPointSdpFromServer(e,t){var n=new RTCSessionDescription({type:t.data.type,sdp:t.data.sdp}),r=t.localTrackId,s=t.serverTrackId,i=pe.rooms.get(t.roomId);i?i.onReceiveSdp1(r,s,n):console.log("room not found: "+t.roomId)}static _videoEndPointCandidateFromServer(e,t){var n=new RTCIceCandidate(JSON.parse(t.data)),r=t.localTrackId,s=t.serverTrackId,i=pe.rooms.get(t.roomId);i?i.onReceiveCandidate1(r,s,n):console.log("room not found: "+t.roomId)}static _videoTrackAddedFromServer(e,t){var n=pe.rooms.get(t.roomId);n?n.onTrackAdded(t):console.log("room not found: "+t.roomId)}static _videoTrackRemovedFromServer(e,t){var n=pe.rooms.get(t.roomId);n?n.onTrackRemoved(t):console.log("room not found: "+t.roomId)}static _videoRoomJoinedFromServer(e,t){var n=pe.rooms.get(t.roomId);n?n.onRoomJoined(t):console.log("room not found: "+t.roomId)}static _videoRoomLeftFromServer(e,t){var n=pe.rooms.get(t.roomId);n?n.onRoomLeft(t):console.log("room not found: "+t.roomId)}static _videoRoomMsgFromServer(e,t){var n=pe.rooms.get(t.roomId);n?n.onRoomMsg(t):console.log("room not found: "+t.roomId)}static _videoRoomCallInviteFromServer(e,t){var n=new ve(e,t.fromNumber,t.toNumber,t.video);n.callId=t.callId,n.isIncomingCall=!0,n.fromAlias=t.fromAlias,n.toAlias=t.toAlias,n.customDataFromYourServer=t.customDataFromYourServer,n.roomToken=t.roomToken,e._callOnEvent("incomingcall2",n)}static _videoRoomCallInviteCancelFromServer(e,t){fe._call2EndFromServer(e,t)}static _call2StateFromServer(e,t){var n=e.findCall2ByCallId(t.callId);if(n){var r=-1,s="",i=t.deviceId;i||(i=""),100===t.code?(r=1,s="Calling"):180===t.code||183===t.code?(r=2,s="Ringing"):486===t.code||603===t.code?(r=5,s="Busy here"):t.code>=400?(r=6,s="Ended"):200===t.code&&(r=3,s="Answered",n._answeredDeviceId=i),t.code>=400?n.ended=!0:200===t.code&&(n.isAnswered=!0),r>-1?n._callOnEvent("signalingstate",{reason:s,code:r,sipCode:t.code,sipReason:t.reason}):console.log("error: unknow code: "+t.code),t.code>=400&&n.onRemove()}else console.log("error could not found call for: "+t.callId)}static _call2EndFromServer(e,t){var n=e.findCall2ByCallId(t.callId);if(n){var r=t.deviceId;r||(r="");n.ended=!0,n._callOnEvent("signalingstate",{reason:"Ended",code:6,sipCode:t.code,sipReason:t.reason}),n.onRemove(),n.subscribedTracks.forEach((function(e){n.room.unsubscribe(e),e.detachAndRemove()}))}else console.log("error could not found call for: "+t.callId)}static _videoRoomEnableDisableAudioVideoNotification(e,t){var n=pe.rooms.get(t.roomId);n?n.onTrackChangeAudioVideoEnableDisable(t):console.log("room not found: "+t.roomId)}}class ge{constructor(){}static _routeChatToAgent(e,t){console.log("_routeChatToAgent: "+JSON.stringify(t)),e._callOnEvent("incommingchat",t)}}class _e{static GEN_ID=0;constructor(e){this.serverAddr=e,this._onMethods=new o,this.userDisconnect=!1,this.socket=null,_e.GEN_ID++,this.id=_e.GEN_ID,this.alreadyTried=!1}clearHealthCheckInterval(){}open(){this.connect()}connect(){this.alreadyTried?console.log("SSWS: already tried, wait for 3 seconds"):(this.alreadyTried=!0,this.userDisconnect=!1,this.socket&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onclose=null,this.socket.onerror=null,this.socket.close(),this.socket=null),this.socket=new WebSocket(this.serverAddr),this.bindSocketEvents(this.socket))}bindSocketEvents(e){let t=this;e.onopen=function(e){var n=t._onMethods.get("connect");n&&n(t,e)},e.onmessage=function(e){var n=t._onMethods.get("EventPacket");n&&n(t,e.data)},e.onclose=function(e){var n=t._onMethods.get("disconnect");n&&n(t,e)},e.onerror=function(n){var r=t._onMethods.get("error");r?r(t,n):console.log("StringeeWebSocket on error",n),e.close()}}clearAllOnMethods(){this._onMethods.clear()}disconnect(){this.userDisconnect=!0,this.socket.close()}close(){this.disconnect()}on(e,t){this._onMethods.put(e,t)}send(e){if(this.socket.readyState===WebSocket.OPEN){var t=JSON.stringify(e);this.socket.send(t)}else console.log("Socket is not open. not sending anything",this.socket.readyState)}emit(e,t){this.send(t)}}class Ce{constructor(e,t){this.conv=e,this.role=t.role,this.user=t.user,this.lastMsgSeqReceived=t.lastMsgSeqReceived,this.lastMsgSeqSeen=t.lastMsgSeqSeen,this.name=t.displayName?t.displayName:"",this.avatar=t.avatarUrl?t.avatarUrl:""}}const Se={TEXT:1,PHOTO:2,VIDEO:3,AUDIO:4,FILE:5,LINK:6,CONVERSATION_CREATION:7,CONVERSATION_RENAME:8,CONTACT:10,STICKER:11,NOTIFICATION:100};class Ee{constructor(e,t){this.stringeeClient=e,this.messages=new o,this.id=t.convId,this.name=t.convName,this.isGroup=t.isGroup,this.lastUpdate=t.lastUpdate,this.created=t.created,this.unread=t.unread,this.creator=t.creator,this.pinMsgId=t.pinMsgId,this.ended=t.ended;var n=this;if(this.participants=t.participants.map((e=>new Ce(n,e))),this.lastTimeNewMsg=t.lastTimeNewMsg,this.chatStatus=t.chatStatus,this.channelType=t.channelType,this.resolved=t.resolved,this.lastSeq=t.convLastSeq,t.lastMsg){let e=new Ie(this,null);e.content=t.lastMsg,e.type=t.lastMsgType,e.id=t.lastMsgId,e.sender=t.lastMsgSender,e.channelType=t.channelType,e.seq=t.convLastSeq,this.lastMessage=e}"customData"in t&&(this.customData=t.customData),"oaId"in t&&(this.oaId=t.oaId)}getMessages(e,t,n,r){let s=this;return new Promise((function(i,o){if(!s.id||n<=0||t<0)o({r:-1,msg:"Params are invalid."});else if(s.stringeeClient.hasConnected){var a={seqGreater:e,seqSmaller:t,limit:n,sort:r,convId:s.id};s.stringeeClient._sendMessage(StringeeServiceType.CHAT_MESSAGES_LOAD,a,(function(e){var t=e.r;if(0==t){var n=e.msgs;null!=n&&(n=n.map((e=>{let t=new Ie(s,e);return s.addMsg(t,!1),t}))),i(n)}else o({r:t,msg:e.message})}))}else o({r:-2,msg:"StringeeClient is not connected to Stringee server."})}))}addMsg(e,t=!0,n=!0){let r=this;r.messages.put(e.id,e),t&&e.sender!=r.stringeeClient.userId&&(n&&r.unread++,r.markParticipantRead(e)),(null==r.lastMessage||r.lastMessage.seq<e.seq)&&(r.lastMessage=e,r.lastSeq=e.seq)}sendMessage(e,t){let n=this;return new Promise((function(r,s){if(n.stringeeClient.hasConnected&&null!=n.stringeeClient.userId)if("object"==typeof t){var i=n.stringeeClient.userId,o=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),a="web-"+i+"-"+o+"-"+Date.now().toString(),c={message:t,type:e,convId:n.id,localDbId:a};n.stringeeClient._sendMessage(StringeeServiceType.CHAT_MESSAGE,c,(function(o){var a=o.r;if(0!=a)return void s({r:a,msg:o.message});let c=new Ie(n,null);c.created=o.created,c.id=o.msgId,c.channelType=o.channelType,c.localDbId=o.localDbId,c.seq=o.seq,c.content=t,c.type=e,c.sender=i,n.addMsg(c),r(c)}))}else s({r:-2,msg:"info.message is not Object."});else s({r:-1,msg:"StringeeClient is not connected to Stringee server."})}))}markReceived(e,t=1){let n=this;return new Promise((function(r,s){if(n.stringeeClient.hasConnected&&null!=n.stringeeClient.userId){var i={lastMsgSeq:e.seq,lastMsgTimestamp:e.created,status:t,convId:n.id};n.stringeeClient._sendMessage(StringeeServiceType.CHAT_MESSAGE_REPORT,i,(function(e){var t=e.r;0==t?r(e):s({r:t,msg:e.message})}))}else s({r:-1,msg:"StringeeClient is not connected to Stringee server."})}))}getMsgBySeq(e){for(let t=0;t<this.messages.size();t++){let n=this.messages[t].value;if(n.seq===e)return n}return null}markParticipantRead(e){console.log("====markParticipantRead");var t={convId:e.conv.id,from:e.sender,status:2,lastMsgSeq:e.seq};this.stringeeClient._callOnEvent("chatmessagestate",t)}markRead(e){var t=this;if(this.participants.forEach((n=>{let r=0;n.user==t.stringeeClient.userId&&e.seq>n.lastMsgSeqSeen&&(r=n.lastMsgSeqSeen,n.lastMsgSeqReceived=e.seq,n.lastMsgSeqSeen=e.seq,t.stringeeClient._callOnEvent("changemessagestate",{oldLastMsgSeqSeen:r,participant:n,status:"MsgSeen"}))})),e.sender!=t.stringeeClient.userId)return e.seq>=t.lastMessage.seq&&(t.unread=0),this.markReceived(e,2)}endChat(){let e={convId:this.id};return new Promise(((t,n)=>{this.stringeeClient._sendMessage(StringeeServiceType.END_CHAT,e,(function(e){let r=e.r;0==r?t(e):n({r,msg:e.message})}))}))}transfer(e,t){let n={convId:this.id,customerId:t.customerId,customerName:t.customerName,toUserId:e};return new Promise(((e,t)=>{this.stringeeClient._sendMessage(StringeeServiceType.CHAT_TRANSFER_TO_ANOTHER_AGENT,n,(function(n){let r=n.r;0==r?e(n):t({r,msg:n.message})}))}))}sendChatTranscriptTo(e,t){let n={convId:this.id,email:e,domain:t};return new Promise(((e,t)=>{this.stringeeClient._sendMessage(StringeeServiceType.SEND_EMAIL_TRANSCRIPT,n,(function(n){let r=n.r;0==r?e(n):t({r,msg:n.message})}))}))}beginTyping(){const e={userId:this.stringeeClient.userId,convId:this.id};return new Promise(((t,n)=>{this.stringeeClient._sendMessage(StringeeServiceType.CHAT_USER_BEGIN_TYPING,e,(function(e){let r=e.r;0==r?t(e):n({r,msg:e.message})}))}))}endTyping(){const e={userId:this.stringeeClient.userId,convId:this.id};return new Promise(((t,n)=>{this.stringeeClient._sendMessage(StringeeServiceType.CHAT_USER_END_TYPING,e,(function(e){let r=e.r;0==r?t(e):n({r,msg:e.message})}))}))}joinOaConversation(){const e={convId:this.id};return new Promise(((t,n)=>{this.stringeeClient._sendMessage(StringeeServiceType.CHAT_JOIN_OA_CONVERSATION,e,(function(e){let r=e.r;0==r?t(e):n({r,msg:e.message})}))}))}addParticipants(e){return new Promise(((t,n)=>{if(!e||!e.length)return void n({r:-1,message:"List of users is empty"});let r={convId:this.id,userIds:e};this.stringeeClient._sendMessage(StringeeServiceType.CHAT_ADD_PARTICIPANT,r,(e=>{0===e.r?t(e):n(e)}))}))}removeParticipants(e){return new Promise(((t,n)=>{if(!e||!e.length)return void n({r:-1,message:"List of users is empty"});let r={convId:this.id,userIds:e};this.stringeeClient._sendMessage(StringeeServiceType.CHAT_REMOVE_PARTICIPANT,r,(e=>{0===e.r?t(e):n(e)}))}))}updateConversation(e){return new Promise(((t,n)=>{if(!e||"object"==typeof e&&0===Object.keys(e).length)n({r:-1,message:"params empty"});else{var r={convId:this.id};e.name&&(r.groupName=e.name),e.avatar&&(r.imageUrl=e.avatar),this.stringeeClient._sendMessage(StringeeServiceType.CHAT_UPDATE_CONVERSATION,r,(e=>{0===e.r?t(e):n(e)}))}}))}deleteConversation(){return new Promise(((e,t)=>{const n={convId:this.id,seq:this.lastSeq};this.stringeeClient._sendMessage(StringeeServiceType.CHAT_DELETE_CONVERSATION,n,(n=>{0===n.r?e(n):t(n)}))}))}deleteMessage(e){return new Promise(((t,n)=>{if(!e)return void n({r:-1,message:"params empty"});const r={convId:this.id,messageIds:[e]};this.stringeeClient._sendMessage(StringeeServiceType.CHAT_DELETE_MESSAGE,r,(e=>{0===e.r?t(e):n(e)}))}))}clearHistory(e){return new Promise(((t,n)=>{if(!e)return void n({r:-1,message:"params empty"});const r={convId:this.id,seq:e};this.stringeeClient._sendMessage(StringeeServiceType.CHAT_CONVERSATION_CLEAR_HISTORY,r,(e=>{0===e.r?t(e):n(e)}))}))}getAttachmentMessages(e,t=0,n=20){return new Promise(((r,s)=>{if(!this.id||!e||![Se.PHOTO,Se.VIDEO,Se.AUDIO,Se.FILE,Se.LINK].includes(e)||n<=0)return void s({r:-1,msg:"Params are invalid."});if(!this.stringeeClient.hasConnected)return void s({r:-2,msg:"StringeeClient is not connected to Stringee server."});const i={convId:this.id,msgType:e,start:t,limit:n};this.stringeeClient._sendMessage(StringeeServiceType.CHAT_CONVERSATION_ATTACHMENT,i,(e=>{var t=e.r;if(0==t){var n=e.msgs;null!=n&&(n=n.map((e=>new Ie(this,e)))),r(n)}else s({r:t,msg:e.message})}))}))}setChatRole(e,t){return new Promise(((n,r)=>{if(!this.id||!e||!["member","admin"].includes(t))return void r({r:-1,msg:"Params are invalid."});if(!this.stringeeClient.hasConnected)return void r({r:-2,msg:"StringeeClient is not connected to Stringee server."});const s={convId:this.id,userId:e,role:t};this.stringeeClient._sendMessage(StringeeServiceType.CHAT_SET_ROLE,s,(e=>{var t=e.r;0==t?n(e):r({r:t,msg:e.message})}))}))}pinMessage(e,t=!0){return new Promise(((n,r)=>{if(!this.id||!e)return void r({r:-1,msg:"Params are invalid."});if(!this.stringeeClient.hasConnected)return void r({r:-2,msg:"StringeeClient is not connected to Stringee server."});const s={convId:this.id,msgId:e,isPin:t};this.stringeeClient._sendMessage(StringeeServiceType.CHAT_PIN_MESSAGE,s,(t=>{var s=t.r;0==s?(this.pinMsgId=e,n(t)):r({r:s,msg:t.message})}))}))}getMessagesByIds(e){return new Promise(((t,n)=>{if(!this.id||!Array.isArray(e)||!e.length)return void n({r:-1,message:"List of messages id is empty"});if(!this.stringeeClient.hasConnected)return void n({r:-2,msg:"StringeeClient is not connected to Stringee server."});const r={convId:this.id,msgIds:e.join(",")};this.stringeeClient._sendMessage(StringeeServiceType.GET_MESSAGES_INFO,r,(e=>{var r=e.r;if(0==r){var s=e.listMsgs;null!=s&&(s=s.map((e=>{let t=new Ie(this,e);return this.addMsg(t,!1),t}))),t(s)}else n({r,msg:e.message})}))}))}}class Ie{constructor(e,t){this.stringeeClient=e.stringeeClient,this.conv=e,t&&(this.created=t.created,this.localDbId=t.localDbId,this.channelType=t.channelType,this.id=t.id,this.type=t.type,this.sender=t.user,t.senderInfo&&(this.senderInfo=t.senderInfo),this.seq=t.seq,this.content=t.content,this.deletedStatus=t.deletedStatus)}}class Te{constructor(e,t){this.stringeeClient=e,this.convId=t.convId,this.customerId=t.customerId,this.customerName=t.customerName,this.channelType=t.channelType,this.type=t.type}acceptRequest(){return new Promise(((e,t)=>{let n={answer:!0,channelType:this.channelType,convId:this.convId},r=i.CHAT_AGENT_RESPONSE;"transfer"===this.type&&(r=i.CHAT_CONFIRM_TRANSFER_REQUEST),this.stringeeClient._sendMessage(r,n,(function(n){let r=n.r;0==r?e(n):t({r,msg:n.message})}))}))}rejectRequest(){return new Promise(((e,t)=>{let n={answer:!1,channelType:this.channelType,convId:this.convId},r=i.CHAT_AGENT_RESPONSE;"transfer"===this.type&&(r=i.CHAT_CONFIRM_TRANSFER_REQUEST),this.stringeeClient._sendMessage(r,n,(function(n){let r=n.r;0==r?e(n):t({r,msg:n.message})}))}))}}class Re{constructor(e){this.userId=e.user,this.name=e.displayName,this.avatar=e.avatarUrl,null!=e.lastMsgSeqReceived&&(this.lastMsgSeqReceived=e.lastMsgSeqReceived),null!=e.lastMsgSeqSeen&&(this.lastMsgSeqSeen=e.lastMsgSeqSeen),this.browser=e.browser,this.device=e.device,this.email=e.email,this.hostname=e.hostname,this.ipaddress=e.ipaddress,this.location=e.location,this.phone=e.phone,this.platform=e.platform,this.useragent=e.useragent}}class ye{static conversations=new o;static chatRequests=new o;static inited=!1;static getListConversations(e,t,n,r,s=null,o=null){return new Promise((function(a,c){if(r<=0||n<=0)c({r:-2,msg:"Params are invalid."});else if(e.hasConnected){var l={lastUpdateGreater:t,lastUpdateSmaller:n,limit:r};s&&(l.oaId=s),o&&"ended"in o&&(l.ended=o.ended),o&&"channelTypes"in o&&Array.isArray(o.channelTypes)&&(l.channelTypes=o.channelTypes),e._sendMessage(i.CHAT_CONVERSATION_LOAD,l,(function(t){var n=t.r;if(0==n){var r=t.listConvs;null!=r&&(r=r.map((t=>{let n=new Ee(e,t);return ye.conversations.put(n.id,n),n}))),a(r)}else c({r:n,msg:t.message})}))}else c({r:-1,msg:"StringeeClient is not connected to Stringee server."})}))}static getConversationsByIds(e,t){return new Promise((function(n,r){if(t)if(e.hasConnected){var s={convIds:t.join(",")};e._sendMessage(i.CHAT_GET_CONVERSATIONS_INFO,s,(function(t){var s=t.r;if(0==s){var i=t.listConvs;null!=i&&(i=i.map((t=>{let n=new Ee(e,t);return ye.conversations.put(n.id,n),n}))),n(i)}else r({r:s,msg:t.message})}))}else r({r:-1,message:"StringeeClient is not connected to Stringee server."});else r({r:-1,message:"Conversaion's Id is invalid"})}))}static init(e){ye.inited=!0,e.on("chatmessage2",(function(t){let n=ye.conversations.get(t.convId);if(n){let r=new Ie(n,null);r.created=t.createdTime,r.sender=t.from,r.id=t.msgId,r.channelType=t.channelType,r.type=t.type,r.seq=t.seq,r.content=t.message,r.senderInfo={avatar_url:t.avatarUrl??"",display_name:t.displayName??"",user:t.from??""},n.addMsg(r),e._callOnEvent("addchatmessage",r)}else ye.getConversationsByIds(e,[t.convId]).then((r=>{console.log("StringeeChat2.getConversationsByIds",r),n=r[0],ye.conversations.put(n.id,n);let s=new Ie(n,null);s.created=t.createdTime,s.sender=t.from,s.id=t.msgId,s.channelType=t.channelType,s.type=t.type,s.seq=t.seq,s.content=t.message,s.senderInfo={avatar_url:t.avatarUrl??"",display_name:t.displayName??"",user:t.from??""},n.addMsg(s,!0,!1),e._callOnEvent("addchatmessage",s)})).catch((e=>{console.log(e)}))})),e.on("chatmessagestate2",(function(t){let n=ye.conversations.get(t.convId);if(n)for(let s=0;s<n.participants.length;s++){let i=n.participants[s];if(i.user===t.from){if(1==t.status&&t.lastMsgSeq>i.lastMsgSeqReceived){let n=i.lastMsgSeqReceived;i.lastMsgSeqReceived=t.lastMsgSeq,e._callOnEvent("changemessagestate",{oldLastMsgSeqReceived:n,participant:i,type:"MsgReceived"})}else if(2==t.status&&t.lastMsgSeq>i.lastMsgSeqSeen){var r=i.lastMsgSeqSeen;i.lastMsgSeqSeen=t.lastMsgSeq,e._callOnEvent("changemessagestate",{oldLastMsgSeqSeen:r,participant:i,status:"MsgSeen"})}break}}})),e.on("incommingchat2",(t=>{const n={convId:t.convId,customerId:t.customerId,customerName:t.customerName,channelType:t.channelType,type:"normal"},r=ye.createChatRequest(e,n);r&&(e._callOnEvent("receiveChatRequest",r),ye.chatRequests.put(t.convId,r))})),e.on("transferChatRequest2",(t=>{const n={convId:t.convId,customerId:t.customerId,customerName:t.customerName,channelType:t.channelType,type:"transfer"},r=ye.createChatRequest(e,n);r&&(e._callOnEvent("receiveTransferChatRequest",r),ye.chatRequests.put(t.convId,r))})),e.on("chatAgentResponse2",(e=>{0===e.r&&ye.chatRequests.remove(e.convId)})),e.on("chatConfirmTransferResponse2",(e=>{0===e.r&&ye.chatRequests.remove(e.convId)}))}static createConversation(e,t,n){let r=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15);return new Promise((function(s,o){if(void 0!==t&&null!=t)if(e.hasConnected){var a;a=null==n.name||0===n.name.length?"":n.name;var c={distinct:n.isDistinct,isGroup:n.isGroup,name:a,participants:t,customField:{},localDbId:r};n.customData&&(c.customData=n.customData),n.oaId&&(c.oaId=n.oaId),n.channelType&&(c.channelType=n.channelType),e._sendMessage(i.CHAT_CREATE_CONVERSATION,c,(function(t){var n=t.r;if(0!=n&&2!=n)return void o({r:n,msg:t.message});t.convName=a,t.created=Date.now(),t.unread=0,t.creator=e.userId,t.convLastSeq=t.lastMsg.seq;let r=t.lastMsg;t.lastMsg=null;let i=new Ee(e,t),c=new Ie(i,null);c.content=r.content,c.type=r.type,c.id=r.id,c.seq=r.seq,c.created=r.created,c.sender=r.user,c.channelType=r.channelType,c.localDbId=r.localDbId,c.senderInfo=r.senderInfo??{},i.lastMessage=c,s(i)}))}else o({r:-2,message:"StringeeClient is not connected to Stringee server."});else o({r:-1,message:"UserIds are invalid"})}))}static createLiveChatConversation(e,t=null,n=null,r=null){if(!t)return new Promise(((e,t)=>{t()}));let s={isDistinct:!1,isGroup:!0,name:t,customData:n,oaId:r};return ye.createConversation(e,[],s)}static updateUserInfo(e,t){return new Promise((function(n,r){e.hasConnected?e._sendMessage(i.UPDATE_USER_INFO,t,(function(e){let t=e.r;0==t?n(e):r({r:t,msg:e.message})})):r({r:-2,message:"StringeeClient is not connected to Stringee server."})}))}static getMessages(e,t,n,r="DESC",s,o){return new Promise(((a,c)=>{if(s<=0||n<=0)return void c({r:-2,msg:"Params are invalid."});if(!e.hasConnected)return void c({r:-1,msg:"StringeeClient is not connected to Stringee server."});o=o.join(",");const l={createdGreater:t,createdSmaller:n,sort:r,limit:s,convIds:o};e._sendMessage(i.CHAT_LOAD_ALL_MESSAGES_FOR_CONVERSATIONS,l,(function(e){let t=e.r;if(0!=t)return void c({r:t,msg:e.message});const n=e.msgs;let r=[];null!=n&&(r=n.map((e=>{let t=ye.conversations.get(e.convId);return new Ie(t,e)}))),a(r)}))}))}static createChatRequest(e,t){if(!t.convId||!t.channelType)return!1;const{convId:n,customerId:r,customerName:s,channelType:i,type:o}=t;return new Te(e,{convId:n,customerId:r,customerName:s,channelType:i,type:o})}static loadAllChatRequest(e){return new Promise(((t,n)=>{e._sendMessage(i.CHAT_REQUEST_LOAD,{},(function(r){let s=r.r;if(0!=s)return void n({r:s,msg:r.message});const i=r.chatRequests;let o=[];null!=i&&i.forEach((t=>{if(-1===ye.chatRequests.containsKey(t.convId)){let n=new Te(e,t);ye.chatRequests.put(t.convId,n),o.push(n)}})),t(o)}))}))}static getConversationWithUser(e,t){return new Promise(((n,r)=>{if(!t)return void r({r:-1,message:"UserId is invalid"});if(!e.userId||!e.hasConnected)return void r({r:-1,message:"StringeeClient is not connected to Stringee server"});const s={participants:[t,e.userId]};e._sendMessage(i.CHAT_CONVERSATION_FOR_USERS,s,(t=>{if(0!=t.r)return void r({r:t.r,msg:t.message});let s=[];Array.isArray(t.conversations)&&t.conversations.length>0&&(s=t.conversations.map((t=>new Ee(e,t)))),n(s)}))}))}static getUsersInfo(e,t,n){if(t&&t.length)if(e.userId&&e.hasConnected){var r="";t.forEach((function(e){0==r.length?r+=e:r+=", "+e}));var s={userIds:r};e._sendMessage(i.CHAT_GET_USERS_INFO,s,(function(t){if(n){var r=t.r,s=0==r,i=s?"Success":"Fail.",o=t.users,a=[];return o.forEach((function(e){var t=new Re(e);t.userId=e.userId,a.push(t)})),void n.call(e,s,r,i,a)}}))}else n.call(e,!1,-1,"StringeeClient is not connected to Stringee server",null);else n.call(e,!1,-2,"UserIds are invalid.",null)}}const Oe=n(218).default;class Ae{constructor(e,t,n,r){this.id=e,this.userId=t,this.body=n,this.callback=r,this.expireTime=Date.now()+36e5}}class be{constructor(e,t,n,r,s){0===t?(this.id=e.id,this.localId=e.localDbId,this.conversationId=e.convId,this.convId=e.convId,this.sender=e.user,this.createdAt=e.created,this.created=e.created,this.sequence=e.seq,this.seq=e.seq,this.type=e.type,this.content=e.content,r>=e.seq?this.state=4:n>=e.seq?this.state=3:this.state=2):1===t?(this.id=e.msgId,this.localId=e.localDbId,this.conversationId=e.convId,this.convId=e.convId,this.sender=e.from,this.createdAt=e.createdTime,this.sequence=e.seq,this.created=e.createdTime,this.seq=e.seq,this.type=e.type,this.content=e.message,this.state=3):2===t?(this.id=e.msgId,this.conversationId=e.convId,this.createdAt=e.created,this.sequence=e.seq,this.convId=e.convId,this.created=e.created,this.seq=e.seq,this.state=2):3==t&&(0==s?(this.id=e.lastMsg.id,this.localId="",this.conversationId=e.convId,this.convId=e.convId,this.sender=e.lastMsg.user,this.createdAt=e.lastMsg.created,this.created=e.lastMsg.created,this.sequence=1,this.seq=1,this.type=e.lastMsg.type,this.content=e.lastMsg.content,this.state=4):1==s?(this.id=null!=e.lastMsgId?e.lastMsgId:"",this.localId="",this.conversationId=e.convId,this.convId=e.convId,this.sender=e.lastMsgSender,this.createdAt=e.lastTimeNewMsg,this.created=e.lastTimeNewMsg,this.sequence=e.lastMsgSeqReceived,this.seq=e.lastMsgSeqReceived,this.type=e.lastMsgType,this.content=e.lastMsg,e.lastMsgSeqReceived>e.lastMsgSeqSeen?this.state=3:this.state=4):2==s&&(this.id=null!=e.lastMsgId?e.lastMsgId:"",this.localId="",this.conversationId=e.convId,this.convId=e.convId,this.sender=null!=e.lastMsgSender?e.lastMsgSender:"",this.createdAt=e.lastTimeNewMsg,this.created=e.lastTimeNewMsg,this.sequence=e.lastMsgSeqReceived,this.seq=e.lastMsgSeqReceived,this.type=e.lastMsgType,this.content=e.lastMsg,e.lastMsgSeqReceived>e.lastMsgSeqSeen?this.state=3:this.state=4))}}class Me{constructor(e,t){if(0===t){this.id=e.convId,this.name=e.lastMsg.content.groupName,this.isGroup=e.isGroup,this.updatedAt=e.lastUpdate,this.unreadCount=0,this.creator=e.lastMsg.content.creator,this.created=e.lastTimeNewMsg,this.pinMsgId=e.pinMsgId;var n=[];e.participants.forEach((function(e){var t=new Re(e);n.push(t)})),this.participants=n,this.lastMessage=new be(e,3,0,0,t)}else 1===t?(this.id=e.convId,this.name=e.convName,this.isGroup=e.isGroup,this.updatedAt=e.lastUpdate,this.unreadCount=e.unread,this.creator=e.creator,this.created=e.created,this.pinMsgId=e.pinMsgId,n=[],e.participants.forEach((function(e){var t=new Re(e);n.push(t)})),this.participants=n,this.lastMessage=new be(e,3,0,0,t)):(this.id=e.convId,this.name=e.info.name,this.isGroup=e.info.isGroup,this.updatedAt=e.lastUpdate,this.unreadCount=0,this.creator=e.info.creator,this.created=e.info.created,this.pinMsgId=e.pinMsgId,n=[],e.participants.forEach((function(e){var t=new Re(e);n.push(t)})),this.participants=n,this.lastMessage=new be(e,3,0,0,t))}}exports.StringeeClient=class{constructor(e=[],t=null){this.socket=null,this.hasConnected=!1,this.disconnectByUser=!1,this.timeoutToReconnect=0,this.lastTimeStampReceivedPacket=0,this.allClients=[],this.allClientsOfThisBrowser=[],this.apiStringeeBaseUrl="https://api.stringee.com/",t&&(this.apiStringeeBaseUrl=t),this.apiGetStringeeServerAddress=this.apiStringeeBaseUrl+"v2/getStringeeServerAddress",this.masterServer=null,this.stringeeServerAddrs=e,this.stringeeServerAddrIndex=-1,this._stringeeServerAddr=null,this.numberOfRetryConnect=0,this._currentRequestId=1,this._callbacks=new o,this.accessToken="",this._onMethods=new o,this._stringeeCalls=[],this._stringeeCalls2=[],this.ice_servers=[],this.deviceId="web-"+this._genUuid(),this.browserId=localStorage.getItem("stringee_browser_id"),this.browserId||(this.browserId="browser-"+this._genUuid(),localStorage.setItem("stringee_browser_id",this.browserId)),this.sessionId="session-"+this._genUuid(),this.alreadyTried=!1,this.healtcheckInterval=null}_cleanHouse(){this.healtcheckInterval&&clearInterval(this.healtcheckInterval)}getClientId(){return this.deviceId}getBrowserId(){return this.browserId}setThisClientIsActive(e){e?localStorage.setItem("active_client_id",this.deviceId):localStorage.removeItem("active_client_id")}isActiveClient(){var e=localStorage.getItem("active_client_id");return this.deviceId===e}findCallByCallId(e){for(var t=0;t<this._stringeeCalls.length;t++){var n=this._stringeeCalls[t];if(n.callId===e)return n}return null}findCall2ByCallId(e){for(var t=0;t<this._stringeeCalls2.length;t++){var n=this._stringeeCalls2[t];if(n.callId===e)return n}return null}_pushCallback(e,t){if(t){var n=this._callbacks.get(e);n||(n=[]),n.push(t),this._callbacks.put(e,n)}}_callCallback(e,t){var n=!1,r=this._callbacks.get(e);if(r){var s=r.pop();s&&(s.call(this,t),n=!0)}return n}getURLToConnect(){if(null!==this.masterServer){console.log("Master server is set ",this.masterServer,". Stop alternating to other server");let e=this.masterServer;return this.masterServer=null,void(this._stringeeServerAddr=e)}if(this.tempWebsocketURL&&0!==this.tempWebsocketURL.length||(this.tempWebsocketURL=[...this.stringeeServerAddrs]),this._stringeeServerAddr&&this.numberOfRetryConnect<=2)return this._stringeeServerAddr;this._stringeeServerAddr=this.tempWebsocketURL.shift(),this.numberOfRetryConnect>2&&(this.numberOfRetryConnect=0)}createNewStringeeWebSocket(e){this.getURLToConnect(),this.socket&&(this.socket.clearAllOnMethods(),this.socket.disconnect(),this.socket=null),this.socket=new _e(this._stringeeServerAddr),this.bindSocketEvents(this.socket,e),this.accessToken=e,this.socket.open()}createhealthCheckInterval(){var e=this;this._cleanHouse(),this.healtcheckInterval=setInterval((function(){if(e.disconnectByUser)return console.log("StringeeClient: Socket disconnected by user. Stop trying to connect"),void e._cleanHouse();if(null!=e.socket){if(Date.now()-e.lastTimeStampReceivedPacket>e.timeoutToReconnect){console.log("StringeeClient: Socket is die, reconnect...");var t=e.socket._onMethods.get("disconnect");t&&(clearInterval(e.healtcheckInterval),e.socket.clearAllOnMethods(),e.socket.disconnect(),t(e.socket,null))}}else console.log("StringeeClient: Socket is null")}),5e3)}bindSocketEvents(e,t){let n=this;e.on("connect",(function(e,r){n._callOnEvent("connect"),n.numberOfRetryConnect=0;var s=screen.width,o=screen.height,a=localStorage.getItem("stringee_browser_id");a||(a="browser-"+n._genUuid(),localStorage.setItem("stringee_browser_id",a));var c={accesstoken:t,deviceId:n.deviceId,browserId:n.browserId,sessionId:n.sessionId,platform:3,platformVersion:"",deviceName:navigator.userAgent,screenSize:s+"x"+o,sdkVersion:"2.6.0"};n._sendMessage(i.AUTHEN,c,(function(e){0===e.r?(n.ice_servers=e.ice_servers,n.hasConnected=!0,e.clients.forEach((function(e){n.allClients.push(e.clientId),e.browserId===n.getBrowserId()&&n.allClientsOfThisBrowser.push(e.clientId),n.allClients.sort(),n.allClientsOfThisBrowser.sort()})),n.userId=e.userId,n.timeoutToReconnect=e.ping_after_ms+15e3,void 0!==e.chatAgent&&e.chatAgent&&ye.loadAllChatRequest(n).then((e=>{e.forEach((e=>{"normal"===e.type?n._callOnEvent("receiveChatRequest",e):"transfer"===e.type&&n._callOnEvent("receiveTransferChatRequest",e)}))})),n.createhealthCheckInterval()):n.hasConnected=!1,15!==e.r?(n._callOnEvent("authen",e),6===e.r&&n._callOnEvent("requestnewtoken")):(console.log("CURRENT_SERVER_IS_SLAVE, please change to: "+e.change_to_server),e.change_to_server?(n.masterServer=e.change_to_server,n.socket.disconnect(),this.numberOfRetryConnect=0):setTimeout((function(){n.socket.disconnect()}),2e3)),0!==e.r&&15!==e.r&&n.disconnect()}))})),e.on("disconnect",(function(e,t){if(n.hasConnected=!1,!n.disconnectByUser){n.numberOfRetryConnect++,n.socket&&n.socket.disconnect();let e=500*n.numberOfRetryConnect;setTimeout((function(){this.disconnectByUser||n.createNewStringeeWebSocket(n.accessToken)}),e)}n._callOnEvent("disconnect")})),e.on("error",(function(e,t){})),e.on("EventPacket",(function(e,t){try{var r=JSON.parse(t);if(!r||!r.service)return void console.log("could not decode data, error=1, ",t);try{n._packetReceived(r.service,r.body)}catch(e){console.log("error when process packet",e)}}catch(e){console.log("could not decode data, error=2, ",t)}}))}getStringeeServerAddrFromRestAPI(e){let t=this;Oe({method:"get",url:t.apiGetStringeeServerAddress,params:{access_token:e},responseType:"json"}).then((function(n){if(n.data&&0===n.data.r)t.stringeeServerAddrs=[],n.data.data.stringeeServerAddrs.web.forEach((e=>{t.stringeeServerAddrs.push("wss://"+e.ip+":"+e.port)})),t.createNewStringeeWebSocket(e);else if(n.data&&Number.isInteger(n.data.r)){let e={r:-11,msg:"Access token invalid or Key SID not found"};t._callOnEvent("authen",e)}else setTimeout((function(){t.disconnectByUser||t.getStringeeServerAddrFromRestAPI(e)}),2e3)})).catch((function(n){if(n.response.data){let e={r:-12,msg:"Access token invalid or Key SID not found"};t._callOnEvent("authen",e)}else setTimeout((function(){t.disconnectByUser||t.getStringeeServerAddrFromRestAPI(e)}),2e3)}))}connect(e){this.alreadyTried?console.log("StringeeClient: There is a recent attempt to connect to "+this._stringeeServerAddr+". Please wait"):(this.alreadyTried=!0,this.disconnectByUser=!1,0===this.stringeeServerAddrs.length?this.getStringeeServerAddrFromRestAPI(e):this.createNewStringeeWebSocket(e))}disconnect(){this._cleanHouse(),this.alreadyTried=!1,this.tempWebsocketURL=null,this.disconnectByUser=!0,this.socket&&(this.socket.close(),this.socket=null)}sendCustomMessage(e,t,n){var r=this,s={toUser:e,message:t};this._sendMessage(i.CUSTOM_MESSAGE,s,(function(e){n&&n.call(r,e)}))}changeAttribute(e,t,n){var r=this,s={attribute:e,value:t};this._sendMessage(i.CHANGE_ATTRIBUTE,s,(function(e){n&&n.call(r,e)}))}_sendMessage(e,t,n){if(t.requestId||(t.requestId=this._currentRequestId),n){var r="packet_"+e+"_"+t.requestId;this._pushCallback(r,n)}var s={service:e,body:t};this.socket.emit("EventPacket",s),this._currentRequestId++}_packetReceived(e,t){var n,r=!1;if(this.lastTimeStampReceivedPacket=Date.now(),t.requestId){var s="packet_"+e+"_"+t.requestId;n=this._callCallback(s,t)}e===i.CALL_SDP_CANDIDATE_FROM_SERVER?fe._callSdpCandidateFromServer(this,t):e===i.CALL_STATE_FROM_SERVER?fe._callStateFromServer(this,t):e===i.CALL_STOP_FROM_SERVER?fe._callStopFromServer(this,t):e===i.CALL_START_FROM_SERVER?fe._callStartFromServer(this,t):e===i.PING?this._sendMessage(i.PING,{}):e===i.CALL_INFO_FROM_SERVER?fe._callInfoFromServer(this,t):e===i.MSG_FROM_OTHER_DEVICE?this._msgFromOtherDevice(t):e===i.CUSTOM_MESSAGE_FROM_SERVER?this._callOnEvent("custommessage",t):e===i.OTHER_DEVICE_AUTHEN?this._otherDeviceAuthen(t):e===i.CHAT_MESSAGE_FROM_SERVER?(this._callOnEvent("chatmessage",t),ye.inited&&this._callOnEvent("chatmessage2",t)):e===i.CHAT_MESSAGE_REPORT_FROM_SERVER?(this._callOnEvent("chatmessagestate",t),ye.inited&&this._callOnEvent("chatmessagestate2",t)):e===i.CHAT_ROUTE_TO_AGENT?(ge._routeChatToAgent(this,t),ye.inited&&this._callOnEvent("incommingchat2",t)):e===i.SUBSCRIBE_FROM_SERVER?this._callOnEvent("messagefromtopic",t):e===i.TIMEOUT_ROUTE_TO_QUEUE?this._callOnEvent("timeoutInQueue",t):e===i.TIMEOUT_ROUTE_TO_AGENT?this._callOnEvent("timeoutAnswerChat",t):e===i.CHAT_PIN_MESSAGE_FROM_SERVER?this._callOnEvent("pinMsgFromServer",t):e===i.CHAT_EDIT_MESSAGE_FROM_SERVER?this._callOnEvent("editMsgFromServer",t):e===i.CHAT_REVOKE_MESSAGE_FROM_SERVER?this._callOnEvent("revokeMsgFromServer",t):e===i.CHAT_REMOVE_PARTICIPANT_FROM_SERVER?this._callOnEvent("removeParticipantFromServer",t):e===i.CHAT_ADD_PARTICIPANT_FROM_SERVER?this._callOnEvent("addParticipantFromServer",t):e===i.CHAT_USER_BEGIN_TYPING_NOTIFICATION?this._callOnEvent("userBeginTypingListener",t):e===i.CHAT_USER_END_TYPING_NOTIFIACTION?this._callOnEvent("userEndTypingListener",t):e===i.UPDATE_USER_INFO_NOTIFICATION?this._callOnEvent("updateUserInfoMsg",t):e===i.CHAT_CONVERSATION_ATTACHMENT?this._callOnEvent("chatConversationAttachment",t):e===i.CHAT_AGENT_RESPONSE?(this._callOnEvent("chatAgentResponse",t),ye.inited&&this._callOnEvent("chatAgentResponse2",t)):e===i.CHAT_CONFIRM_TRANSFER_REQUEST?(this._callOnEvent("chatConfirmTransferResponse",t),ye.inited&&this._callOnEvent("chatConfirmTransferResponse2",t)):e===i.END_CHAT?this._callOnEvent("endChat",t):e===i.CHAT_CONVERSATION_ENDED_NOTIFICATION?this._callOnEvent("conversationEnded",t):e===i.CHAT_TRANSFER_REQUEST_FROM_ANOTHER_AGENT?(this._callOnEvent("transferChatRequest",t),ye.inited&&this._callOnEvent("transferChatRequest2",t)):e===i.CHAT_LOAD_ALL_MESSAGES_FOR_CONVERSATIONS?this._callOnEvent("loadAllChatMessages",t):e===i.VIDEO_ENDPOINT_SDP_FROM_SERVER?fe._videoEndPointSdpFromServer(this,t):e===i.VIDEO_ENDPOINT_CANDIDATE_FROM_SERVER?fe._videoEndPointCandidateFromServer(this,t):e===i.VIDEO_TRACK_ADDED_FROM_SERVER?fe._videoTrackAddedFromServer(this,t):e===i.VIDEO_TRACK_REMOVED_FROM_SERVER?fe._videoTrackRemovedFromServer(this,t):e===i.VIDEO_ROOM_JOINED_FROM_SERVER?fe._videoRoomJoinedFromServer(this,t):e===i.VIDEO_ROOM_LEFT_FROM_SERVER?fe._videoRoomLeftFromServer(this,t):e===i.VIDEO_ROOM_MSG_FROM_SERVER?fe._videoRoomMsgFromServer(this,t):e===i.VIDEO_ROOM_CALL_INVITE?fe._videoRoomCallInviteFromServer(this,t):e===i.VIDEO_ROOM_CALL_INVITE_CANCEL?fe._videoRoomCallInviteCancelFromServer(this,t):e===i.VIDEO_ROOM_CALL_STATE_FROM_SERVER?fe._call2StateFromServer(this,t):e===i.VIDEO_ROOM_END_CALL_FROM_SERVER?fe._call2EndFromServer(this,t):e===i.VIDEO_ROOM_ENABLE_DISABLE_AUDIO_VIDEO_NOTIFICATION?fe._videoRoomEnableDisableAudioVideoNotification(this,t):e===i.CALL_UPDATE_FROM_SERVER?this._callOnEvent("callUpdateFromServer",t):r=!0,n&&(r=!1),r&&console.log("===Packet received: service="+e+"; body="+JSON.stringify(t))}_otherDeviceAuthen(e){if("disconnected"===e.status){for(var t=0;t<this.allClients.length;t++)this.allClients[t]===e.clientId&&this.allClients.splice(t,1);if(e.browserId===this.getBrowserId())for(t=0;t<this.allClientsOfThisBrowser.length;t++)this.allClientsOfThisBrowser[t]===e.clientId&&this.allClientsOfThisBrowser.splice(t,1)}else this.allClients.push(e.clientId),e.browserId===this.getBrowserId()&&this.allClientsOfThisBrowser.push(e.clientId),this.allClients.sort(),this.allClientsOfThisBrowser.sort();this._callOnEvent("otherdeviceauthen",e)}_msgFromOtherDevice(e){var t=e.data;if("CALL_STATE"===e.type)(n=this.findCallByCallId(t.callId))&&(200===t.code&&(n.answeredOnAnotherDevice=!0),n._callOnEvent("otherdevice",{type:"CALL_STATE",code:t.code}),486===t.code||603===t.code?(n.ended=!0,n._freeResource(),n.onRemove()):200===t.code&&n._freeResource());else if("CALL_END"===e.type)(n=this.findCallByCallId(t.callId))&&(n.ended=!0,n._callOnEvent("otherdevice",{type:"CALL_END"}));else if("CALL2_STATE"===e.type){var n;(n=this.findCall2ByCallId(t.callId))&&(200===t.code&&(n.answeredOnAnotherDevice=!0),n._callOnEvent("otherdevice",{type:"CALL2_STATE",code:t.code}),486===t.code||603===t.code?(n.ended=!0,n.onRemove()):200===t.code&&(n.isAnswered=!0,n.onRemove()))}else console.log("===_msgFromOtherDevice: body="+JSON.stringify(e))}sendChatOneToOneMsg(){}on(e,t){this._onMethods.put(e,t)}_callOnEvent(e,t){var n=this._onMethods.get(e);n?t?n.call(this,t):n.call(this):console.log("Please implement StringeeClient event: "+e)}_genUuid(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}setApiStringeeBaseUrl(e){this.apiStringeeBaseUrl=e}getApiStringeeBaseUrl(){return this.apiStringeeBaseUrl}},exports.StringeeCall=le,exports.StringeeCall2=ve,exports.StringeeChat=class{constructor(e){let t=this;t.realTimeEvent="onObjectChange",t.pinMsgFromServerEvent="pinMsgFromServer",t.editMsgFromServerEvent="editMsgFromServer",t.userBeginTypingEvent="userBeginTypingListener",t.userEndTypingEvent="userEndTypingListener",t.revokeMsgFromServerEvent="revokeMsgFromServer",t.removeParticipantFromServerEvent="removeParticipantFromServer",t.addParticipantFromServerEvent="addParticipantFromServer",t.created=!1,t.client=e,t._onMethods=new o,t.trackingMap=new o,t.msgQueue=[],setInterval((function(){var e=Date.now();t.msgQueue=t.msgQueue.filter((function(t){return t.expireTime>e}))}),1e3),t.setupChatClient(t)}setupChatClient(e){e.client.on("authensuccess",(function(t){e.sendMessageQueue()})),e.client.on("chatmessage",(function(t){var n=new be(t,1),r={lastMsgSeq:n.sequence,lastMsgTimestamp:n.createdAt,status:1,convId:n.conversationId};e.client._sendMessage(i.CHAT_MESSAGE_REPORT,r,(function(e){})),e.trackMsg(n),e.fireObjectChangeEvent(1,[n],0),null!=n.conversationId&&n.conversationId.length>0&&e.getConversationById(n.conversationId,(function(t,n,r,s){t&&null!=s&&e.fireObjectChangeEvent(0,[s],1)}))})),e.client.on("chatmessagestate",(function(t){var n=t.lastMsgSeq,r=t.status,s=(t.convId,e.trackingMap.allValues()),i=[];s.forEach((function(t){if(n>=t.sequence)if(2===r){t.state=4,i.push(t);var s=e.keyForMsg(t);e.trackingMap.remove(s)}else 1===r&&4!==t.state&&3!==t.state&&(t.state=3,i.push(t))})),i.length>0&&e.fireObjectChangeEvent(1,i,1)})),e.client.on("pinMsgFromServer",(function(t){var n=t.convId,r=t.msgId,s=t.isPin;e._callOnEvent(e.pinMsgFromServerEvent,{convId:n,msgId:r,isPin:s})})),e.client.on("editMsgFromServer",(function(t){var n=t.convId,r=t.msgId;e._callOnEvent(e.editMsgFromServerEvent,{convId:n,msgId:r})})),e.client.on("revokeMsgFromServer",(function(t){var n=t.convId,r=t.msgIds;e._callOnEvent(e.revokeMsgFromServerEvent,{convId:n,msgIds:r})})),e.client.on("userBeginTypingListener",(function(t){e._callOnEvent(e.userBeginTypingEvent,t)})),e.client.on("userEndTypingListener",(function(t){e._callOnEvent(e.userEndTypingEvent,t)})),e.client.on(e.removeParticipantFromServerEvent,(function(t){e._callOnEvent(e.removeParticipantFromServerEvent,t)})),e.client.on(e.addParticipantFromServerEvent,(function(t){e._callOnEvent(e.addParticipantFromServerEvent,t)}))}createConversation(e,t,n){let r=this;return new Promise((function(s,o){if(r.created)o({r:-1,message:"Could not create conversation, conversation is created"});else{if(void 0===e||null==e||null==e.length||0===e.length)return o({r:-1,message:"UserIds are invalid"}),void n.call(r.client,!1,-2,"UserIds are invalid",null);if(!r.client.hasConnected)return o({r:-1,message:"StringeeClient is not connected to Stringee server."}),void n.call(r.client,!1,-1,"StringeeClient is not connected to Stringee server.",null);var a;a=null==t.name||0===t.name.length?"":t.name;var c={distinct:t.isDistinct,isGroup:t.isGroup,name:a,participants:e};r.client._sendMessage(i.CHAT_CREATE_CONVERSATION,c,(function(e){var t=e.r,i=0===t||2===t;i&&(r.created=!0);var a=i?"Success":null!=e.message&&e.message.length>0?e.message:"Generic error.",c=i?new Me(e,t):null,l=0===t||2===t?0:e.r;n&&n.call(r.client,i,l,a,c),i||o(t),0===e.r?(e.objectType=0,e.objectChanges=[c],e.changeType=0,s(e),r.fireObjectChangeEvent(0,[c],0)):2===e.r&&(e.objectType=0,e.objectChanges=[c],e.changeType=1,s(e),r.fireObjectChangeEvent(0,[c],1))}))}}))}getLastConversations(e,t,n){let r=this;if(e<=0)n.call(r.client,!1,-2,"Params are invalid.",null);else if(r.client.hasConnected){var s={lastUpdateGreater:0,lastUpdateSmaller:Number.MAX_SAFE_INTEGER,limit:e};r.client._sendMessage(i.CHAT_CONVERSATION_LOAD,s,(function(e){if(n){var s=0===e.r,i=e.r,o=s?"Success":null!=e.message&&e.message.length>0?e.message:"Generic error.",a=e.listConvs;return null!=a&&(a=t?a.reverse().map((function(e){return new Me(e,1)})):a.map((function(e){return new Me(e,1)}))),void n.call(r.client,s,i,o,a)}}))}else n.call(r.client,!1,-1,"StringeeClient is not connected to Stringee server.",null)}getConversationsAfter(e,t,n,r){let s=this;if(t<=0||e<=0)r.call(s.client,!1,-2,"Params are invalid.",null);else if(s.client.hasConnected){var o={lastUpdateGreater:e,lastUpdateSmaller:Number.MAX_SAFE_INTEGER,limit:t};s.client._sendMessage(i.CHAT_CONVERSATION_LOAD,o,(function(e){if(r){var t=0===e.r,i=e.r,o=t?"Success":null!=e.message&&e.message.length>0?e.message:"Generic error.",a=e.listConvs;return null!=a&&(a=n?a.reverse().map((function(e){return new Me(e,1)})):a.map((function(e){return new Me(e,1)}))),void r.call(s.client,t,i,o,a)}}))}else r.call(s.client,!1,-1,"StringeeClient is not connected to Stringee server.",null)}getConversationsBefore(e,t,n,r){let s=this;if(t<=0||e<=0)r.call(s.client,!1,-2,"Params are invalid.",null);else if(s.client.hasConnected){var o={lastUpdateGreater:0,lastUpdateSmaller:e,limit:t};s.client._sendMessage(i.CHAT_CONVERSATION_LOAD,o,(function(e){if(r){var t=0===e.r,i=e.r,o=t?"Success":null!=e.message&&e.message.length>0?e.message:"Generic error.",a=e.listConvs;return null!=a&&(a=n?a.reverse().map((function(e){return new Me(e,1)})):a.map((function(e){return new Me(e,1)}))),void r.call(s.client,t,i,o,a)}}))}else r.call(s.client,!1,-1,"StringeeClient is not connected to Stringee server.",null)}getListConversations(e,t,n){let r=this;return new Promise((function(s,o){if(n<=0||t<=0)o({r:-2,msg:"Params are invalid."});else if(r.client.hasConnected){var a={lastUpdateGreater:e,lastUpdateSmaller:t,limit:n};r.client._sendMessage(i.CHAT_CONVERSATION_LOAD,a,(function(e){var t=e.r;if(0==t){var n=e.listConvs;null!=n&&(n=n.map((function(e){return new Me(e,1)}))),s(n)}else o({r:t,msg:e.message})}))}else o({r:-1,msg:"StringeeClient is not connected to Stringee server."})}))}getConversationById(e,t){let n=this;return new Promise((function(r,s){if(!e)return s({r:-1,message:"Conversaion's Id is invalid"}),void t.call(n.client,!1,-2,"Conversaion's Id is invalid",conv);if(!n.client.hasConnected)return s({r:-1,message:"StringeeClient is not connected to Stringee server."}),void t.call(n.client,!1,-2,"StringeeClient is not connected to Stringee server.",conv);var o={convIds:e};n.client._sendMessage(i.CHAT_GET_CONVERSATIONS_INFO,o,(function(e){var i,o=e.r,a=0===o,c=e.r,l=a?"Success":null!=e.message&&e.message.length>0?e.message:"Generic error.",d=e.listConvs;null!=d&&d.length>0&&(i=new Me(d[0],1)),t&&t.call(n.client,a,c,l,i),0===o?r({...e,conversation:i}):s({...e,conversation:i})}))}))}deleteConversation(e,t){let n=this;if(e)if(n.client.hasConnected){var r={convIds:e};n.client._sendMessage(i.CHAT_GET_CONVERSATIONS_INFO,r,(function(r){if(t){var s=r.listConvs;if(null!=s&&s.length>0){var o=s[0],a={seq:o.convLastSeq,convId:e};n.client._sendMessage(i.CHAT_DELETE_CONVERSATION,a,(function(e){var r=e.r,s=0===r,i=r,a=s?"Success":null!=e.message&&e.message.length>0?e.message:"Generic error.";if(t.call(n.client,s,i,a),0===e.r){var c=new Me(o,1);n.fireObjectChangeEvent(0,[c],2)}}))}else t.call(n.client,!1,-3,"Can not get conversation's info")}}))}else t.call(n.client,!1,-1,"StringeeClient is not connected to Stringee server.");else t.call(n.client,!1,-2,"Conversaion's Id is invalid")}updateConversation(e,t,n){let r=this;if(e)if(r.client.hasConnected){var s={convId:e,groupName:t.name,imageUrl:t.avatar};r.client._sendMessage(i.CHAT_UPDATE_CONVERSATION,s,(function(t){if(n){var s=0===t.r,o=t.r,a=s?"Success":null!=t.message&&t.message.length>0?t.message:"Generic error.";n.call(r.client,s,o,a)}if(0===t.r){var c={convIds:e};r.client._sendMessage(i.CHAT_GET_CONVERSATIONS_INFO,c,(function(e){var t=e.listConvs;if(null!=t&&t.length>0){var n=t[0],s=new Me(n,1);r.fireObjectChangeEvent(0,[s],1)}}))}}))}else n.call(r.client,!1,-1,"StringeeClient is not connected to Stringee server.");else n.call(r.client,!1,-2,"Conversation's Id is invalid")}addParticipants(e,t,n){let r=this;return new Promise(((s,o)=>{if(!e)return o({r:-1,message:"Conversation ID is invalid"}),void n.call(r.client,!1,-2,"Params are invalid.",null);if(!t||!t.length)return o({r:-1,message:"List of users is empty"}),void n.call(r.client,!1,-2,"Params are invalid.",null);if(!r.client.hasConnected)return o({r:-1,message:"StringeeClient is not connected to Stringee server."}),void n.call(r.client,!1,-1,"StringeeClient is not connected to Stringee server.",null);var a={convId:e,userIds:t};r.client._sendMessage(i.CHAT_ADD_PARTICIPANT,a,(function(t){if(n){var a=t.r,c=0===a,l=a,d=c?"Success":null!=t.message&&t.message.length>0?t.message:"Generic error.",u=t.added;null!=u&&(u=u.map((function(e){return new Re(e)}))),n.call(r.client,c,l,d,u)}if(0===t.r){var h={convIds:e};r.client._sendMessage(i.CHAT_GET_CONVERSATIONS_INFO,h,(function(e){var t=e.listConvs;if(null!=t&&t.length>0){var n=t[0],s=new Me(n,1);r.fireObjectChangeEvent(0,[s],1)}})),s(t)}else o(t)}))}))}removeParticipants(e,t,n){let r=this;return new Promise((function(s,o){if(!e)return n.call(r.client,!1,-2,"Params are invalid.",null),void o({r:-1,message:"Conversation ID is not valid"});if(!t||!t.length)return n.call(r.client,!1,-2,"Params are invalid.",null),void o({r:-1,message:"list of user is empty"});if(!r.client.hasConnected)return n.call(r.client,!1,-1,"StringeeClient is not connected to Stringee server.",null),void o({r:-1,message:"StringeeClient is not connected to Stringee server."});var a={convId:e,userIds:t};r.client._sendMessage(i.CHAT_REMOVE_PARTICIPANT,a,(function(t){if(n){var a=t.r,c=0===a,l=a,d=c?"Success":null!=t.message&&t.message.length>0?t.message:"Generic error.",u=t.removed;null!=u&&(u=u.map((function(e){return new Re(e)}))),n.call(r.client,c,l,d,u)}if(0===t.r){var h={convIds:e};r.client._sendMessage(i.CHAT_GET_CONVERSATIONS_INFO,h,(function(e){var t=e.listConvs;if(null!=t&&t.length>0){var n=t[0],s=new Me(n,1);r.fireObjectChangeEvent(0,[s],1)}})),0===t.r?s(t):o(t)}}))}))}sendMessage(e,t){let n=this;if(e.convId)if(n.client.hasConnected&&null!=n.client.userId)if("object"==typeof e.message){var r=n.client.userId,s=Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15),o="web-"+r+"-"+s+"-"+Date.now().toString(),a={message:e.message,type:e.type,convId:e.convId,localDbId:o},c=new Ae(o,r,a,t);n.msgQueue.push(c),console.log("start sending message");var l=new be({},3);l.id=null,l.localId=o,l.conversationId=e.convId,l.sender=r,l.createdAt=Date.now(),l.type=e.type,l.content=e.message,l.state=0,n.trackMsg(l),n.fireObjectChangeEvent(1,[l],0),l.state=1,n.fireObjectChangeEvent(1,[l],1),console.log("requesting send message"),n.client._sendMessage(i.CHAT_MESSAGE,a,(function(s){console.log("on chat message sent",s);var i=s.r,a=0===i,c=null;if(t&&9!==i){var l=s.r,d=a?"Success":null!=s.message&&s.message.length>0?s.message:"Generic error.";(c=new be(s,2)).localId=o,c.type=e.type,c.content=e.message,c.sender=r,t.call(n.client,a,l,d,c)}var u=s.localDbId;if(null!=u&&a&&(n.msgQueue=n.msgQueue.filter((function(e){return e.id!==u}))),null!=c){var h=n.keyForMsg(c);n.trackingMap.remove(h),n.trackingMap.put(h,c),n.fireObjectChangeEvent(1,[c],1)}}))}else t.call(n.client,!1,-100,"info.message is not Object.");else t.call(n.client,!1,-1,"StringeeClient is not connected to Stringee server.");else t.call(n.client,!1,-2,"Conversation's Id is invalid")}sendMsg(e){let t=this;return new Promise((function(n,r){if(e.convId)if(t.client.hasConnected&&null!=t.client.userId)if("object"==typeof e.message){var s=t.client.userId,o="web-"+s+"-"+(Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15))+"-"+Date.now().toString(),a={message:e.message,type:e.type,convId:e.convId,localDbId:o},c=new be({},3);c.id=null,c.localId=o,c.convId=e.convId,c.sender=s,c.created=Date.now(),c.type=e.type,c.content=e.message,t.client._sendMessage(i.CHAT_MESSAGE,a,(function(e){var t=e.r;console.log("res from server: "+JSON.stringify(e)),0==t?(c.id=e.msgId,c.seq=e.seq,c.created=e.created,n(c)):r({r:t,msg:e.message})}))}else r({r:-3,msg:"info.message is not Object."});else r({r:-2,msg:"StringeeClient is not connected to Stringee server."});else r({r:-1,msg:"Conversation's Id is invalid"})}))}sendMessageQueue(){let e=this;if(e.msgQueue.length){var t=e.msgQueue[0];if(t.userId!=e.client.userId&&null!=e.client.userId)return t.callback&&t.callback.call(e.client,!1,-3,"Generic error.",null),void e.msgQueue.shift();e.client._sendMessage(i.CHAT_MESSAGE,t.body,(function(n){var r=n.r,s=0==r,i=n.r,o=s?"Success":null!=n.message&&n.message.length>0?n.message:"Generic error.",a=n.localDbId,c=null;if(s&&((c=new be(n,2)).localId=a,c.type=t.body.type,c.content=t.body.message,c.sender=t.userId),t.callback&&9!=r&&t.callback.call(e.client,s,i,o,c),null!=a&&s&&(e.msgQueue=e.msgQueue.filter((function(e){return e.id!=a})),e.sendMessageQueue()),null!=c){var l=stringeeChat.keyForMsg(c);e.trackingMap.remove(l),e.trackingMap.put(l,c),e.fireObjectChangeEvent(1,[c],1)}}))}}loadChatMessages(e,t){let n=this;var r={seqGreater:e.seqGreater,limit:e.limit,sort:e.sort,convId:e.convId};n.client._sendMessage(i.CHAT_MESSAGES_LOAD,r,(function(e){t&&t.call(n.client,e)}))}loadAllChatMessages(e,t){let n=this,r=e.createdGreater,s=e.createdSmaller,o=e.limit,a=e.sort,c=e.convIds;if(!Array.isArray(c))return void console.log("must be an array");c=c.join(",");let l={createdGreater:r,createdSmaller:s,sort:a,limit:o,convIds:c};return new Promise(((e,r)=>{n.client._sendMessage(i.CHAT_LOAD_ALL_MESSAGES_FOR_CONVERSATIONS,l,(function(r){console.log("got data from server, ",r),t&&(console.log("got a valid callback"),t.call(n.client,r)),e(r)}))}))}getListMessages(e,t,n,r,s){let o=this;return new Promise((function(a,c){if(!e||r<=0||n<0)c({r:-1,msg:"Params are invalid."});else if(o.client.hasConnected){var l={seqGreater:t,seqSmaller:n,limit:r,sort:s,convId:e};o.client._sendMessage(i.CHAT_MESSAGES_LOAD,l,(function(t){var n=t.r;if(0==n){var r=t.msgs;if(null!=r){var s={convIds:e};o.client._sendMessage(i.CHAT_GET_CONVERSATIONS_INFO,s,(function(e){var t=e.listConvs,n=0,s=0;if(null!=t&&t.length>0){var i=t[0];n=i.lastMsgSeqReceived,s=i.lastMsgSeqSeen}r=r.reverse().map((function(e){var t=new be(e,0,n,s);return o.trackMsg(t),t})),a(r)}))}}else c({r:n,msg:t.message})}))}else c({r:-2,msg:"StringeeClient is not connected to Stringee server."})}))}getLastMessages(e,t,n,r){let s=this;if(!e||t<0)r.call(s.client,!1,-2,"Params are invalid.",null);else if(s.client.hasConnected){var o=null!=t?t:50,a={seqGreater:0,seqSmaller:Number.MAX_SAFE_INTEGER,limit:o,sort:"DESC",convId:e};s.client._sendMessage(i.CHAT_MESSAGES_LOAD,a,(function(t){if(r){var o=0===t.r,a=t.r,c=o?"Success":null!=t.message&&t.message.length>0?t.message:"Generic error.",l=t.msgs;if(null!=l){var d={convIds:e};s.client._sendMessage(i.CHAT_GET_CONVERSATIONS_INFO,d,(function(e){var t=e.listConvs,i=0,d=0;if(null!=t&&t.length>0){var u=t[0];i=u.lastMsgSeqReceived,d=u.lastMsgSeqSeen}l=n?l.reverse().map((function(e){var t=new be(e,0,i,d);return s.trackMsg(t),t})):l.map((function(e){var t=new be(e,0,i,d);return s.trackMsg(t),t})),r.call(s.client,o,a,c,l)}))}}}))}else r.call(s.client,!1,-1,"StringeeClient is not connected to Stringee server.",null)}getMessagesAfter(e,t,n,r,s){let o=this;if(!e||t<0||n<0)s.call(o.client,!1,-2,"Params are invalid.",null);else if(o.client.hasConnected){var a=null!=n?n:50,c={seqGreater:null!=t?t:0,seqSmaller:Number.MAX_SAFE_INTEGER,limit:a,sort:"ASC",convId:e};o.client._sendMessage(i.CHAT_MESSAGES_LOAD,c,(function(t){if(s){var n=0==t.r,a=t.r,c=n?"Success":null!=t.message&&t.message.length>0?t.message:"Generic error.",l=t.msgs;if(null!=l){var d={convIds:e};o.client._sendMessage(i.CHAT_GET_CONVERSATIONS_INFO,d,(function(e){var t=e.listConvs,i=0,d=0;if(null!=t&&t.length>0){var u=t[0];i=u.lastMsgSeqReceived,d=u.lastMsgSeqSeen}l=r?l.map((function(e){var t=new be(e,0,i,d);return o.trackMsg(t),t})):l.reverse().map((function(e){var t=new be(e,0,i,d);return o.trackMsg(t),t})),s.call(o.client,n,a,c,l)}))}}}))}else s.call(o.client,!1,-1,"StringeeClient is not connected to Stringee server.",null)}getMessagesBefore(e,t,n,r,s){let o=this;if(!e||t<0||n<0)s.call(o.client,!1,-2,"Params are invalid.",null);else if(o.client.hasConnected){var a={seqGreater:0,seqSmaller:t,limit:null!=n?n:50,sort:"DESC",convId:e};o.client._sendMessage(i.CHAT_MESSAGES_LOAD,a,(function(t){if(s){var n=0==t.r,a=t.r,c=n?"Success":null!=t.message&&t.message.length>0?t.message:"Generic error.",l=t.msgs;if(null!=l){var d={convIds:e};o.client._sendMessage(i.CHAT_GET_CONVERSATIONS_INFO,d,(function(e){var t=e.listConvs,i=0,d=0;if(null!=t&&t.length>0){var u=t[0];i=u.lastMsgSeqReceived,d=u.lastMsgSeqSeen}l=r?l.reverse().map((function(e){var t=new be(e,0,i,d);return o.trackMsg(t),t})):l.map((function(e){var t=new be(e,0,i,d);return o.trackMsg(t),t})),s.call(o.client,n,a,c,l)}))}}}))}else s.call(o.client,!1,-1,"StringeeClient is not connected to Stringee server.",null)}deleteMessage(e,t,n){let r=this;if(e)if(t)if(r.client.hasConnected){var s={msgIds:t,convId:e};r.client._sendMessage(i.CHAT_GET_MESSAGES_INFO,s,(function(s){if(0===s.r){var o=s.listMsgs;if(null!=o&&o.length>0){var a=o[0],c=new be(a,0),l={convId:e,messageIds:[t]};r.client._sendMessage(i.CHAT_DELETE_MESSAGE,l,(function(e){if(n){var t=e.r,s=0==t,i=t,o=s?"Success":null!=e.message&&e.message.length>0?e.message:"Generic error.";n.call(r.client,s,i,o),r.fireObjectChangeEvent(1,[c],2)}}))}}else n.call(r.client,!1,-3,"Message is not found.")}))}else n.call(r.client,!1,-1,"StringeeClient is not connected to Stringee server.");else n.call(r.client,!1,-2,"Params are invalid.");else n.call(r.client,!1,-2,"Params are invalid.")}clearHistory(e,t){let n=this;if(e.convId)if(n.client.hasConnected){var r={seq:e.sequence,convId:e.convId};n.client._sendMessage(i.CHAT_CONVERSATION_CLEAR_HISTORY,r,(function(e){if(t){var r=e.r,s=0===r,i=s?"Success":"Fail";t.call(n.client,s,r,i)}}))}else t.call(n.client,!1,-1,"StringeeClient is not connected to Stringee server.");else t.call(n.client,!1,-2,"Params are invalid.")}markMessageSeen(e,t){let n=this;if(e.convId)if(n.client.hasConnected){var r={lastMsgSeq:e.sequence,lastMsgTimestamp:e.createdAt,status:2,convId:e.convId};n.client._sendMessage(i.CHAT_MESSAGE_REPORT,r,(function(e){if(t){var r=0==e.r,s=r?0:-3,i=r?"Success":"Generic error.";t.call(n.client,r,s,i)}}))}else t.call(n.client,!1,-1,"StringeeClient is not connected to Stringee server.");else t.call(n.client,!1,-2,"Params are invalid.")}markConversationAsRead(e,t){let n=this;if(e)if(n.client.hasConnected){var r={convIds:e};n.client._sendMessage(i.CHAT_GET_CONVERSATIONS_INFO,r,(function(r){var s=r.listConvs;if(null!=s&&s.length>0){var o=s[0],a={lastMsgSeq:o.convLastSeq,lastMsgTimestamp:o.lastTimeNewMsg,status:2,convId:e};n.client._sendMessage(i.CHAT_MESSAGE_REPORT,a,(function(r){if(t){var s=0==r.r,i=s?0:-4,o=s?"Success":"Generic error.";t.call(n.client,s,i,o)}if(0===r.r){var a=n.trackingMap.allValues(),c=[];a.forEach((function(t){if(t.conversationId===e){t.state=4,c.push(t);var r=n.keyForMsg(t);n.trackingMap.remove(r)}})),c.length>0&&n.fireObjectChangeEvent(1,c,1),n.getConversationById(e,(function(e,t,r,s){e&&null!=s&&n.fireObjectChangeEvent(0,[s],1)}))}}))}else t&&t.call(n.client,!1,-3,"Can not get conversation's info")}))}else t.call(n.client,!1,-1,"StringeeClient is not connected to Stringee server.");else t.call(n.client,!1,-2,"Conversation's Id is invalid")}getUnreadConversationCount(e){let t=this;t.client.hasConnected?t.client._sendMessage(i.CHAT_UNREAD_CONVERSATION_COUNT,{},(function(n){if(e){var r=0==n.r,s=r?0:-3,i=r?"Success":"Generic error.",o=n.count;e.call(t.client,r,s,i,o)}})):e.call(t.client,!1,-1,"StringeeClient is not connected to Stringee server.",null)}getConversationWithUser(e,t){let n=this;if(e)if(n.client.userId&&n.client.hasConnected){var r={participants:[e,n.client.userId]};n.client._sendMessage(i.CHAT_CONVERSATION_FOR_USERS,r,(function(e){if(t){var r,s=0==e.r,i=s?0:-3,o=s?"Success":"Generic error.",a=e.conversations;if(a.length>0){var c=a[0];r=new Me(c,1),t.call(n.client,s,i,o,r)}else t.call(n.client,!1,-4,"Conversation is not found.",r)}}))}else t.call(n.client,!1,-1,"StringeeClient is not connected to Stringee server");else t.call(n.client,!1,-2,"UserId is invalid")}blockUser(e,t){let n=this;if(e){var r={userId:e};n.client._sendMessage(i.CHAT_BLOCK_USER,r,(function(e){if(t){var r=e.r,s=0==r,i=s?"Success":"Fail";t.call(n.client,s,r,i)}}))}else t.call(n.client,!1,-1,"UserId is invalid")}blockInviteToGroup(e,t){let n=this;if(e){var r={block_group_invite:e};n.client._sendMessage(i.CHAT_BLOCK_USER,r,(function(e){if(t){var r=e.r,s=0==r,i=s?"Success":"Fail";t.call(n.client,s,r,i)}}))}else t.call(n.client,!1,-1,"Conversation's Id is invalid")}rateChat(e,t,n,r){let s=this;var o={convId:e,rating:t,comment:n};s.client._sendMessage(i.RATE_CHAT,o,(function(e){r&&r.call(s.client,e)}))}updateUserInfo(e,t){let n=this;n.client._sendMessage(i.UPDATE_USER_INFO,e,(function(e){t&&t.call(n.client,e)}))}getUsersInfo(e,t){let n=this;if(e&&e.length)if(n.client.userId&&n.client.hasConnected){var r="";e.forEach((function(e){0==r.length?r+=e:r+=", "+e}));var s={userIds:r};n.client._sendMessage(i.CHAT_GET_USERS_INFO,s,(function(e){if(t){var r=e.r,s=0==r,i=s?"Success":"Fail.",o=e.users,a=[];return o.forEach((function(e){var t=new Re(e);t.userId=e.userId,a.push(t)})),void t.call(n.client,s,r,i,a)}}))}else t.call(n.client,!1,-1,"StringeeClient is not connected to Stringee server",null);else t.call(n.client,!1,-2,"UserIds are invalid.",null)}sendEmailTranscript(e,t){let n=this;var r={convId:e.convId,email:e.email,domain:e.domain};n.client._sendMessage(i.SEND_EMAIL_TRANSCRIPT,r,(function(e){t&&t.call(n.client,e)}))}getChatServices(e){let t=this;t.client._sendMessage(i.GET_CHAT_SERVICES,{},(function(n){e&&e.call(t.client,n)}))}viewChat(e,t){let n=this,r={convId:e};n.client._sendMessage(i.VIEW_CHAT,r,(function(e){t&&t.call(n.client,e)}))}joinChat(e,t){let n=this;var r={convId:e};n.client._sendMessage(i.JOIN_CHAT_CUSTOMER_CARE,r,(function(e){t&&t.call(n.client,e)}))}transferChat(e,t,n){let r=this;var s={convId:e,customerId:t.customerId,customerName:t.customerName,toUserId:t.toUserId};r.client._sendMessage(i.CHAT_TRANSFER_TO_ANOTHER_AGENT,s,(function(e){n&&n.call(r.client,e)}))}confirmTransferChat(e,t){let n=this;var r={convId:e,answer:1};n.client._sendMessage(i.CHAT_CONFIRM_TRANSFER_REQUEST,r,(function(e){t&&t.call(n.client,e)}))}pinMessage(e,t,n,r){let s=this;if(s.isString(e)&&s.isString(t)&&""!==e&&""!==t&&null!=n)if(s.client.userId&&s.client.hasConnected){var o={convId:e,msgId:t,isPin:n};s.client._sendMessage(i.CHAT_PIN_MESSAGE,o,(function(e){if(r){var t=e.r,n=0==t,i=e.message;r.call(s.client,n,t,i)}}))}else r.call(s.client,!1,-1,"StringeeClient is not connected to Stringee server");else r.call(s.client,!1,-2,"Params are invalid")}editMessage(e,t,n,r){let s=this;if(s.isString(e)&&s.isString(t)&&s.isString(n)&&""!==e&&""!==t&&""!==n)if(s.client.userId&&s.client.hasConnected){var o={content:n},a={convId:e,msgId:t,newContent:JSON.stringify(o)};s.client._sendMessage(i.CHAT_EDIT_MESSAGE,a,(function(e){if(r){var t=e.r,n=0==t,i=e.message;r.call(s.client,n,t,i)}}))}else r.call(s.client,!1,-1,"StringeeClient is not connected to Stringee server");else r.call(s.client,!1,-2,"Params are invalid")}revokeMessage(e,t,n){let r=this;if(r.isString(e)&&r.isString(t)&&""!==e&&""!==t)if(r.client.userId&&r.client.hasConnected){var s={convId:e,msgIds:[t]};r.client._sendMessage(i.CHAT_REVOKE_MESSAGE,s,(function(e){if(n){var t=e.r,s=0==t,i=e.message;n.call(r.client,s,t,i)}}))}else n.call(r.client,!1,-1,"StringeeClient is not connected to Stringee server");else n.call(r.client,!1,-2,"Params are invalid")}userBeginTyping(e,t){let n=this;var r={userId:e.userId,convId:e.convId};n.client._sendMessage(i.CHAT_USER_BEGIN_TYPING,r,(function(e){t&&t.call(n.client,e)}))}userEndTyping(e,t){let n=this;var r={userId:e.userId,convId:e.convId};n.client._sendMessage(i.CHAT_USER_END_TYPING,r,(function(e){t&&t.call(n.client,e)}))}getAttachmentMessages(e,t,n,r,s){let o=this;if(o.isString(e)&&""!==e&&null!=t&&0!==t&&null!=r&&0!==r)if(o.client.userId&&o.client.hasConnected){var a={convId:e,msgType:t,limit:r,start:n};o.client._sendMessage(i.CHAT_CONVERSATION_ATTACHMENT,a,(function(e){if(s){var t=e.r,n=0==t,r=e.message,i=n?e.msgs:null;s.call(o.client,n,t,r,i)}}))}else s.call(o.client,!1,-1,"StringeeClient is not connected to Stringee server",null);else s.call(o.client,!1,-2,"Params are invalid",null)}on(e,t){this._onMethods.put(e,t)}_callOnEvent(e,t){let n=this;var r=n._onMethods.get(e);r?t?r.call(n,t):r.call(n):console.log("Please implement StringeeChat event: "+e)}fireObjectChangeEvent(e,t,n){this._callOnEvent(this.realTimeEvent,{objectType:e,objectChanges:t,changeType:n})}trackMsg(e){if(4!==e.state){var t=this.keyForMsg(e);this.trackingMap.put(t,e)}}keyForMsg(e){var t=null!=e.conversationId&&e.conversationId.length>0?e.conversationId:"",n=null!=e.id&&e.id.length>0?e.id:"",r=null!=e.localId&&e.localId.length>0?e.localId:"";return t+"_"+(r.length>0?r:n)}isString(e){const t=typeof e;return"string"===t||"object"===t&&null!=e&&!Array.isArray(e)&&"[object String]"==getTag(e)}},exports.StringeeHashMap=o,exports.DeprecatedStringeeChat=class{constructor(e){this.client=e}createConversation(e,t){this.created?console.log("Could not create conversation, conversation is created"):this.client._sendMessage(i.CHAT_CREATE_CONVERSATION,e,(function(e){t&&t.call(this.client,e)}))}sendChatMessage(e,t){var n={message:e.message,type:e.type,convId:e.convId};this.client._sendMessage(i.CHAT_MESSAGE,n,(function(e){t&&t.call(this.client,e)}))}loadChatMessages(e,t){var n={seqGreater:e.seqGreater,limit:e.limit,sort:e.sort,convId:e.convId};this.client._sendMessage(i.CHAT_MESSAGES_LOAD,n,(function(e){t&&t.call(this.client,e)}))}loadAllChatMessages(e,t){let n=this,r=e.createdGreater,s=e.createdSmaller,o=e.limit,a=e.sort,c=e.convIds;if(!Array.isArray(c))return void console.log("must be an array");c=c.join(",");let l={createdGreater:r,createdSmaller:s,sort:a,limit:o,convIds:c};return new Promise(((e,r)=>{n.client._sendMessage(i.CHAT_LOAD_ALL_MESSAGES_FOR_CONVERSATIONS,l,(function(r){console.log("got data from server, ",r),t&&(console.log("got a valid callback"),t.call(n.client,r)),e(r)}))}))}addParticipant(e,t){var n={convId:e.convId,userIds:e.userIds};this.client._sendMessage(i.CHAT_ADD_PARTICIPANT,n,(function(e){t&&t.call(this.client,e)}))}removeParticipant(e,t){var n={convId:e.convId,userIds:e.userIds};this.client._sendMessage(i.CHAT_REMOVE_PARTICIPANT,n,(function(e){t&&t.call(this.client,e)}))}deleteMessage(e,t){var n={convId:e.convId,messageIds:e.messageIds};this.client._sendMessage(i.CHAT_DELETE_MESSAGE,n,(function(e){t&&t.call(this.client,e)}))}updateConversation(e,t){var n={convId:e.convId,groupName:e.name,imageUrl:e.imageUrl};this.client._sendMessage(i.CHAT_UPDATE_CONVERSATION,n,(function(e){t&&t.call(this.client,e)}))}deleteConversation(e,t){var n={seq:e.seq,convId:e.convId};this.client._sendMessage(i.CHAT_DELETE_CONVERSATION,n,(function(e){t&&t.call(this.client,e)}))}clearHistory(e,t){var n={seq:e.seq,convId:e.convId};this.client._sendMessage(i.CHAT_CONVERSATION_CLEAR_HISTORY,n,(function(e){t&&t.call(this.client,e)}))}loadConversations(e,t){var n={lastUpdateGreater:e.lastUpdateGreater,lastUpdateSmaller:e.lastUpdateSmaller,limit:e.limit};this.client._sendMessage(i.CHAT_CONVERSATION_LOAD,n,(function(e){t&&t.call(this.client,e)}))}getInfo(e,t){var n={convIds:e};this.client._sendMessage(i.CHAT_GET_CONVERSATIONS_INFO,n,(function(e){t&&t.call(this.client,e)}))}markMessageReceived(e,t){var n={lastMsgSeq:e.seq,lastMsgTimestamp:e.createdTime,status:1,convId:e.convId};this.client._sendMessage(i.CHAT_MESSAGE_REPORT,n,(function(e){t&&t.call(this.client,e)}))}markMessageSeen(e,t){var n={lastMsgSeq:e.seq,lastMsgTimestamp:e.createdTime,status:2,convId:e.convId};this.client._sendMessage(i.CHAT_MESSAGE_REPORT,n,(function(e){t&&t.call(this.client,e)}))}blockUser(e,t){var n={userId:e};this.client._sendMessage(i.CHAT_BLOCK_USER,n,(function(e){t&&t.call(this.client,e)}))}blockInviteToGroup(e,t){var n={block_group_invite:e};this.client._sendMessage(i.CHAT_BLOCK_USER,n,(function(e){t&&t.call(this.client,e)}))}rateChat(e,t,n,r){var s={convId:e,rating:t,comment:n};this.client._sendMessage(i.RATE_CHAT,s,(function(e){r&&r.call(this.client,e)}))}updateUserInfo(e,t,n,r){var s={display_name:e,avatar_url:t,email:n};this.client._sendMessage(i.UPDATE_USER_INFO,s,(function(e){r&&r.call(this.client,e)}))}userBeginTyping(e,t){var n={userId:e.userId,convId:e.convId};this.client._sendMessage(i.CHAT_USER_BEGIN_TYPING,n,(function(e){t&&t.call(this.client,e)}))}userEndTyping(e,t){var n={userId:e.userId,convId:e.convId};this.client._sendMessage(i.CHAT_USER_END_TYPING,n,(function(e){t&&t.call(this.client,e)}))}updateUserInfo(e,t){this.client._sendMessage(i.UPDATE_USER_INFO,e,(function(e){t&&t.call(this.client,e)}))}getUsersInfo(e,t){var n={userIds:e};this.client._sendMessage(i.CHAT_GET_USERS_INFO,n,(function(e){t&&t.call(this.client,e)}))}sendEmailTranscript(e,t){var n={convId:e.convId,email:e.email,domain:e.domain};this.client._sendMessage(i.SEND_EMAIL_TRANSCRIPT,n,(function(e){t&&t.call(this.client,e)}))}getChatServices(e){this.client._sendMessage(i.GET_CHAT_SERVICES,{},(function(t){e&&e.call(this.client,t)}))}viewChat(e,t){var n={convId:e};this.client._sendMessage(i.VIEW_CHAT,n,(function(e){t&&t.call(this.client,e)}))}joinChat(e,t){var n={convId:e};this.client._sendMessage(i.JOIN_CHAT_CUSTOMER_CARE,n,(function(e){t&&t.call(this.client,e)}))}transferChat(e,t){var n={convId:e.conversationId,customerId:e.customerId,customerName:e.customerName,toUserId:e.toUserId};this.client._sendMessage(i.CHAT_TRANSFER_TO_ANOTHER_AGENT,n,(function(e){t&&t.call(this.client,e)}))}confirmTransferChat(e,t){var n={convId:e.convId,answer:e.answer};console.log("+++ confirmTransferChat",n),this.client._sendMessage(i.CHAT_CONFIRM_TRANSFER_REQUEST,n,(function(e){t&&t.call(this.client,e)}))}unreadConversationCount(e){this.client._sendMessage(i.CHAT_UNREAD_CONVERSATION_COUNT,{},(function(t){e&&e.call(this.client,t)}))}resolveConversation(e,t){var n={convId:e.convId,resolved:e.resolved};console.log("+++ resolveConversation",n),this.client._sendMessage(i.CHAT_AGENT_RESOLVE_CONVERSATION,n,(function(e){t&&t.call(this.client,e)}))}},exports.StringeeUtil=ce,exports.StringeeServiceType=i,exports.StringeeWebRtc=ue,exports.StringeeVideoRoom=me,exports.StringeeVideoTrack=he,exports.StringeeChat2=ye,exports.StringeeChatConversation=Ee,exports.StringeeChatMessage=Ie,exports.SubscribedTrackDisplay=class{constructor(e,t,n,r,s){this.trackId=e.serverId,this.displayVideo=t,this.isMainTrack=n,this.displayView={width:r,height:s}}}})()})();